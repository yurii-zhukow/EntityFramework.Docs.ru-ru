---
title: Справочник по средствам EF Core (.NET CLI) — EF Core
author: bricelam
ms.author: bricelam
ms.date: 07/11/2019
uid: core/miscellaneous/cli/dotnet
ms.openlocfilehash: e5b42275aa575d711e1dcdf3d2ba3cb29a036727
ms.sourcegitcommit: 708b18520321c587b2046ad2ea9fa7c48aeebfe5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2019
ms.locfileid: "72181260"
---
# <a name="entity-framework-core-tools-reference---net-cli"></a>Справочник по инструментам Entity Framework Core-.NET CLI

Средства интерфейса командной строки (CLI) для Entity Framework Core выполнения задач разработки во время разработки. Например, они создают [миграции](/aspnet/core/data/ef-mvc/migrations?view=aspnetcore-2.0), применяют миграции и создают код для модели на основе существующей базы данных. Команды представляют собой расширение кросс-платформенной команды [DotNet](/dotnet/core/tools) , которая является частью [пакет SDK для .NET Core](https://www.microsoft.com/net/core). Эти средства работают с проектами .NET Core.

Если вы используете Visual Studio, вместо этого рекомендуется использовать [средства консоли диспетчера пакетов](powershell.md) :
* Они автоматически работают с текущим проектом, выбранным в **консоли диспетчера пакетов** , без необходимости переключать каталоги вручную.
* Они автоматически открывают файлы, созданные командой после завершения команды.

## <a name="installing-the-tools"></a>Установка инструментов

Процедура установки зависит от типа и версии проекта.

* EF Core 3. x
* ASP.NET Core версии 2,1 и более поздних
* EF Core 2. x
* EF Core 1. x

### <a name="ef-core-3x"></a>EF Core 3. x

* `dotnet ef` должен быть установлен в качестве глобального или локального средства. Большинство разработчиков устанавливают `dotnet ef` в качестве глобального средства с помощью следующей команды:

  ``` console
  dotnet tool install --global dotnet-ef
  ```

  Можно также использовать `dotnet ef` в качестве локального средства. Чтобы использовать его в качестве локального средства, восстановите зависимости проекта, объявляющие его как зависимость инструментария, с помощью [файла манифеста средства](https://github.com/dotnet/cli/issues/10288).

* Установите [пакет SDK для .NET Core 3,0](https://dotnet.microsoft.com/download/dotnet-core/3.0)). Пакет SDK должен быть установлен, даже если у вас установлена последняя версия Visual Studio.

* Установите последнюю версию пакета `Microsoft.EntityFrameworkCore.Design`.

  ``` Console
  dotnet add package Microsoft.EntityFrameworkCore.Design
  ```

### <a name="aspnet-core-21"></a>ASP.NET Core 2.1 +

* Установите текущую [пакет SDK для .NET Core](https://www.microsoft.com/net/download/core). Это нужно сделать, даже если у вас установлена последняя версия Visual Studio 2017.

  Это все, что необходимо для ASP.NET Core 2.1 +, так как пакет `Microsoft.EntityFrameworkCore.Design` включен в [метапакет Microsoft. AspNetCore. app](/aspnet/core/fundamentals/metapackage-app).

### <a name="ef-core-2x-not-aspnet-core"></a>EF Core 2. x (не ASP.NET Core)

Команды `dotnet ef` включены в пакет SDK для .NET Core, но для включения команд необходимо установить пакет `Microsoft.EntityFrameworkCore.Design`.

* Установите текущую [пакет SDK для .NET Core](https://www.microsoft.com/net/download/core). Пакет SDK должен быть установлен, даже если у вас установлена последняя версия Visual Studio.

* Установите последний стабильный пакет `Microsoft.EntityFrameworkCore.Design`.

  ``` Console
  dotnet add package Microsoft.EntityFrameworkCore.Design
  ```

### <a name="ef-core-1x"></a>EF Core 1. x

* Установите пакет SDK для .NET Core версию 2.1.200. Более поздние версии несовместимы с инструментами CLI для EF Core 1,0 и 1,1.

* Настройте приложение для использования версии пакета SDK 2.1.200, изменив его файл [Global. JSON](/dotnet/core/tools/global-json) . Этот файл обычно включается в каталог решения (один над проектом).

* Измените файл проекта и добавьте `Microsoft.EntityFrameworkCore.Tools.DotNet` в качестве элемента `DotNetCliToolReference`. Укажите последнюю версию версии 1. x, например: 1.1.6. См. пример файла проекта в конце этого раздела.

* Установите последнюю версию 1. x пакета `Microsoft.EntityFrameworkCore.Design`, например:

  ```console
  dotnet add package Microsoft.EntityFrameworkCore.Design -v 1.1.6
  ```

  После добавления ссылок на пакеты файл проекта выглядит примерно так:

  ``` xml
  <Project Sdk="Microsoft.NET.Sdk">
    <PropertyGroup>
      <OutputType>Exe</OutputType>
      <TargetFramework>netcoreapp1.1</TargetFramework>
    </PropertyGroup>
    <ItemGroup>
      <PackageReference Include="Microsoft.EntityFrameworkCore.Design"
                        Version="1.1.6"
                         PrivateAssets="All" />
    </ItemGroup>
    <ItemGroup>
       <DotNetCliToolReference Include="Microsoft.EntityFrameworkCore.Tools.DotNet"
                              Version="1.1.6" />
    </ItemGroup>
  </Project>
  ```

  Ссылка на пакет с `PrivateAssets="All"` не предоставляется проектам, ссылающимся на этот проект. Это ограничение особенно полезно для пакетов, которые обычно используются только во время разработки.

### <a name="verify-installation"></a>Проверка установки

Выполните следующие команды, чтобы убедиться, что средства EF Core CLI установлены правильно:

  ``` Console
  dotnet restore
  dotnet ef
  ```

Выходные данные команды определяют версию используемых средств:

```console

                     _/\__
               ---==/    \\
         ___  ___   |.    \|\
        | __|| __|  |  )   \\\
        | _| | _|   \_/ |  //|\\
        |___||_|       /   \\\/\\

Entity Framework Core .NET Command-line Tools 2.1.3-rtm-32065

<Usage documentation follows, not shown.>
```

## <a name="using-the-tools"></a>Использование средств

Перед использованием этих средств может потребоваться создать запускаемый проект или задать среду.

### <a name="target-project-and-startup-project"></a>Целевой проект и запускаемый проект

Команды ссылаются на *проект* и *запускаемый проект*.

* *Проект* также называется *целевым проектом* , так как он служит для добавления или удаления файлов. По умолчанию проект в текущем каталоге является целевым. Можно указать другой проект в качестве целевого проекта с помощью параметра <nobr>`--project`</nobr> .

* *Запускаемый проект* — это тот, который выполняет сборка и запуск средств. Средства должны выполнять код приложения во время разработки для получения сведений о проекте, таких как строка подключения к базе данных и Конфигурация модели. По умолчанию проект в текущем каталоге является запускаемым проектом. Можно указать другой проект в качестве запускаемого проекта с помощью параметра <nobr>`--startup-project`</nobr> .

Запускаемый проект и целевой проект часто являются одним и тем же проектом. Типичный сценарий, в котором они являются отдельными проектами, состоит в следующих случаях:

* Контекст EF Core и классы сущностей находятся в библиотеке классов .NET Core.
* Консольное приложение .NET Core или веб-приложение ссылается на библиотеку классов.

Также можно [разместить код миграции в библиотеке классов, отдельном от контекста EF Core](xref:core/managing-schemas/migrations/projects).

### <a name="other-target-frameworks"></a>Другие целевые платформы

Средства CLI работают с проектами .NET Core и .NET Framework проектами. Приложения с моделью EF Core в библиотеке классов .NET Standard могут не иметь проекта .NET Core или .NET Framework. Например, это справедливо для приложений Xamarin и универсальная платформа Windows. В таких случаях можно создать проект консольного приложения .NET Core, предназначенное только для запуска в качестве запускаемого проекта для инструментов. Проект может быть фиктивным проектом без действительного кода &mdash;. он необходим только для предоставления целей для инструментов.

Зачем нужен фиктивный проект? Как упоминалось ранее, средства должны выполнять код приложения во время разработки. Для этого им нужно использовать среду выполнения .NET Core. Если EF Coreная модель находится в проекте, ориентированном на .NET Core или .NET Framework, EF Core средства позаимствованы среду выполнения из проекта. Они не могут сделать это, если модель EF Core находится в библиотеке классов .NET Standard. .NET Standard не является реальной реализацией .NET; это спецификация набора интерфейсов API, которые должны поддерживаться реализациями .NET. Поэтому .NET Standard недостаточно для того, чтобы средства EF Core выполняли код приложения. Фиктивный проект, который создается для использования в качестве запускаемого проекта, предоставляет конкретную целевую платформу, в которую средства могут загрузить библиотеку классов .NET Standard.

### <a name="aspnet-core-environment"></a>Среда ASP.NET Core

Чтобы указать среду для проектов ASP.NET Core, задайте переменную среды **ASPNETCORE_ENVIRONMENT** перед выполнением команд.

## <a name="common-options"></a>Общие параметры

|                   | Параметр                            | Описание                                                                                                                                                                                                                                                   |
|:------------------|:----------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                   | `--json`                          | Отображение выходных данных JSON.                                                                                                                                                                                                                                             |
| <nobr>`-c`</nobr> | `--context <DBCONTEXT>`           | Класс `DbContext` для использования. Только имя класса или полный квалификатор с пространствами имен.  Если этот параметр не указан, EF Core найдет контекстный класс. Если существует несколько классов контекста, этот параметр является обязательным.                                            |
| `-p`              | `--project <PROJECT>`             | Относительный путь к папке проекта целевого проекта.  Значение по умолчанию — текущая папка.                                                                                                                                                              |
| `-s`              | `--startup-project <PROJECT>`     | Относительный путь к папке проекта запускаемого проекта. Значение по умолчанию — текущая папка.                                                                                                                                                              |
|                   | `--framework <FRAMEWORK>`         | [Моникер целевой платформы](/dotnet/standard/frameworks#supported-target-framework-versions) для [целевой платформы](/dotnet/standard/frameworks).  Используйте, если в файле проекта указано несколько целевых платформ, и вы хотите выбрать один из них. |
|                   | `--configuration <CONFIGURATION>` | Конфигурация сборки, например: `Debug` или `Release`.                                                                                                                                                                                                   |
|                   | `--runtime <IDENTIFIER>`          | Идентификатор целевой среды выполнения для восстановления пакетов. Список идентификаторов сред выполнения (RID) см. в [каталоге RID](/dotnet/core/rid-catalog).                                                                                                      |
| `-h`              | `--help`                          | Отображение справочной информации.                                                                                                                                                                                                                                        |
| `-v`              | `--verbose`                       | Отображение подробных выходных данных.                                                                                                                                                                                                                                          |
|                   | `--no-color`                      | Не замечайте выходные данные.                                                                                                                                                                                                                                        |
|                   | `--prefix-output`                 | Вывод префикса с уровнем.                                                                                                                                                                                                                                     |

## <a name="dotnet-ef-database-drop"></a>Удаление базы данных DotNet EF

Удаляет базу данных.

Параметры:

|                   | Параметр                   | Описание                                              |
|:------------------|:-------------------------|:---------------------------------------------------------|
| <nobr>`-f`</nobr> | <nobr>`--force`</nobr>   | Не подтверждайте.                                           |
|                   | <nobr>`--dry-run`</nobr> | Показывает, какую базу данных следует удалить, но не удалять. |

## <a name="dotnet-ef-database-update"></a>Обновление базы данных DotNet EF

Обновляет базу данных до последней миграции или до указанной миграции.

Аргументы.

| Аргумент      | Описание                                                                                                                                                                                                                                                     |
|:--------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `<MIGRATION>` | Целевая миграция. Миграция может быть идентифицирована по имени или по ИДЕНТИФИКАТОРу. Число 0 — это особый случай, который означает *перед первой миграцией* и приводит к отмене всех миграций. Если миграция не указана, команда по умолчанию принимает значение последней миграции. |

В следующих примерах база данных обновляется до указанной миграции. В первом случае используется имя миграции, а во втором используется идентификатор миграции:

```console
dotnet ef database update InitialCreate
dotnet ef database update 20180904195021_InitialCreate
```

## <a name="dotnet-ef-dbcontext-info"></a>сведения о dbcontextе DotNet EF

Возвращает сведения о типе `DbContext`.

## <a name="dotnet-ef-dbcontext-list"></a>Список dbcontextов DotNet EF

Список доступных типов `DbContext`.

## <a name="dotnet-ef-dbcontext-scaffold"></a>формирование шаблона DotNet EF DbContext

Создает код для `DbContext` и типов сущностей для базы данных. Чтобы эта команда создавала тип сущности, таблица базы данных должна иметь первичный ключ.

Аргументы.

| Аргумент       | Описание                                                                                                                                                                                                             |
|:---------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `<CONNECTION>` | Строка подключения к базе данных. Для проектов ASP.NET Core 2. x значением может быть *Name = \<name строки подключения >* . В этом случае имя берется из источников конфигурации, настроенных для проекта. |
| `<PROVIDER>`   | Используемый поставщик. Обычно это имя пакета NuGet, например: `Microsoft.EntityFrameworkCore.SqlServer`.                                                                                           |

Параметры:

|                 | Параметр                                   | Описание                                                                                                                                                                    |
|:----------------|:-----------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <nobr>-d</nobr> | `--data-annotations`                     | Используйте атрибуты для настройки модели (по возможности). Если этот параметр пропущен, используется только API-интерфейс Fluent.                                                                |
| `-c`            | `--context <NAME>`                       | Имя создаваемого класса `DbContext`.                                                                                                                                 |
|                 | `--context-dir <PATH>`                   | Каталог для размещения файла класса `DbContext` в. Пути задаются относительно каталога проекта. Пространства имен являются производными от имен папок.                                 |
| `-f`            | `--force`                                | Перезаписать существующие файлы.                                                                                                                                                      |
| `-o`            | `--output-dir <PATH>`                    | Каталог, в который помещаются файлы классов сущностей. Пути задаются относительно каталога проекта.                                                                                       |
|                 | <nobr>`--schema <SCHEMA_NAME>...`</nobr> | Схемы таблиц, для которых создаются типы сущностей. Чтобы указать несколько схем, повторите `--schema` для каждой из них. Если этот параметр не указан, включаются все схемы.          |
| `-t`            | `--table <TABLE_NAME>`...                | Таблицы, для которых создаются типы сущностей. Чтобы указать несколько таблиц, повторите `-t` или `--table` для каждой из них. Если этот параметр не указан, включаются все таблицы.                |
|                 | `--use-database-names`                   | Имена таблиц и столбцов следует использовать в точности так, как они отображаются в базе данных. Если этот параметр не указан, имена баз данных изменяются в соответствии с C# соглашениями о стиле имен. |

В следующем примере выполняется формирование шаблонов всех схем и таблиц и помещается новые файлы в папку *Models* .

```console
dotnet ef dbcontext scaffold "Server=(localdb)\mssqllocaldb;Database=Blogging;Trusted_Connection=True;" Microsoft.EntityFrameworkCore.SqlServer -o Models
```

Следующий пример формирует только выбранные таблицы и создает контекст в отдельной папке с указанным именем:

```console
dotnet ef dbcontext scaffold "Server=(localdb)\mssqllocaldb;Database=Blogging;Trusted_Connection=True;" Microsoft.EntityFrameworkCore.SqlServer -o Models -t Blog -t Post --context-dir Context -c BlogContext
```

## <a name="dotnet-ef-migrations-add"></a>Добавление миграций DotNet EF

Добавляет новый перенос.

Аргументы.

| Аргумент | Описание                |
|:---------|:---------------------------|
| `<NAME>` | Имя миграции. |

Параметры:

|                   | Параметр                             | Описание                                                                                                      |
|:------------------|:-----------------------------------|:-----------------------------------------------------------------------------------------------------------------|
| <nobr>`-o`</nobr> | <nobr>`--output-dir <PATH>`</nobr> | Используемый каталог (и подпространство имен). Пути задаются относительно каталога проекта. По умолчанию используется значение "миграции". |

## <a name="dotnet-ef-migrations-list"></a>Список миграций DotNet EF

Список доступных миграций.

## <a name="dotnet-ef-migrations-remove"></a>Удаление для миграций DotNet EF

Удаляет последнюю миграцию (выполняет откат изменений кода, выполненных для миграции).

Параметры:

|                   | Параметр    | Описание                                                                     |
|:------------------|:----------|:--------------------------------------------------------------------------------|
| <nobr>`-f`</nobr> | `--force` | Отмените миграцию (выполните откат изменений, примененных к базе данных). |

## <a name="dotnet-ef-migrations-script"></a>Скрипт миграции DotNet EF

Создает скрипт SQL из миграции.

Аргументы.

| Аргумент | Описание                                                                                                                                                   |
|:---------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `<FROM>` | Начало миграции. Миграция может быть идентифицирована по имени или по ИДЕНТИФИКАТОРу. Число 0 — это особый случай, который означает *перед первой миграцией*. Значение по умолчанию — 0. |
| `<TO>`   | Завершение миграции. По умолчанию используется последняя миграция.                                                                                                         |

Параметры:

|                   | Параметр            | Описание                                                        |
|:------------------|:------------------|:-------------------------------------------------------------------|
| <nobr>`-o`</nobr> | `--output <FILE>` | Файл, в который записывается скрипт.                                   |
| `-i`              | `--idempotent`    | Создание скрипта, который может использоваться в базе данных при любой миграции. |

В следующем примере создается скрипт для миграции InitialCreate:

```console
dotnet ef migrations script 0 InitialCreate
```

В следующем примере создается скрипт для всех миграций после миграции InitialCreate.

```console
dotnet ef migrations script 20180904195021_InitialCreate
```

## <a name="additional-resources"></a>Дополнительные ресурсы

* [Миграции](xref:core/managing-schemas/migrations/index)
* [Реконструирование](xref:core/managing-schemas/scaffolding)
