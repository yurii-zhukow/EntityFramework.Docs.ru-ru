---
title: Справочник по средствам EF Core (.NET CLI) — EF Core
description: Справочное руководство по средствам .NET Core CLI Entity Framework Core
author: bricelam
ms.date: 10/13/2020
uid: core/miscellaneous/cli/dotnet
ms.openlocfilehash: 4056fb99659ee3390d16b18eca9b12cfc8a2dd03
ms.sourcegitcommit: 0a25c03fa65ae6e0e0e3f66bac48d59eceb96a5a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/14/2020
ms.locfileid: "92062520"
---
# <a name="entity-framework-core-tools-reference---net-core-cli"></a>Справочник по инструментам Entity Framework Core — .NET Core CLI

Средства интерфейса командной строки (CLI) для Entity Framework Core выполнения задач разработки во время разработки. Например, они создают [миграции](/aspnet/core/data/ef-mvc/migrations), применяют миграции и создают код для модели на основе существующей базы данных. Команды представляют собой расширение кросс-платформенной команды [DotNet](/dotnet/core/tools) , которая является частью [пакет SDK для .NET Core](https://www.microsoft.com/net/core). Эти средства работают с проектами .NET Core.

При использовании Visual Studio рассмотрите возможность использования [средств консоли диспетчера пакетов](xref:core/miscellaneous/cli/powershell) вместо средств CLI. Средства консоли диспетчера пакетов автоматически:

* Работает с текущим проектом, выбранным в **консоли диспетчера пакетов** , без необходимости переключать каталоги вручную.
* Открывает файлы, созданные командой после завершения команды.
* Обеспечивает заполнение по клавише TAB команд, параметров, имен проектов, контекстных типов и имен миграции.

## <a name="installing-the-tools"></a>Установка инструментов

`dotnet ef` можно установить в качестве глобального или локального средства. Большинство разработчиков предпочитают устанавливать `dotnet ef` в качестве глобального средства, используя следующую команду:

```dotnetcli
dotnet tool install --global dotnet-ef
```

Чтобы использовать его в качестве локального средства, восстановите зависимости проекта, объявляющие его как зависимость инструментария, с помощью [файла манифеста средства](/dotnet/core/tools/global-tools#install-a-local-tool).

Обновите средство с помощью следующей команды:

```dotnetcli
dotnet tool update --global dotnet-ef
```

Прежде чем можно будет использовать средства в конкретном проекте, необходимо добавить в `Microsoft.EntityFrameworkCore.Design` него пакет.

```dotnetcli
dotnet add package Microsoft.EntityFrameworkCore.Design
```

### <a name="verify-installation"></a>Проверка установки

Выполните следующие команды, чтобы убедиться, что средства EF Core CLI установлены правильно:

  ```dotnetcli
  dotnet ef
  ```

Выходные данные команды определяют версию используемых средств:

```output

                     _/\__
               ---==/    \\
         ___  ___   |.    \|\
        | __|| __|  |  )   \\\
        | _| | _|   \_/ |  //|\\
        |___||_|       /   \\\/\\

Entity Framework Core .NET Command-line Tools 2.1.3-rtm-32065

<Usage documentation follows, not shown.>
```

## <a name="update-the-tools"></a>Обновление средств

Используйте `dotnet tool update --global dotnet-ef` для обновления глобальных средств до последней доступной версии. Если средства, установленные локально в проекте, используются `dotnet tool update dotnet-ef` . Установите определенную версию, добавив `--version <VERSION>` к команде. Дополнительные сведения см. в разделе " [Обновление](/dotnet/core/tools/dotnet-tool-update) " документации по инструменту DotNet.

## <a name="using-the-tools"></a>Использование средств

Перед использованием этих средств может потребоваться создать запускаемый проект или задать среду.

### <a name="target-project-and-startup-project"></a>Целевой проект и запускаемый проект

Команды ссылаются на *проект* и *запускаемый проект*.

* *Проект* также называется *целевым проектом* , так как он служит для добавления или удаления файлов. По умолчанию проект в текущем каталоге является целевым. Можно указать другой проект в качестве целевого проекта с помощью <nobr>`--project`</nobr> параметра.

* *Запускаемый проект* — это тот, который выполняет сборка и запуск средств. Средства должны выполнять код приложения во время разработки для получения сведений о проекте, таких как строка подключения к базе данных и Конфигурация модели. По умолчанию проект в текущем каталоге является запускаемым проектом. Можно указать другой проект в качестве запускаемого проекта с помощью <nobr>`--startup-project`</nobr> параметра.

Запускаемый проект и целевой проект часто являются одним и тем же проектом. Типичный сценарий, в котором они являются отдельными проектами, состоит в следующих случаях:

* Контекст EF Core и классы сущностей находятся в библиотеке классов .NET Core.
* Консольное приложение .NET Core или веб-приложение ссылается на библиотеку классов.

Также можно [разместить код миграции в библиотеке классов, отдельном от контекста EF Core](xref:core/managing-schemas/migrations/projects).

### <a name="other-target-frameworks"></a>Другие целевые платформы

Средства CLI работают с проектами .NET Core и .NET Framework проектами. Приложения с моделью EF Core в библиотеке классов .NET Standard могут не иметь проекта .NET Core или .NET Framework. Например, это справедливо для приложений Xamarin и универсальная платформа Windows. В таких случаях можно создать проект консольного приложения .NET Core, предназначенное только для запуска в качестве запускаемого проекта для инструментов. Проект может быть фиктивным проектом без реального кода, &mdash; поэтому он необходим только для предоставления целей для инструментов.

Зачем нужен фиктивный проект? Как упоминалось ранее, средства должны выполнять код приложения во время разработки. Для этого им нужно использовать среду выполнения .NET Core. Если EF Coreная модель находится в проекте, ориентированном на .NET Core или .NET Framework, EF Core средства позаимствованы среду выполнения из проекта. Они не могут сделать это, если модель EF Core находится в библиотеке классов .NET Standard. .NET Standard не является реальной реализацией .NET; это спецификация набора интерфейсов API, которые должны поддерживаться реализациями .NET. Поэтому .NET Standard недостаточно для того, чтобы средства EF Core выполняли код приложения. Фиктивный проект, который создается для использования в качестве запускаемого проекта, предоставляет конкретную целевую платформу, в которую средства могут загрузить библиотеку классов .NET Standard.

### <a name="aspnet-core-environment"></a>Среда ASP.NET Core

Чтобы указать среду для проектов ASP.NET Core, задайте переменную среды **ASPNETCORE_ENVIRONMENT** перед выполнением команд.

## <a name="common-options"></a>Общие параметры

| Параметр                                         | Short             | Описание                                                                                                                                                                                                                                                   |
|:-----------------------------------------------|:------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `--json`                                       |                   | Отображение выходных данных JSON.                                                                                                                                                                                                                                             |
| `--context <DBCONTEXT>`                        | <nobr>`-c`</nobr> | Класс `DbContext` для использования. Только имя класса или полный квалификатор с пространствами имен.  Если этот параметр не указан, EF Core найдет контекстный класс. Если существует несколько классов контекста, этот параметр является обязательным.                                            |
| `--project <PROJECT>`                          | `-p`              | Относительный путь к папке проекта целевого проекта.  Значение по умолчанию — текущая папка.                                                                                                                                                              |
| `--startup-project <PROJECT>`                  | `-s`              | Относительный путь к папке проекта запускаемого проекта. Значение по умолчанию — текущая папка.                                                                                                                                                              |
| `--framework <FRAMEWORK>`                      |                   | [Моникер целевой платформы](/dotnet/standard/frameworks#supported-target-framework-versions) для [целевой платформы](/dotnet/standard/frameworks).  Используйте, если в файле проекта указано несколько целевых платформ, и вы хотите выбрать один из них. |
| <nobr>`--configuration <CONFIGURATION>`</nobr> |                   | Конфигурация сборки, например: `Debug` или `Release` .                                                                                                                                                                                                   |
| `--runtime <IDENTIFIER>`                       |                   | Идентификатор целевой среды выполнения для восстановления пакетов. Список идентификаторов сред выполнения (RID) см. в [каталоге RID](/dotnet/core/rid-catalog).                                                                                                      |
| `--no-build`                                   |                   | Не создавайте проект. Предназначен для использования при обновлении сборки.                                                                                                                                                                                    |
| `--help`                                       | `-h`              | Отображение справочных сведений.                                                                                                                                                                                                                                        |
| `--verbose`                                    | `-v`              | Отображение подробных выходных данных.                                                                                                                                                                                                                                          |
| `--no-color`                                   |                   | Не замечайте выходные данные.                                                                                                                                                                                                                                        |
| `--prefix-output`                              |                   | Вывод префикса с уровнем.                                                                                                                                                                                                                                     |

Начиная с EF Core 5,0, в приложение передаются дополнительные аргументы.

## <a name="dotnet-ef-database-drop"></a>Удаление базы данных DotNet EF

Удаляет базу данных.

Параметры:

| Параметр                   | Short             | Описание                                              |
|:-------------------------|:------------------|:---------------------------------------------------------|
| `--force`                | <nobr>`-f`</nobr> | Не подтверждайте.                                           |
| <nobr>`--dry-run`</nobr> |                   | Показывает, какую базу данных следует удалить, но не удалять. |

[Общие параметры](#common-options) перечислены выше.

## <a name="dotnet-ef-database-update"></a>Обновление базы данных DotNet EF

Обновляет базу данных до последней миграции или до указанной миграции.

Аргументы:

| Аргумент                   | Описание                                                                                                                                                                                                                                                     |
|:---------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <nobr>`<MIGRATION>`</nobr> | Целевая миграция. Миграция может быть идентифицирована по имени или по ИДЕНТИФИКАТОРу. Число 0 — это особый случай, который означает *перед первой миграцией* и приводит к отмене всех миграций. Если миграция не указана, команда по умолчанию принимает значение последней миграции. |

Параметры:

| Параметр                                    | Описание                                                                                                                      |
|:------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------|
|  <nobr>`--connection <CONNECTION>`</nobr> | Строка подключения к базе данных. По умолчанию используется значение, заданное в `AddDbContext` или `OnConfiguring` . Добавлено в EF Core 5,0. |

[Общие параметры](#common-options) перечислены выше.

В следующих примерах база данных обновляется до указанной миграции. В первом случае используется имя миграции, а во втором используется идентификатор миграции и указанное соединение:

```dotnetcli
dotnet ef database update InitialCreate
dotnet ef database update 20180904195021_InitialCreate --connection your_connection_string
```

## <a name="dotnet-ef-dbcontext-info"></a>сведения о dbcontextе DotNet EF

Возвращает сведения о `DbContext` типе.

[Общие параметры](#common-options) перечислены выше.

## <a name="dotnet-ef-dbcontext-list"></a>Список dbcontextов DotNet EF

Перечисляет доступные `DbContext` типы.

[Общие параметры](#common-options) перечислены выше.

## <a name="dotnet-ef-dbcontext-scaffold"></a>формирование шаблона DotNet EF DbContext

Создает код для `DbContext` типов сущностей и для базы данных. Чтобы эта команда создавала тип сущности, таблица базы данных должна иметь первичный ключ.

Аргументы:

| Аргумент                    | Описание                                                                                                                                                                                                             |
|:----------------------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <nobr>`<CONNECTION>`</nobr> | Строка подключения к базе данных. Для проектов ASP.NET Core 2. x значением может быть *Name = \<name of connection string> *. В этом случае имя берется из источников конфигурации, настроенных для проекта. |
| `<PROVIDER>`                | Используемый поставщик. Обычно это имя пакета NuGet, например: `Microsoft.EntityFrameworkCore.SqlServer` .                                                                                           |

Параметры:

| Параметр                                   | Short             | Описание                                                                                                                                                                    |
|:-----------------------------------------|:------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `--data-annotations`                     | <nobr>`-d`</nobr> | Используйте атрибуты для настройки модели (по возможности). Если этот параметр пропущен, используется только API-интерфейс Fluent.                                                                |
| `--context <NAME>`                       | `-c`              | Имя `DbContext` создаваемого класса.                                                                                                                                 |
| `--context-dir <PATH>`                   |                   | Каталог, в котором следует разместить `DbContext` файл класса. Пути задаются относительно каталога проекта. Пространства имен являются производными от имен папок.                                 |
| `--context-namespace <NAMESPACE>`        |                   | Пространство имен, используемое для создаваемого `DbContext` класса. Примечание. Переопределение `--namespace` . Добавлено в EF Core 5,0.                                                                 |
| `--force`                                | `-f`              | Перезаписать существующие файлы.                                                                                                                                                      |
| `--output-dir <PATH>`                    | `-o`              | Каталог, в который помещаются файлы классов сущностей. Пути задаются относительно каталога проекта.                                                                                       |
| `--namespace <NAMESPACE>`                | `-n`              | Пространство имен, используемое для всех создаваемых классов. По умолчанию создается из корневого пространства имен и выходного каталога. Добавлено в EF Core 5,0.                                  |
| <nobr>`--schema <SCHEMA_NAME>...`</nobr> |                   | Схемы таблиц, для которых создаются типы сущностей. Чтобы указать несколько схем, повторите `--schema` их для каждой из них. Если этот параметр не указан, включаются все схемы.          |
| `--table <TABLE_NAME>`...                | `-t`              | Таблицы, для которых создаются типы сущностей. Чтобы указать несколько таблиц, повторите операцию `-t` или `--table` для каждой из них. Если этот параметр не указан, включаются все таблицы.                |
| `--use-database-names`                   |                   | Имена таблиц и столбцов следует использовать в точности так, как они отображаются в базе данных. Если этот параметр не указан, имена баз данных изменяются в соответствии с соглашениями о стиле имени C#. |
| `--no-onconfiguring`                     |                   | Подавляет создание `OnConfiguring` метода в созданном `DbContext` классе. Добавлено в EF Core 5,0.                                                                  |
| `--no-pluralize`                         |                   | Не используйте плурализер. Добавлено в EF Core 5,0                                                                                                                                 |

[Общие параметры](#common-options) перечислены выше.

В следующем примере выполняется формирование шаблонов всех схем и таблиц и помещается новые файлы в папку *Models* .

```dotnetcli
dotnet ef dbcontext scaffold "Server=(localdb)\mssqllocaldb;Database=Blogging;Trusted_Connection=True;" Microsoft.EntityFrameworkCore.SqlServer -o Models
```

Следующий пример формирует только выбранные таблицы и создает контекст в отдельной папке с указанным именем и пространством имен:

```dotnetcli
dotnet ef dbcontext scaffold "Server=(localdb)\mssqllocaldb;Database=Blogging;Trusted_Connection=True;" Microsoft.EntityFrameworkCore.SqlServer -o Models -t Blog -t Post --context-dir Context -c BlogContext --context-namespace New.Namespace
```

## <a name="dotnet-ef-dbcontext-script"></a>Скрипт DotNet EF DbContext

Создает скрипт SQL из DbContext. Обход всех миграций. Добавлено в EF Core 3,0.

Параметры:

| Параметр                         | Short             | Описание                      |
| ------------------------------ | ----------------- | -------------------------------- |
| <nobr>`--output <FILE>`</nobr> | <nobr>`-o`</nobr> | Файл, в который записывается результат. |

[Общие параметры](#common-options) перечислены выше.

## <a name="dotnet-ef-migrations-add"></a>Добавление миграций DotNet EF

Добавляет новый перенос.

Аргументы:

| Аргумент              | Описание                |
|:----------------------|:---------------------------|
| <nobr>`<NAME>`</nobr> | Имя миграции. |

Параметры:

| Параметр                                 | Short             | Описание                                                                                                            |
|:---------------------------------------|:------------------|:-----------------------------------------------------------------------------------------------------------------------|
| `--output-dir <PATH>`                  | <nobr>`-o`</nobr> | Каталог используется для вывода файлов. Пути задаются относительно целевого каталога проекта. По умолчанию используется значение "миграции".   |
| <nobr>`--namespace <NAMESPACE>`</nobr> | `-n`              | Пространство имен, используемое для создаваемых классов. По умолчанию создается из выходного каталога. Добавлено в EF Core 5,0. |

[Общие параметры](#common-options) перечислены выше.

## <a name="dotnet-ef-migrations-list"></a>Список миграций DotNet EF

Список доступных миграций.

Параметры:

| Параметр                                   | Описание                                                                                                                  |
| ---------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------- |
| <nobr>`--connection <CONNECTION>`</nobr> | Строка подключения к базе данных. По умолчанию используется значение, указанное в AddDbContext или onconfiguring. Добавлено в EF Core 5,0. |
| `--no-connect`                           | Не подключайтесь к базе данных. Добавлено в EF Core 5,0.                                                                         |

[Общие параметры](#common-options) перечислены выше.

## <a name="dotnet-ef-migrations-remove"></a>Удаление для миграций DotNet EF

Удаляет последнюю миграцию (выполняет откат изменений кода, выполненных для миграции).

Параметры:

| Параметр                 | Short             | Описание                                                                     |
|:-----------------------|:------------------|:--------------------------------------------------------------------------------|
| <nobr>`--force`</nobr> | <nobr>`-f`</nobr> | Отмените миграцию (выполните откат изменений, примененных к базе данных). |

[Общие параметры](#common-options) перечислены выше.

## <a name="dotnet-ef-migrations-script"></a>Скрипт миграции DotNet EF

Создает скрипт SQL из миграции.

Аргументы:

| Аргумент              | Описание                                                                                                                                                   |
|:----------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <nobr>`<FROM>`</nobr> | Начало миграции. Миграция может быть идентифицирована по имени или по ИДЕНТИФИКАТОРу. Число 0 — это особый случай, который означает *перед первой миграцией*. Значение по умолчанию — 0. |
| `<TO>`                | Завершение миграции. По умолчанию используется последняя миграция.                                                                                                         |

Параметры:

| Параметр                           | Short             | Описание                                                        |
|:---------------------------------|:------------------|:-------------------------------------------------------------------|
| `--output <FILE>`                | <nobr>`-o`</nobr> | Файл, в который записывается скрипт.                                   |
| `--idempotent`                   | `-i`              | Создание скрипта, который может использоваться в базе данных при любой миграции. |
| <nobr>`--no-transactions`</nobr> |                   | Не создавайте инструкции SQL Transaction. Добавлено в EF Core 5,0.   |

[Общие параметры](#common-options) перечислены выше.

В следующем примере создается скрипт для миграции InitialCreate:

```dotnetcli
dotnet ef migrations script 0 InitialCreate
```

В следующем примере создается скрипт для всех миграций после миграции InitialCreate.

```dotnetcli
dotnet ef migrations script 20180904195021_InitialCreate
```

## <a name="additional-resources"></a>Дополнительные ресурсы

* [Миграции](xref:core/managing-schemas/migrations/index)
* [Реконструирование](xref:core/managing-schemas/scaffolding)
