---
title: Справочник по средствам EF Core (консоль диспетчера пакетов) — EF Core
author: bricelam
ms.author: bricelam
ms.date: 09/18/2018
uid: core/miscellaneous/cli/powershell
ms.openlocfilehash: 0676475d46a8d21dee7bd10e25dd273a11e96ac3
ms.sourcegitcommit: 79e460f76b6664e1da5886d102bd97f651d2ffff
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/29/2020
ms.locfileid: "82538404"
---
# <a name="entity-framework-core-tools-reference---package-manager-console-in-visual-studio"></a>Справочник по средствам Entity Framework Core. консоль диспетчера пакетов в Visual Studio

Средства консоли диспетчера пакетов (PMC) для Entity Framework Core выполнения задач разработки во время разработки. Например, они создают [миграции](/aspnet/core/data/ef-mvc/migrations?view=aspnetcore-2.0), применяют миграции и создают код для модели на основе существующей базы данных. Команды выполняются в Visual Studio с помощью [консоли диспетчера пакетов](/nuget/tools/package-manager-console). Эти инструменты совместимы с проектами .NET Framework и .NET Core.

Если вы не используете Visual Studio, вместо этого рекомендуется использовать [средства командной строки EF Core](dotnet.md) . Средства CLI выполняются на разных платформах и выполняются в командной строке.

## <a name="installing-the-tools"></a>Установка инструментов

Процедуры установки и обновления инструментов отличаются от ASP.NET Core 2.1 + и более ранних версий или других типов проектов.

### <a name="aspnet-core-version-21-and-later"></a>ASP.NET Core версии 2,1 и более поздних

Эти средства автоматически включаются в проект ASP.NET Core 2.1 +, так как `Microsoft.EntityFrameworkCore.Tools` пакет входит в состав [метапакет Microsoft. AspNetCore. app](/aspnet/core/fundamentals/metapackage-app).

Поэтому вам не нужно ничего делать для установки средств, но вам нужно:

* Восстановите пакеты перед использованием средств в новом проекте.
* Установите пакет, чтобы обновить средства до более новой версии.

Чтобы убедиться, что вы получаете последнюю версию средств, мы рекомендуем также выполнить следующие действия.

* Измените *CSPROJ* -файл и добавьте строку, указывающую последнюю версию пакета [Microsoft. EntityFrameworkCore. Tools](https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.Tools/) . Например, файл *. csproj* может включать в `ItemGroup` себя следующий вид:

  ```xml
  <ItemGroup>
    <PackageReference Include="Microsoft.AspNetCore.App" />
    <PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="2.1.3" />
    <PackageReference Include="Microsoft.VisualStudio.Web.CodeGeneration.Design" Version="2.1.1" />
  </ItemGroup>
  ```

Обновите средства при получении сообщения, как в следующем примере:

> Версия инструментов EF Core "короче-RTM-30846" старше, чем версия среды выполнения "2.1.3-RTM-32065". Обновите средства для получения последних компонентов и исправлений ошибок.

Чтобы обновить средства, выполните следующие действия.

* Установите пакет SDK для .NET Core последней версии.
* Обновите Visual Studio до последней версии.
* Измените *CSPROJ* -файл, чтобы он включал ссылку на пакет для последней версии пакета инструментов, как показано выше.

### <a name="other-versions-and-project-types"></a>Другие версии и типы проектов

Установите средства консоли диспетчера пакетов, выполнив следующую команду в **консоли диспетчера пакетов**:

``` powershell
Install-Package Microsoft.EntityFrameworkCore.Tools
```

Обновите средства, выполнив следующую команду в **консоли диспетчера пакетов**.

``` powershell
Update-Package Microsoft.EntityFrameworkCore.Tools
```

### <a name="verify-the-installation"></a>Проверка установки

Убедитесь, что средства установлены, выполнив следующую команду:

``` powershell
Get-Help about_EntityFrameworkCore
```

Выходные данные выглядят следующим образом (он не указывает, какую версию инструментов вы используете):

```console

                     _/\__
               ---==/    \\
         ___  ___   |.    \|\
        | __|| __|  |  )   \\\
        | _| | _|   \_/ |  //|\\
        |___||_|       /   \\\/\\

TOPIC
    about_EntityFrameworkCore

SHORT DESCRIPTION
    Provides information about the Entity Framework Core Package Manager Console Tools.

<A list of available commands follows, omitted here.>
```

## <a name="using-the-tools"></a>Использование средств

Перед использованием средств:

* Изучите разницу между целевым и запускаемым проектами.
* Узнайте, как использовать средства с библиотеками классов .NET Standard.
* Для проектов ASP.NET Core задайте среду.

### <a name="target-and-startup-project"></a>Целевой и запускаемый проекты

Команды ссылаются на *проект* и *запускаемый проект*.

* *Проект* также называется *целевым проектом* , так как он служит для добавления или удаления файлов. По умолчанию **проект** , выбранный в **консоли диспетчера пакетов** , является целевым. Можно указать другой проект в качестве целевого проекта с помощью <nobr>`--project`</nobr> параметра.

* *Запускаемый проект* — это тот, который выполняет сборка и запуск средств. Средства должны выполнять код приложения во время разработки для получения сведений о проекте, таких как строка подключения к базе данных и Конфигурация модели. По умолчанию **запускаемым проектом** в **Обозреватель решений** является запускаемый проект. Можно указать другой проект в качестве запускаемого проекта с помощью <nobr>`--startup-project`</nobr> параметра.

Запускаемый проект и целевой проект часто являются одним и тем же проектом. Типичный сценарий, в котором они являются отдельными проектами, состоит в следующих случаях:

* Контекст EF Core и классы сущностей находятся в библиотеке классов .NET Core.
* Консольное приложение .NET Core или веб-приложение ссылается на библиотеку классов.

Также можно [разместить код миграции в библиотеке классов, отдельном от контекста EF Core](xref:core/managing-schemas/migrations/projects).

### <a name="other-target-frameworks"></a>Другие целевые платформы

Средства консоли диспетчера пакетов работают с проектами .NET Core или .NET Framework. Приложения с моделью EF Core в библиотеке классов .NET Standard могут не иметь проекта .NET Core или .NET Framework. Например, это справедливо для приложений Xamarin и универсальная платформа Windows. В таких случаях можно создать проект консольного приложения .NET Core или .NET Framework, предназначенное только для запуска в качестве запускаемого проекта для инструментов. Проект может быть фиктивным проектом без реального кода &mdash; , поэтому он необходим только для предоставления целей для инструментов.

Зачем нужен фиктивный проект? Как упоминалось ранее, средства должны выполнять код приложения во время разработки. Для этого необходимо использовать среду выполнения .NET Core или .NET Framework. Если EF Coreная модель находится в проекте, ориентированном на .NET Core или .NET Framework, EF Core средства позаимствованы среду выполнения из проекта. Они не могут сделать это, если модель EF Core находится в библиотеке классов .NET Standard. .NET Standard не является реальной реализацией .NET; это спецификация набора интерфейсов API, которые должны поддерживаться реализациями .NET. Поэтому .NET Standard недостаточно для того, чтобы средства EF Core выполняли код приложения. Фиктивный проект, который создается для использования в качестве запускаемого проекта, предоставляет конкретную целевую платформу, в которую средства могут загрузить библиотеку классов .NET Standard.

### <a name="aspnet-core-environment"></a>Среда ASP.NET Core

Чтобы указать среду для проектов ASP.NET Core, установите параметр **env: ASPNETCORE_ENVIRONMENT** перед выполнением команд.

## <a name="common-parameters"></a>Общие параметры

В следующей таблице приведены параметры, которые являются общими для всех EF Coreных команд.

| Параметр                 | Описание                                                                                                                                                                                                          |
|:--------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| — Строка \<контекста>        | Класс `DbContext` для использования. Только имя класса или полный квалификатор с пространствами имен.  Если этот параметр опущен, EF Core находит класс контекста. Если имеется несколько классов контекста, этот параметр является обязательным. |
| -Строковый> проекта \<        | Целевой проект. Если этот параметр не указан, в качестве целевого проекта используется **проект по умолчанию** для **консоли диспетчера пакетов** .                                                                             |
| <nobr>-Стартуппрожект</nobr> \<строка> | Автоматически запускаемый проект. Если этот параметр не указан, в качестве целевого проекта используется **запускаемый проект** в **свойствах решения** .                                                                                 |
| -Verbose                  | Отображение подробных выходных данных.                                                                                                                                                                                                 |

Чтобы отобразить справочные сведения о команде, используйте `Get-Help` команду PowerShell.

> [!TIP]
> Параметры Context, Project и Стартуппрожект поддерживают расширение Tab.

## <a name="add-migration"></a>Добавление и миграция

Добавляет новый перенос.

Параметры

| Параметр                         | Описание                                                                                                             |
|:----------------------------------|:------------------------------------------------------------------------------------------------------------------------|
| <nobr>— Строка \<имени><nobr>       | Имя миграции. Этот параметр является позиционированным и является обязательным.                                              |
| <nobr>-OutputDir \<строка></nobr> | Каталог используется для вывода файлов. Пути задаются относительно целевого каталога проекта. По умолчанию используется значение "миграции". |
| <nobr>— Строка \<пространства имен></nobr> | Пространство имен, используемое для создаваемых классов. По умолчанию создается из выходного каталога. |

## <a name="drop-database"></a>Удалить базу данных

Удаляет базу данных.

Параметры

| Параметр | Описание                                              |
|:----------|:---------------------------------------------------------|
| -WhatIf   | Показывает, какую базу данных следует удалить, но не удалять. |

## <a name="get-dbcontext"></a>Get-DbContext

Возвращает сведения о `DbContext` типе.

## <a name="remove-migration"></a>Remove-Migration

Удаляет последнюю миграцию (выполняет откат изменений кода, выполненных для миграции).

Параметры

| Параметр | Описание                                                                     |
|:----------|:--------------------------------------------------------------------------------|
| -Force    | Отмените миграцию (выполните откат изменений, примененных к базе данных). |

## <a name="scaffold-dbcontext"></a>Формирование шаблонов — DbContext

Создает код для типов `DbContext` сущностей и для базы данных. `Scaffold-DbContext` Чтобы создать тип сущности, таблица базы данных должна иметь первичный ключ.

Параметры

| Параметр                          | Описание                                                                                                                                                                                                                                                             |
|:-----------------------------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <nobr>— Строка \<подключения></nobr> | Строка подключения к базе данных. Для проектов ASP.NET Core 2. x значением может быть *Name =\<name строки подключения>*. В этом случае имя берется из источников конфигурации, настроенных для проекта. Этот параметр является позиционированным и является обязательным. |
| <nobr>— Строка \<поставщика></nobr>   | Используемый поставщик. Обычно это имя пакета NuGet, например: `Microsoft.EntityFrameworkCore.SqlServer`. Этот параметр является позиционированным и является обязательным.                                                                                           |
| -OutputDir \<строка>               | Каталог для размещения файлов. Пути задаются относительно каталога проекта.                                                                                                                                                                                             |
| -Контекстдир \<строка>              | Каталог, в котором следует `DbContext` разместить файл. Пути задаются относительно каталога проекта.                                                                                                                                                               |
| — Строка \<пространства имен>               | Пространство имен, используемое для всех создаваемых классов. По умолчанию создается из корневого пространства имен и выходного каталога.                                                                                                                                                                                             |
| -ContextNamespace \<строка>        | Пространство имен, используемое для создаваемого `DbContext` класса. Примечание. Переопределение `-Namespace`.                                                                                                                                                                              |
| — Строка \<контекста>                 | Имя создаваемого `DbContext` класса.                                                                                                                                                                                                                          |
| -Schemas \<строка [] >               | Схемы таблиц, для которых создаются типы сущностей. Если этот параметр пропущен, включаются все схемы.                                                                                                                                                             |
| -Tables \<String [] >                | Таблицы, для которых создаются типы сущностей. Если этот параметр пропущен, включаются все таблицы.                                                                                                                                                                         |
| -Аннотации                   | Используйте атрибуты для настройки модели (по возможности). Если этот параметр пропущен, используется только API-интерфейс Fluent.                                                                                                                                                      |
| -Уседатабасенамес                  | Имена таблиц и столбцов следует использовать в точности так, как они отображаются в базе данных. Если этот параметр опущен, имена баз данных изменяются в соответствии с соглашениями о стиле имени C#.                                                                                       |
| -Force                             | Перезаписать существующие файлы.                                                                                                                                                                                                                                               |

Пример:

```powershell
Scaffold-DbContext "Server=(localdb)\mssqllocaldb;Database=Blogging;Trusted_Connection=True;" Microsoft.EntityFrameworkCore.SqlServer -OutputDir Models
```

Пример: формирование шаблонов только для выбранных таблиц и создание контекста в отдельной папке с указанным именем и пространством имен.

```powershell
Scaffold-DbContext "Server=(localdb)\mssqllocaldb;Database=Blogging;Trusted_Connection=True;" Microsoft.EntityFrameworkCore.SqlServer -OutputDir Models -Tables "Blog","Post" -ContextDir Context -Context BlogContext -ContextNamespace New.Namespace
```

## <a name="script-migration"></a>Скрипт — миграция

Создает скрипт SQL, который применяет все изменения из одной выбранной миграции в другую выбранную миграцию.

Параметры

| Параметр                | Описание                                                                                                                                                                                                                |
|:-------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| *-From* \<строка>        | Начало миграции. Миграция может быть идентифицирована по имени или по ИДЕНТИФИКАТОРу. Число 0 — это особый случай, который означает *перед первой миграцией*. Значение по умолчанию — 0.                                                              |
| *-To* \<String>          | Завершение миграции. По умолчанию используется последняя миграция.                                                                                                                                                                      |
| <nobr>-Идемпотентными</nobr> | Создание скрипта, который может использоваться в базе данных при любой миграции.                                                                                                                                                         |
| — Выходная \<строка>        | Файл, в который записывается результат. Если этот параметр не указан, файл создается с именем, созданным в той же папке, что и файлы среды выполнения приложения, например: */obj/Debug/netcoreapp2.1/ghbkztfz.SQL/*. |

> [!TIP]
> Параметры to, from и Output поддерживают расширение клавишей TAB.

В следующем примере создается скрипт для миграции InitialCreate с использованием имени миграции.

```powershell
Script-Migration -To InitialCreate
```

В следующем примере создается скрипт для всех миграций после миграции InitialCreate с использованием идентификатора миграции.

```powershell
Script-Migration -From 20180904195021_InitialCreate
```

## <a name="update-database"></a>Обновление базы данных

Обновляет базу данных до последней миграции или до указанной миграции.

| Параметр                           | Описание                                                                                                                                                                                                                                                     |
|:------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <nobr>*-Строка миграции* \<></nobr> | Целевая миграция. Миграция может быть идентифицирована по имени или по ИДЕНТИФИКАТОРу. Число 0 — это особый случай, который означает *перед первой миграцией* и приводит к отмене всех миграций. Если миграция не указана, команда по умолчанию принимает значение последней миграции. |
| <nobr>— Строка \<подключения></nobr>  | Строка подключения к базе данных. По умолчанию используется значение, `AddDbContext` заданное `OnConfiguring`в или. |

> [!TIP]
> Параметр миграции поддерживает расширение клавиш TAB.

В следующем примере возвращаются все миграции.

```powershell
Update-Database -Migration 0
```

В следующих примерах база данных обновляется до указанной миграции. В первом случае используется имя миграции, а во втором используется идентификатор миграции и указанное соединение:

```powershell
Update-Database -Migration InitialCreate
Update-Database -Migration 20180904195021_InitialCreate -Connection your_connection_string
```

## <a name="additional-resources"></a>Дополнительные ресурсы

* [Миграции](xref:core/managing-schemas/migrations/index)
* [Реконструирование](xref:core/managing-schemas/scaffolding)
