---
title: EF Core Справочник по средствам (консоль диспетчера пакетов) — EF Core
author: bricelam
ms.author: bricelam
ms.date: 09/18/2018
uid: core/miscellaneous/cli/powershell
ms.openlocfilehash: cde3c1f75d33808259654dfd9e1de51e662e8092
ms.sourcegitcommit: ad1bdea58ed35d0f19791044efe9f72f94189c18
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/28/2018
ms.locfileid: "47447200"
---
# <a name="entity-framework-core-tools-reference---package-manager-console-in-visual-studio"></a>Справочник по - консоль диспетчера пакетов в Visual Studio средствам Entity Framework Core

Инструменты консоли диспетчера пакетов (PMC) для Entity Framework Core выполнения задач разработки во время разработки. Например, они создают [миграций](/aspnet/core/data/ef-mvc/migrations?view=aspnetcore-2.0#introduction-to-migrations), применить миграции и создать код для модели, основанные на существующей базы данных. Команды выполняются внутри Visual Studio с помощью [консоль диспетчера пакетов](/nuget/tools/package-manager-console). Эти инструменты совместимы с проектами .NET Framework и .NET Core.

Если вы не используете Visual Studio, мы рекомендуем [инструменты командной строки EF Core](dotnet.md) вместо этого. Средства CLI кросс платформенные и выполнения в командной строке.

## <a name="installing-the-tools"></a>Установка инструментов

Процедуры по установке и средства обновления отличаются между ASP.NET Core 2.1 или более поздней и более ранних версий или других типов проектов.

### <a name="aspnet-core-version-21-and-later"></a>ASP.NET Core версии 2.1 и более поздние версии

Средства автоматически включаются в проекте ASP.NET Core 2.1 или более поздней, так как `Microsoft.EntityFrameworkCore.Tools` пакет включен в [метапакет Microsoft.AspNetCore.App](/aspnet/core/fundamentals/metapackage-app).

Поэтому не нужно ничего делать, чтобы установить средства, но вам нужно:
* Восстановите пакеты перед использованием средства в новый проект.
* Установите пакет для обновления до более новой версии инструментов.

Чтобы убедиться в том, что вы получаете последнюю версию средства, рекомендуется также выполнить следующие действия:

* Изменить ваш *.csproj* файл и добавьте строку, указав последнюю версию [Microsoft.EntityFrameworkCore.Tools](https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.Tools/) пакета. Например *.csproj* файл может содержать `ItemGroup` , выглядящий следующим образом:

  ```xml
  <ItemGroup>
    <PackageReference Include="Microsoft.AspNetCore.App" />
    <PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="2.1.3" />
    <PackageReference Include="Microsoft.VisualStudio.Web.CodeGeneration.Design" Version="2.1.1" />
  </ItemGroup>
  ```

Обновите инструменты при получении сообщения, как в следующем примере:

> Версия средства EF Core «2.1.1-rtm-30846» старше, среды выполнения «2.1.3-rtm-32065». Обновите инструменты для новейших функций и исправления ошибок.

Чтобы обновить средства:
* Установите последний пакет SDK .NET Core.
* Обновление Visual Studio до последней версии.
* Изменить *.csproj* файл, теперь она содержит ссылки на последнюю версию пакета средств, пакет, как показано выше.

### <a name="other-versions-and-project-types"></a>Другие версии и типы проектов

Установить средства консоль диспетчера пакетов, выполнив следующую команду в **консоль диспетчера пакетов**:

``` powershell
Install-Package Microsoft.EntityFrameworkCore.Tools
```

Обновить инструменты, выполнив следующую команду в **консоль диспетчера пакетов**.

``` powershell
Update-Package Microsoft.EntityFrameworkCore.Tools
```

### <a name="verify-the-installation"></a>Проверка установки

Убедитесь, что установлены средства, выполнив следующую команду:

``` powershell
Get-Help about_EntityFrameworkCore
```

Результат выглядит следующим образом (она не сообщает, какие версии инструментов, вы используете):

```console

                     _/\__
               ---==/    \\
         ___  ___   |.    \|\
        | __|| __|  |  )   \\\
        | _| | _|   \_/ |  //|\\
        |___||_|       /   \\\/\\

TOPIC
    about_EntityFrameworkCore

SHORT DESCRIPTION
    Provides information about the Entity Framework Core Package Manager Console Tools.

<A list of available commands follows, omitted here.>
```

## <a name="using-the-tools"></a>С помощью средств

Перед использованием средства:
* Понимать разницу между целевой и запуска проекта.
* Узнайте, как использовать средства с помощью библиотеки классов .NET Standard.
* Для проектов ASP.NET Core настройте среду.

### <a name="target-and-startup-project"></a>Целевой объект и запуска проекта

См. команды *проекта* и *запускаемым проектом*.

* *Проекта* также известен как *целевой проект* так как это где команды добавления или удаления файлов. По умолчанию **проект по умолчанию** на **консоль диспетчера пакетов** является целевого проекта. Можно указать другой проект в качестве целевого проекта с помощью <nobr> `--project` </nobr> параметр.

* *Запускаемым проектом* является тот, который построение и запуск средств. Средства должны выполнить код приложения во время разработки для получения сведений о проекте, например строку подключения базы данных и конфигурации модели. По умолчанию **запускаемым проектом** в **обозревателе решений** является запускаемым проектом. Можно указать другой проект запускаемым проектом с помощью <nobr> `--startup-project` </nobr> параметр.

Зачастую того же проекта запускаемого проекта и целевой проект. Типичный сценарий, где они находятся отдельные проекты — когда:

* В библиотеке классов .NET Core, EF Core контекст и классы сущностей.
* Консольное приложение .NET Core или веб-приложение ссылается на библиотеку классов.

Существует также возможность [поместите код миграции в библиотеку классов, отдельно от контекста EF Core](xref:core/managing-schemas/migrations/projects).

### <a name="other-target-frameworks"></a>Другие целевые платформы

Консоль диспетчера пакетов средств работы с проектами .NET Core или .NET Framework. Приложения, которые имеют модель EF Core в библиотеку классов .NET Standard может отсутствовать, .NET Core или .NET Framework проекта. Например это верно для приложений Xamarin и универсальной платформы Windows. В таком случае можно создать .NET Core или .NET Framework проекта консольного приложения, единственным назначением которого является в качестве запускаемого проекта для средств. Проект может быть пустым проектом с не содержащим реального кода &mdash; этот компонент необходим только для предоставления целевой объект для выполнения средства.

Почему является пустым проектом требуется? Как упоминалось ранее, средства нужно выполнять код приложения во время разработки. Чтобы сделать это, они должны использовать среду выполнения .NET Core или .NET Framework. Когда модель EF Core находится в проекте, ориентированном на .NET Core или .NET Framework, средства EF Core позаимствовать среды выполнения из проекта. Они не могут делать, если модель EF Core в библиотеку классов .NET Standard. .NET Standard не фактическую реализацию .NET; это спецификация набора API-интерфейсов, реализации .NET должны поддерживать. Поэтому .NET Standard недостаточно для инструментов EF Core для выполнения кода приложения. Фиктивный проект, созданный для использования в качестве запускаемого проекта предоставляет конкретную целевую платформу, в которой средства можно загружать библиотеки классов .NET Standard. 

### <a name="aspnet-core-environment"></a>Среда ASP.NET Core

Чтобы указать среду для проектов ASP.NET Core, задайте **env:ASPNETCORE_ENVIRONMENT** перед выполнением команд.

## <a name="common-parameters"></a>Общие параметры

В следующей таблице показаны параметры, которые являются общими для всех команд EF Core:

| Параметр                 | Описание                                                                                                                                                                                                          |
|---------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| -Контексте \<строка >        | `DbContext` Класс для использования. Имя класса, только из цифр или полное с пространствами имен.  Если этот параметр опущен, EF Core находит класс контекста. Если имеется несколько классов контекста, этот параметр является обязательным. |
| — Проект \<строка >        | Целевой проект. Если этот параметр опущен, **проект по умолчанию** для **консоль диспетчера пакетов** используется в качестве целевого проекта.                                                                             |
| -StartupProject \<строка > | Запускаемый проект. Если этот параметр опущен, **запускаемым проектом** в **свойства решения** используется в качестве целевого проекта.                                                                                 |
| -Verbose                  | Показать подробные выходные данные.                                                                                                                                                                                                 |

Чтобы отобразить справочные сведения о команде, используйте PowerShell `Get-Help` команды.

> [!TIP]
> Параметры контекста, проекта и StartupProject поддерживает расширение функций клавиши tab.

## <a name="add-migration"></a>Add-Migration

Добавление новой миграции.

Параметры:

| Параметр                         | Описание                                                                                                             |
|-----------------------------------|-------------------------------------------------------------------------------------------------------------------------|
| <nobr>-Name \<строка ><nobr>       | Имя миграции. Это является позиционным параметром и является обязательным.                                              |
| <nobr>-OutputDir \<строка ></nobr> | Каталог (и sub-namespace) для использования. Пути задаются относительно каталога проекта целевой объект. По умолчанию используется «Миграция». |

## <a name="drop-database"></a>DROP Database

Удаляет базу данных.

Параметры:

| Параметр | Описание                                                |
|-----------|------------------------------------------------------------|
| -WhatIf   | Показать базу данных, которая будет удалена, но не удаляйте ее.   |

## <a name="get-dbcontext"></a>Get-DbContext

Выводит список доступных `DbContext` типов.

## <a name="remove-migration"></a>Remove-Migration

Удаляет последнюю миграцию (выполняется откат изменений кода, которые были выполнены для миграции). 

Параметры:

| Параметр | Описание                                                                     |
|-----------|---------------------------------------------------------------------------------|
| -Force    | Миграции отменить (откатить изменения, которые были применены к базе данных). |

## <a name="scaffold-dbcontext"></a>Scaffold-DbContext

Создает код для `DbContext` и типы сущностей для базы данных.

Параметры:

| Параметр                                  | Описание                                                                                                                                                                                                                                                             |
|--------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <nobr>-Connection \<строка ></nobr>         | Строка подключения к базе данных. Для проектов ASP.NET Core 2.x, значение может быть *имя =\<имя строки подключения >*. В этом случае имя берется из источников конфигурации, которые были настроены для проекта. Это является позиционным параметром и является обязательным. |
| <nobr>-Поставщик \<строка ></nobr>           | Используемый поставщик. Обычно это имя пакета NuGet, например: `Microsoft.EntityFrameworkCore.SqlServer`. Это является позиционным параметром и является обязательным.                                                                                           |
| -OutputDir \<строка >                       | Чтобы поместить файлы каталог. Пути задаются относительно каталога проекта.                                                                                                                                                                                             |
| -ContextDir \<строка >                      | Каталог для размещения `DbContext` в файл. Пути задаются относительно каталога проекта.                                                                                                                                                                              |
| -Контексте \<строка >                         | Имя `DbContext` класса, необходимо создать.                                                                                                                                                                                                                          |
| -Схемы \<String [] >                       | Схемы таблиц для создания типов сущности для. Если этот параметр опущен, включаются все схемы.                                                                                                                                                             |
| -Таблицы \<String [] >                        | Для создания типов сущности для таблиц. Если этот параметр опущен, включаются все таблицы.                                                                                                                                                                         |
| -DataAnnotations                           | Атрибуты можно используйте для настройки модели (где это возможно). Если этот параметр опущен, используется только текучего API.                                                                                                                                                      |
| -UseDatabaseNames                          | Используйте имена таблиц и столбцов, так же, как в базе данных. Если этот параметр опущен, имена баз данных меняется на более точно соответствовать соглашениям C# имя стиля.                                                                                       |
| -Force                                     | Перезаписывайте существующие файлы.                                                                                                                                                                                                                                               |

Пример

```powershell
Scaffold-DbContext "Server=(localdb)\mssqllocaldb;Database=Blogging;Trusted_Connection=True;" Microsoft.EntityFrameworkCore.SqlServer -OutputDir Models
```

Пример, который формирует шаблоны только указанных таблиц и создает контекст в отдельную папку с указанным именем.

```powershell
Scaffold-DbContext "Server=(localdb)\mssqllocaldb;Database=Blogging;Trusted_Connection=True;" Microsoft.EntityFrameworkCore.SqlServer -OutputDir Models -Tables "Blog","Post" -ContextDir Context -Context BlogContext
```

## <a name="script-migration"></a>Миграция скриптов

Формирует скрипт SQL, который применяет все изменения из одной выбранной миграции к другой выбранный миграции.

Параметры:

| Параметр           | Описание                                                                                                                                                                                                                |
|---------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| *-Из* \<строка >   | Начала миграции. Миграция может быть идентифицирован по имени или по идентификатору. Число 0 является особым случаем, это значит, что *перед первой миграции*. По умолчанию равно 0.                                                              |
| *-* \<Строка >     | Окончания миграции. По умолчанию к последней миграции.                                                                                                                                                                      |
| <nobr>-Идемпотентными</nobr>         | Создайте скрипт, который может использоваться в любой базе данных с любой миграции.                                                                                                                                                         |
| -Выходной \<строка >   | Файл для записи результата. Если этот параметр указан, файл создается с созданным именем в той же папке при создании файлов среды выполнения приложения, например: */obj/Debug/netcoreapp2.1/ghbkztfz.sql/*. |

> [!TIP]
> To, From, и выходные параметры поддерживают расширение функций клавиши tab.

В следующем примере создается скрипт для миграции это InitialCreate, используя имя миграции.

```powershell
Script-Migration -To InitialCreate
```

В следующем примере создается скрипт для всех операций миграции после миграции это InitialCreate, используя идентификатор миграции.

```powershell
Script-Migration -From 20180904195021_InitialCreate
```

## <a name="update-database"></a>Обновления базы данных

Обновляет базу данных, последнюю миграцию или указанного миграции.

| Параметр                             | Описание                                                                                                                                                                                                                                                     |
|---------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <nobr>*-Миграции* \<строка ></nobr>   | Целевой объект миграции. Миграция может быть идентифицирован по имени или по идентификатору. Число 0 является особым случаем, это значит, что *перед первой миграции* и вызывает всех операций переноса для отмены изменений. Если перенос не указан, команда по умолчанию к последней миграции. |

> [!TIP]
> Параметр миграции поддерживает расширение функций клавиши tab.

Следующий пример возвращает все миграции.

```powershell
Update-Database -Migration 0
```

Следующие примеры обновления базы данных для указанного миграции. Первый использует имя миграции, а второй использует идентификатор миграции:

```powershell
Update-Database -Migration InitialCreate
Update-Database -Migration 20180904195021_InitialCreate
```