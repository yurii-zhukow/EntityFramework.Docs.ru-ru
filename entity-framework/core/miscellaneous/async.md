---
title: Асинхронное программирование — EF Core
description: Асинхронное выполнение запросов и сохранение данных с помощью Entity Framework Core
author: roji
ms.date: 9/2/2020
uid: core/miscellaneous/async
ms.openlocfilehash: 78c109e9fd73dbb0451f9e29562799e4d22d66c9
ms.sourcegitcommit: 704240349e18b6404e5a809f5b7c9d365b152e2e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/16/2021
ms.locfileid: "100543358"
---
# <a name="asynchronous-programming"></a>Асинхронное программирование

Асинхронные операции Избегайте блокировки потока во время выполнения запроса в базе данных. Асинхронные операции важны для поддержания интерфейса реагирования в многофункциональных клиентских приложениях, а также для увеличения пропускной способности в веб-приложениях, когда они освобождают поток для обслуживания других запросов в веб-приложениях.

После .NET Standard EF Core предоставляет асинхронные аналоги для всех синхронных методов, выполняющих операции ввода-вывода. Они имеют те же эффекты, что и методы синхронизации, и могут использоваться с `async` `await` ключевыми словами C# и. Например, вместо использования DbContext. SaveChanges, который будет блокировать поток во время ввода-вывода базы данных, можно использовать DbContext. SaveChangesAsync:

[!code-csharp[Main](../../../samples/core/Miscellaneous/Async/Program.cs#SaveChangesAsync)]

Дополнительные сведения см. [в разделе Общие документы по асинхронному программированию C#](/dotnet/csharp/async).

> [!WARNING]
> EF Core не поддерживает выполнение нескольких параллельных операций в одном экземпляре контекста. Следует подождать завершения одной операции, прежде чем запускать следующую. Для этого обычно нужно указать ключевое слово `await` в каждой асинхронной операции.

> [!WARNING]
> В асинхронной реализации [Microsoft. Data. SqlClient](https://github.com/dotnet/SqlClient) возникают некоторые известные проблемы (например, [#593](https://github.com/dotnet/SqlClient/issues/593), [#601](https://github.com/dotnet/SqlClient/issues/601)и др.).

> [!NOTE]
> EF Core передает токены отмены в используемый базовый поставщик базы данных (например, Microsoft. Data. SqlClient). Эти токены могут быть или не учитываться. обратитесь к документации поставщика базы данных.

## <a name="async-linq-operators"></a>Асинхронные операторы LINQ

Чтобы обеспечить асинхронное выполнение запросов LINQ, EF Core предоставляет набор асинхронных методов расширения, которые выполняют запрос и возвращают результаты. Эти аналоги со стандартными синхронными операторами LINQ включают Толистасинк, Синглеасинк, Асасинценумерабле и т. д.:

[!code-csharp[Main](../../../samples/core/Miscellaneous/Async/Program.cs#ToListAsync)]

Обратите внимание, что отсутствуют асинхронные версии некоторых операторов LINQ, таких как WHERE или OrderBy, поскольку они создают только дерево выражений LINQ и не вызывают выполнение запроса в базе данных. Только операторы, которые вызывают выполнение запроса, имеют асинхронные аналоги.

> [!IMPORTANT]
> Асинхронные методы расширения EF Core определяются в пространстве имен `Microsoft.EntityFrameworkCore`. Это пространство имен необходимо импортировать, чтобы методы стали доступными.

## <a name="client-side-async-linq-operators"></a>Асинхронные операторы LINQ на стороне клиента

Операторы Async LINQ, описанные выше, можно использовать только в запросах EF. их нельзя использовать с запросом LINQ to Objects на стороне клиента. Для выполнения асинхронных операций LINQ на стороне клиента за пределами EF используется [пакет System. LINQ. Async](https://www.nuget.org/packages/System.Linq.Async); Этот пакет может быть особенно полезен для выполнения операций на клиенте, которые не могут быть преобразованы для ознакомления на сервере.

К сожалению, обращение к System. Interactive. Async приводит к неоднозначности ошибок компиляции вызова для операторов LINQ, применяемых к Дбсетс EF; Это затрудняет использование в одном проекте как EF, так и System. Interactive. Async. Чтобы обойти эту ошибку, добавьте Аскуерябле в DbSet:

[!code-csharp[Main](../../../samples/core/Miscellaneous/AsyncWithSystemInteractive/Program.cs#SystemInteractiveAsync)]
