---
title: "Обновление с предыдущих версий до 2 Core EF - EF Core"
author: divega
ms.author: divega
ms.date: 8/13/2017
ms.assetid: 8BD43C8C-63D9-4F3A-B954-7BC518A1B7DB
ms.technology: entity-framework-core
uid: core/miscellaneous/1x-2x-upgrade
ms.openlocfilehash: 0bd1ea2476621f826cca7d4a526a49a1b902acf8
ms.sourcegitcommit: 860ec5d047342fbc4063a0de881c9861cc1f8813
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/05/2017
---
# <a name="upgrading-applications-from-previous-versions-to-ef-core-20"></a><span data-ttu-id="91274-102">Обновление приложений предыдущих версий 2.0 EF Core</span><span class="sxs-lookup"><span data-stu-id="91274-102">Upgrading applications from previous versions to EF Core 2.0</span></span>

## <a name="procedures-common-to-all-applications"></a><span data-ttu-id="91274-103">Процедуры, общие для всех приложений</span><span class="sxs-lookup"><span data-stu-id="91274-103">Procedures Common to All Applications</span></span>

<span data-ttu-id="91274-104">Может потребоваться обновление существующего приложения в EF Core 2.0:</span><span class="sxs-lookup"><span data-stu-id="91274-104">Updating an existing application to EF Core 2.0 may require:</span></span>

1. <span data-ttu-id="91274-105">Обновление приложения, поддерживающего .NET 2.0 стандартная целевой платформы .NET.</span><span class="sxs-lookup"><span data-stu-id="91274-105">Upgrading the target .NET platform of the application to one that supports .NET Standard 2.0.</span></span> <span data-ttu-id="91274-106">В разделе [поддерживаемые платформы](../platforms/index.md) для получения дополнительных сведений.</span><span class="sxs-lookup"><span data-stu-id="91274-106">See [Supported Platforms](../platforms/index.md) for more details.</span></span>

2. <span data-ttu-id="91274-107">Определения поставщика для целевой базы данных, совместимый с EF Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="91274-107">Identify a provider for the target database which is compatible with EF Core 2.0.</span></span> <span data-ttu-id="91274-108">В разделе [EF Core 2.0 требуется поставщик 2.0 базы данных](#ef-core-20-requires-a-20-database-provider) ниже.</span><span class="sxs-lookup"><span data-stu-id="91274-108">See [EF Core 2.0 requires a 2.0 database provider](#ef-core-20-requires-a-20-database-provider) below.</span></span>

3. <span data-ttu-id="91274-109">Обновление всех пакетов EF Core (среда выполнения и инструментарий) 2.0.</span><span class="sxs-lookup"><span data-stu-id="91274-109">Upgrading all the EF Core packages (runtime and tooling) to 2.0.</span></span> <span data-ttu-id="91274-110">Ссылаться на [Установка основных компонентов EF](../get-started/install/index.md) для получения дополнительных сведений.</span><span class="sxs-lookup"><span data-stu-id="91274-110">Refer to [Installing EF Core](../get-started/install/index.md) for more details.</span></span>

4. <span data-ttu-id="91274-111">Внесите изменения необходимый код для компенсации критические изменения.</span><span class="sxs-lookup"><span data-stu-id="91274-111">Make any necessary code changes to compensate for breaking changes.</span></span> <span data-ttu-id="91274-112">В разделе [критические изменения](#breaking-changes) ниже, в разделе для получения дополнительных сведений.</span><span class="sxs-lookup"><span data-stu-id="91274-112">See the [Breaking Changes](#breaking-changes) section below for more details.</span></span>

## <a name="aspnet-core-applications"></a><span data-ttu-id="91274-113">Приложения ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="91274-113">ASP.NET Core applications</span></span>

1. <span data-ttu-id="91274-114">См. в частности [новый шаблон для инициализации поставщика службы приложения](#new-way-of-getting-application-services) описано ниже.</span><span class="sxs-lookup"><span data-stu-id="91274-114">See in particular the [new pattern for initializing the application's service provider](#new-way-of-getting-application-services) described below.</span></span>

> [!TIP]  
> <span data-ttu-id="91274-115">По внедрению этого нового шаблона. при обновлении приложений до версии 2.0 настоятельно рекомендуется необходима функций продукта, как Entity Framework Core миграции для работы.</span><span class="sxs-lookup"><span data-stu-id="91274-115">The adoption of this new pattern when updating applications to 2.0 is highly recommended and is required in order for product features like Entity Framework Core Migrations to work.</span></span> <span data-ttu-id="91274-116">Типичная альтернатива — [реализовать *IDesignTimeDbContextFactory\<TContext >*](configuring-dbcontext.md#using-idesigntimedbcontextfactorytcontext).</span><span class="sxs-lookup"><span data-stu-id="91274-116">The other common alternative is to [implement *IDesignTimeDbContextFactory\<TContext>*](configuring-dbcontext.md#using-idesigntimedbcontextfactorytcontext).</span></span>

2. <span data-ttu-id="91274-117">Приложения, предназначенные для ASP.NET Core 2.0 можно использовать EF Core 2.0 без дополнительных зависимостей, кроме базы данных сторонних поставщиков.</span><span class="sxs-lookup"><span data-stu-id="91274-117">Applications targeting ASP.NET Core 2.0 can use EF Core 2.0 without additional dependencies besides third party database providers.</span></span> <span data-ttu-id="91274-118">Тем не менее приложения, предназначенные для предыдущих версий ASP.NET Core нужно обновлять до Core ASP.NET 2.0 для использования EF Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="91274-118">However, applications targeting previous versions of ASP.NET Core need to upgrade to ASP.NET Core 2.0 in order to use EF Core 2.0.</span></span> <span data-ttu-id="91274-119">Подробнее об обновлении приложений ASP.NET Core 2.0 [ASP.NET основной документацией по этой теме](https://docs.microsoft.com/aspnet/core/migration/1x-to-2x/).</span><span class="sxs-lookup"><span data-stu-id="91274-119">For more details on upgrading ASP.NET Core applications to 2.0 see [the ASP.NET Core documentation on the subject](https://docs.microsoft.com/aspnet/core/migration/1x-to-2x/).</span></span>

## <a name="breaking-changes"></a><span data-ttu-id="91274-120">Критические изменения</span><span class="sxs-lookup"><span data-stu-id="91274-120">Breaking Changes</span></span>

<span data-ttu-id="91274-121">Мы предприняли возможности, чтобы значительно уточнить наши существующие интерфейсы и поведения в версии 2.0.</span><span class="sxs-lookup"><span data-stu-id="91274-121">We have taken the opportunity to significantly refine our existing APIs and behaviors in 2.0.</span></span> <span data-ttu-id="91274-122">Есть несколько улучшений, что может потребовать изменения существующего кода приложений, несмотря на то, что мы считаем, что для большинства приложений влияние будет низким, в большинстве случаев требуется просто повторной компиляции и минимальными изменениями интерактивная заменить устаревшие API-интерфейсы.</span><span class="sxs-lookup"><span data-stu-id="91274-122">There are a few improvements that can require modifying existing application code, although we believe that for the majority of applications the impact will be low, in most cases requiring just recompilation and minimal guided changes to replace obsolete APIs.</span></span>

### <a name="new-way-of-getting-application-services"></a><span data-ttu-id="91274-123">Новый способ начала работы службы приложений</span><span class="sxs-lookup"><span data-stu-id="91274-123">New way of getting application services</span></span>

<span data-ttu-id="91274-124">Рекомендуемый шаблон для веб-приложений ASP.NET Core был обновлен для 2.0, в результате которого было передано EF Core, используемой в 1.x логики во время разработки.</span><span class="sxs-lookup"><span data-stu-id="91274-124">The recommended pattern for ASP.NET Core web applications has been updated for 2.0 in a way that broke the design-time logic EF Core used in 1.x.</span></span> <span data-ttu-id="91274-125">Ранее во время разработки EF Core будет выполнена попытка вызвать `Startup.ConfigureServices` напрямую, чтобы получить доступ к поставщику приложения службы.</span><span class="sxs-lookup"><span data-stu-id="91274-125">Previously at design-time, EF Core would try to invoke `Startup.ConfigureServices` directly in order to access the application's service provider.</span></span> <span data-ttu-id="91274-126">В ASP.NET 2.0 основной конфигурации инициализируется за пределами `Startup` класса.</span><span class="sxs-lookup"><span data-stu-id="91274-126">In ASP.NET Core 2.0, Configuration is initialized outside of the `Startup` class.</span></span> <span data-ttu-id="91274-127">Приложения, использующие EF Core обычно доступа их строка подключения от конфигурации, `Startup` сам по себе не является достаточной мерой.</span><span class="sxs-lookup"><span data-stu-id="91274-127">Applications using EF Core typically access their connection string from Configuration, so `Startup` by itself is no longer sufficient.</span></span> <span data-ttu-id="91274-128">При обновлении приложения ASP.NET Core 1.x, с помощью EF основных средств может появиться следующая ошибка.</span><span class="sxs-lookup"><span data-stu-id="91274-128">If you upgrade an ASP.NET Core 1.x application, you may receive the following error when using the EF Core tools.</span></span>

> <span data-ttu-id="91274-129">Конструктор без параметров не найден на «ApplicationContext».</span><span class="sxs-lookup"><span data-stu-id="91274-129">No parameterless constructor was found on 'ApplicationContext'.</span></span> <span data-ttu-id="91274-130">Добавьте конструктор для «ApplicationContext» или добавьте реализацию "IDesignTimeDbContextFactory&lt;ApplicationContext&gt;" в сборке «ApplicationContext»</span><span class="sxs-lookup"><span data-stu-id="91274-130">Either add a parameterless constructor to 'ApplicationContext' or add an implementation of 'IDesignTimeDbContextFactory&lt;ApplicationContext&gt;' in the same assembly as 'ApplicationContext'</span></span>

<span data-ttu-id="91274-131">Новый обработчик разработки был добавлен в шаблон ASP.NET Core 2.0 по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="91274-131">A new design-time hook has been added in ASP.NET Core 2.0's default template.</span></span> <span data-ttu-id="91274-132">Статический `Program.BuildWebHost` метод, который позволяет EF ядро, что позволяет получить доступ к поставщику службы приложения во время разработки.</span><span class="sxs-lookup"><span data-stu-id="91274-132">The static `Program.BuildWebHost` method enables EF Core to access the application's service provider at design time.</span></span> <span data-ttu-id="91274-133">Если вы обновляете приложение ASP.NET Core 1.x, будет необходимо обновить вы `Program` класс выглядеть следующим образом.</span><span class="sxs-lookup"><span data-stu-id="91274-133">If you are upgrading an ASP.NET Core 1.x application, you will need to update you `Program` class to resemble the following.</span></span>

``` csharp
using Microsoft.AspNetCore;
using Microsoft.AspNetCore.Hosting;

namespace AspNetCoreDotNetCore2._0App
{
    public class Program
    {
        public static void Main(string[] args)
        {
            BuildWebHost(args).Run();
        }

        public static IWebHost BuildWebHost(string[] args) =>
            WebHost.CreateDefaultBuilder(args)
                .UseStartup<Startup>()
                .Build();
    }
}
```

### <a name="idbcontextfactory-renamed"></a><span data-ttu-id="91274-134">Переименовать IDbContextFactory</span><span class="sxs-lookup"><span data-stu-id="91274-134">IDbContextFactory renamed</span></span>

<span data-ttu-id="91274-135">Чтобы поддерживать шаблоны для различных приложений и предоставлять пользователям больший контроль над тем, как их `DbContext` используется во время разработки, предоставлены, в прошлом `IDbContextFactory<TContext>` интерфейса.</span><span class="sxs-lookup"><span data-stu-id="91274-135">In order to support diverse application patterns and give users more control over how their `DbContext` is used at design time, we have, in the past, provided the `IDbContextFactory<TContext>` interface.</span></span> <span data-ttu-id="91274-136">Во время разработки EF основных средств будет обнаруживать реализации этого интерфейса в проекте и использовать его для создания `DbContext` объектов.</span><span class="sxs-lookup"><span data-stu-id="91274-136">At design-time, the EF Core tools will discover implementations of this interface in your project and use it to create `DbContext` objects.</span></span>

<span data-ttu-id="91274-137">Этот интерфейс имеет очень стандартное имя, что некоторые заблуждение попробуйте повторно использовать его для других `DbContext`-Создание сценариев.</span><span class="sxs-lookup"><span data-stu-id="91274-137">This interface had a very general name which mislead some users to try re-using it for other `DbContext`-creating scenarios.</span></span> <span data-ttu-id="91274-138">Они были перехвачено отключение защиты при средства EF попытался использовать свою реализацию во время разработки и причиной подобного команды `Update-Database` или `dotnet ef database update` к сбою.</span><span class="sxs-lookup"><span data-stu-id="91274-138">They were caught off guard when the EF Tools then tried to use their implementation at design-time and caused commands like `Update-Database` or `dotnet ef database update` to fail.</span></span>

<span data-ttu-id="91274-139">Для связи семантика строгого во время разработки этот интерфейс, чтобы была переименована `IDesignTimeDbContextFactory<TContext>`.</span><span class="sxs-lookup"><span data-stu-id="91274-139">In order to communicate the strong design-time semantics of this interface, we have renamed it to `IDesignTimeDbContextFactory<TContext>`.</span></span>

<span data-ttu-id="91274-140">2.0 выпуска `IDbContextFactory<TContext>` по-прежнему существует, но помечен как устаревший.</span><span class="sxs-lookup"><span data-stu-id="91274-140">For the 2.0 release the `IDbContextFactory<TContext>` still exists but is marked as obsolete.</span></span>

### <a name="dbcontextfactoryoptions-removed"></a><span data-ttu-id="91274-141">Удалить DbContextFactoryOptions</span><span class="sxs-lookup"><span data-stu-id="91274-141">DbContextFactoryOptions removed</span></span>

<span data-ttu-id="91274-142">Из-за изменения основных ASP.NET 2.0, описанные выше, мы обнаружили, что `DbContextFactoryOptions` был больше не нужны на новом `IDesignTimeDbContextFactory<TContext>` интерфейса.</span><span class="sxs-lookup"><span data-stu-id="91274-142">Because of the ASP.NET Core 2.0 changes described above, we found that `DbContextFactoryOptions` was no longer needed on the new `IDesignTimeDbContextFactory<TContext>` interface.</span></span> <span data-ttu-id="91274-143">Ниже приведены альтернативные варианты, вместо этого следует использовать.</span><span class="sxs-lookup"><span data-stu-id="91274-143">Here are the alternatives you should be using instead.</span></span>

<span data-ttu-id="91274-144">DbContextFactoryOptions</span><span class="sxs-lookup"><span data-stu-id="91274-144">DbContextFactoryOptions</span></span> | <span data-ttu-id="91274-145">Альтернатива</span><span class="sxs-lookup"><span data-stu-id="91274-145">Alternative</span></span>
--- | ---
<span data-ttu-id="91274-146">ApplicationBasePath</span><span class="sxs-lookup"><span data-stu-id="91274-146">ApplicationBasePath</span></span> | <span data-ttu-id="91274-147">AppContext.BaseDirectory</span><span class="sxs-lookup"><span data-stu-id="91274-147">AppContext.BaseDirectory</span></span>
<span data-ttu-id="91274-148">ContentRootPath</span><span class="sxs-lookup"><span data-stu-id="91274-148">ContentRootPath</span></span> | <span data-ttu-id="91274-149">Directory.GetCurrentDirectory()</span><span class="sxs-lookup"><span data-stu-id="91274-149">Directory.GetCurrentDirectory()</span></span>
<span data-ttu-id="91274-150">EnvironmentName</span><span class="sxs-lookup"><span data-stu-id="91274-150">EnvironmentName</span></span> | <span data-ttu-id="91274-151">Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT")</span><span class="sxs-lookup"><span data-stu-id="91274-151">Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT")</span></span>

### <a name="design-time-working-directory-changed"></a><span data-ttu-id="91274-152">Рабочий каталог во время разработки изменен</span><span class="sxs-lookup"><span data-stu-id="91274-152">Design-time working directory changed</span></span>

<span data-ttu-id="91274-153">ASP.NET 2.0 основных изменений также требуется рабочий каталог, используемый `dotnet ef` выравнивается рабочий каталог, используемый в Visual Studio при запуске приложения.</span><span class="sxs-lookup"><span data-stu-id="91274-153">The ASP.NET Core 2.0 changes also required the working directory used by `dotnet ef` to align with the working directory used by Visual Studio when running your application.</span></span> <span data-ttu-id="91274-154">Наблюдаемый побочным эффектом того, это является SQLite, что имена файлов теперь являются относительно каталога проекта, а не в выходной каталог, как был.</span><span class="sxs-lookup"><span data-stu-id="91274-154">One observable side effect of this is that SQLite filenames are now relative to the project directory and not the output directory like they used to be.</span></span>

### <a name="ef-core-20-requires-a-20-database-provider"></a><span data-ttu-id="91274-155">EF Core 2.0 требует поставщика 2.0 базы данных</span><span class="sxs-lookup"><span data-stu-id="91274-155">EF Core 2.0 requires a 2.0 database provider</span></span>

<span data-ttu-id="91274-156">EF Core 2.0 мы внесли многие упрощения и усовершенствования в базы данных поставщиков способом работы.</span><span class="sxs-lookup"><span data-stu-id="91274-156">For EF Core 2.0 we have made many simplifications and improvements in the way database providers work.</span></span> <span data-ttu-id="91274-157">Это означает, 1.0.x и 1.1.x поставщики не будет работать с EF Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="91274-157">This means that 1.0.x and 1.1.x providers will not work with EF Core 2.0.</span></span>

<span data-ttu-id="91274-158">Поставщики SQL Server и SQLite поставляются командой EF и версии 2.0, будут доступны как часть 2.0 выпуска.</span><span class="sxs-lookup"><span data-stu-id="91274-158">The SQL Server and SQLite providers are shipped by the EF team and 2.0 versions will be available as part of the 2.0 release.</span></span> <span data-ttu-id="91274-159">Открытая сторонних поставщиков для [SQL Compact](https://github.com/ErikEJ/EntityFramework.SqlServerCompact), [PostgreSQL](https://github.com/npgsql/Npgsql.EntityFrameworkCore.PostgreSQL), и [MySQL](https://github.com/PomeloFoundation/Pomelo.EntityFrameworkCore.MySql) обновляются для 2.0.</span><span class="sxs-lookup"><span data-stu-id="91274-159">The open-source third party providers for [SQL Compact](https://github.com/ErikEJ/EntityFramework.SqlServerCompact), [PostgreSQL](https://github.com/npgsql/Npgsql.EntityFrameworkCore.PostgreSQL), and [MySQL](https://github.com/PomeloFoundation/Pomelo.EntityFrameworkCore.MySql) are being updated for 2.0.</span></span> <span data-ttu-id="91274-160">Для других поставщиков обратитесь в службу модуля записи поставщика.</span><span class="sxs-lookup"><span data-stu-id="91274-160">For all other providers, please contact the provider writer.</span></span>

### <a name="logging-and-diagnostics-events-have-changed"></a><span data-ttu-id="91274-161">События ведения журнала и диагностики были изменены.</span><span class="sxs-lookup"><span data-stu-id="91274-161">Logging and Diagnostics events have changed</span></span>

<span data-ttu-id="91274-162">Примечание: эти изменения не должен влиять большая часть кода приложения.</span><span class="sxs-lookup"><span data-stu-id="91274-162">Note: these changes should not impact most application code.</span></span>

<span data-ttu-id="91274-163">Коды событий для отправки сообщений на [ILogger](https://github.com/aspnet/Logging/blob/dev/src/Microsoft.Extensions.Logging.Abstractions/ILogger.cs) были изменены в версии 2.0.</span><span class="sxs-lookup"><span data-stu-id="91274-163">The event IDs for messages sent to an [ILogger](https://github.com/aspnet/Logging/blob/dev/src/Microsoft.Extensions.Logging.Abstractions/ILogger.cs) have changed in 2.0.</span></span> <span data-ttu-id="91274-164">Идентификаторы событий являются уникальными в EF основного кода.</span><span class="sxs-lookup"><span data-stu-id="91274-164">The event IDs are now unique across EF Core code.</span></span> <span data-ttu-id="91274-165">Эти сообщения также выполнить стандартный шаблон структурированных ведения журнала, используемого, например MVC.</span><span class="sxs-lookup"><span data-stu-id="91274-165">These messages now also follow the standard pattern for structured logging used by, for example, MVC.</span></span>

<span data-ttu-id="91274-166">Категории ведения журнала также были изменены.</span><span class="sxs-lookup"><span data-stu-id="91274-166">Logger categories have also changed.</span></span> <span data-ttu-id="91274-167">Теперь хорошо известный набор категорий, доступных через [DbLoggerCategory](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/DbLoggerCategory.cs).</span><span class="sxs-lookup"><span data-stu-id="91274-167">There is now a well-known set of categories accessed through [DbLoggerCategory](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/DbLoggerCategory.cs).</span></span>

<span data-ttu-id="91274-168">[DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md) события теперь используют те же имена идентификатор события как соответствующие `ILogger` сообщений.</span><span class="sxs-lookup"><span data-stu-id="91274-168">[DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md) events now use the same event ID names as the corresponding `ILogger` messages.</span></span> <span data-ttu-id="91274-169">Полезные данные события будут все номинальные типы, производные от [EventData](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Diagnostics/EventData.cs).</span><span class="sxs-lookup"><span data-stu-id="91274-169">The event payloads are all nominal types derived from [EventData](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Diagnostics/EventData.cs).</span></span>

<span data-ttu-id="91274-170">Идентификаторы событий, категории и типы полезных данных описаны в [CoreEventId](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Diagnostics/CoreEventId.cs) и [RelationalEventId](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore.Relational/Diagnostics/RelationalEventId.cs) классы.</span><span class="sxs-lookup"><span data-stu-id="91274-170">Event IDs, payload types, and categories are documented in the [CoreEventId](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Diagnostics/CoreEventId.cs) and the [RelationalEventId](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore.Relational/Diagnostics/RelationalEventId.cs) classes.</span></span>

<span data-ttu-id="91274-171">Идентификаторы также были перемещены из Microsoft.EntityFrameworkCore.Infraestructure Microsoft.EntityFrameworkCore.Diagnostics пространство имен.</span><span class="sxs-lookup"><span data-stu-id="91274-171">IDs have also moved from Microsoft.EntityFrameworkCore.Infraestructure to the new Microsoft.EntityFrameworkCore.Diagnostics namespace.</span></span>

### <a name="ef-core-relational-metadata-api-changes"></a><span data-ttu-id="91274-172">Изменения реляционных метаданных API Core EF</span><span class="sxs-lookup"><span data-stu-id="91274-172">EF Core relational metadata API changes</span></span>

<span data-ttu-id="91274-173">EF Core 2.0 теперь будет построен другой [Тип IModel](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IModel.cs) для каждого используемого разных поставщика.</span><span class="sxs-lookup"><span data-stu-id="91274-173">EF Core 2.0 will now build a different [IModel](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IModel.cs) for each different provider being used.</span></span> <span data-ttu-id="91274-174">Это обычно прозрачно для приложения.</span><span class="sxs-lookup"><span data-stu-id="91274-174">This is usually transparent to the application.</span></span> <span data-ttu-id="91274-175">Это добиться Упрощение интерфейсов API метаданных более низкого уровня, таким образом, что любой доступ к _основные понятия реляционных метаданных_ всегда устанавливается путем вызова `.Relational` вместо `.SqlServer`, `.Sqlite`и т. д. Например код 1.1.x следующим образом:</span><span class="sxs-lookup"><span data-stu-id="91274-175">This has facilitated a simplification of lower-level metadata APIs such that any access to _common relational metadata concepts_ is always made through a call to `.Relational` instead of `.SqlServer`, `.Sqlite`, etc. For example, 1.1.x code like this:</span></span>

``` csharp
var tableName = context.Model.FindEntityType(typeof(User)).SqlServer().TableName;
```

<span data-ttu-id="91274-176">Теперь должен быть записан следующим образом:</span><span class="sxs-lookup"><span data-stu-id="91274-176">Should now be written like this:</span></span>

``` csharp
var tableName = context.Model.FindEntityType(typeof(User)).Relational().TableName;
```

<span data-ttu-id="91274-177">Вместо того чтобы использовать методы, такие как `ForSqlServerToTable`, методы расширения теперь доступны для записи условного кода на основании текущего поставщика используется.</span><span class="sxs-lookup"><span data-stu-id="91274-177">Instead of using methods like `ForSqlServerToTable`, extension methods are now available to write conditional code based on the current provider in use.</span></span> <span data-ttu-id="91274-178">Например:</span><span class="sxs-lookup"><span data-stu-id="91274-178">For example:</span></span>

```C#
modelBuilder.Entity<User>().ToTable(
    Database.IsSqlServer() ? "SqlServerName" : "OtherName");
```

<span data-ttu-id="91274-179">Обратите внимание, что это изменение применяется только к API-интерфейсов и метаданные, определенные для _все_ реляционных поставщиков.</span><span class="sxs-lookup"><span data-stu-id="91274-179">Note that this change only applies to APIs/metadata that is defined for _all_ relational providers.</span></span> <span data-ttu-id="91274-180">API и метаданных не меняется при он определяется только один поставщик.</span><span class="sxs-lookup"><span data-stu-id="91274-180">The API and metadata remains the same when it is specific to only a single provider.</span></span> <span data-ttu-id="91274-181">Например, кластеризованные индексы относятся к SQL Sever, поэтому `ForSqlServerIsClustered` и `.SqlServer().IsClustered()` необходимо использовать.</span><span class="sxs-lookup"><span data-stu-id="91274-181">For example, clustered indexes are specific to SQL Sever, so `ForSqlServerIsClustered` and  `.SqlServer().IsClustered()` must still be used.</span></span>

### <a name="dont-take-control-of-the-ef-service-provider"></a><span data-ttu-id="91274-182">Не берет на себя управление EF поставщика услуг</span><span class="sxs-lookup"><span data-stu-id="91274-182">Don’t take control of the EF service provider</span></span>

<span data-ttu-id="91274-183">EF Core использует внутреннюю `IServiceProvider` (т. е. контейнер внедрения зависимостей) для своей внутренней реализации.</span><span class="sxs-lookup"><span data-stu-id="91274-183">EF Core uses an internal `IServiceProvider` (i.e. a dependency injection container) for its internal implementation.</span></span> <span data-ttu-id="91274-184">Приложения следует разрешать EF основных компонентов для создания и управления этим поставщиком, за исключением того, в особых случаях.</span><span class="sxs-lookup"><span data-stu-id="91274-184">Applications should allow EF Core to create and manage this provider except in special cases.</span></span> <span data-ttu-id="91274-185">Настоятельно рекомендуется удалить все вызовы `UseInternalServiceProvider`.</span><span class="sxs-lookup"><span data-stu-id="91274-185">Strongly consider removing any calls to `UseInternalServiceProvider`.</span></span> <span data-ttu-id="91274-186">Если приложению требуется вызывать `UseInternalServiceProvider`, затем попробуйте [регистрации проблемы](https://github.com/aspnet/EntityFramework/Issues) так мы можно исследовать другие способы обработки вашего сценария.</span><span class="sxs-lookup"><span data-stu-id="91274-186">If an application does need to call `UseInternalServiceProvider`, then please consider [filing an issue](https://github.com/aspnet/EntityFramework/Issues) so we can investigate other ways to handle your scenario.</span></span>

<span data-ttu-id="91274-187">Вызов `AddEntityFramework`, `AddEntityFrameworkSqlServer`, т. д. требуется только в коде приложения `UseInternalServiceProvider` также называется.</span><span class="sxs-lookup"><span data-stu-id="91274-187">Calling `AddEntityFramework`, `AddEntityFrameworkSqlServer`, etc. is not required by application code unless `UseInternalServiceProvider` is also called.</span></span> <span data-ttu-id="91274-188">Удалите все существующие вызовы `AddEntityFramework` или `AddEntityFrameworkSqlServer`, т. д. `AddDbContext` следует по-прежнему использовать так же как и раньше.</span><span class="sxs-lookup"><span data-stu-id="91274-188">Remove any existing calls to `AddEntityFramework` or `AddEntityFrameworkSqlServer`, etc. `AddDbContext` should still be used in the same way as before.</span></span>

### <a name="in-memory-databases-must-be-named"></a><span data-ttu-id="91274-189">Должен иметь имя базы данных в памяти</span><span class="sxs-lookup"><span data-stu-id="91274-189">In-memory databases must be named</span></span>

<span data-ttu-id="91274-190">Глобальные без имени базы данных в памяти было удалено, а вместо этого должны иметь имена всех баз данных в памяти.</span><span class="sxs-lookup"><span data-stu-id="91274-190">The global unnamed in-memory database has been removed and instead all in-memory databases must be named.</span></span> <span data-ttu-id="91274-191">Например:</span><span class="sxs-lookup"><span data-stu-id="91274-191">For example:</span></span>

``` csharp
optionsBuilder.UseInMemoryDatabase("MyDatabase");
```

<span data-ttu-id="91274-192">Это создает и использует базу данных с именем «MyDatabase».</span><span class="sxs-lookup"><span data-stu-id="91274-192">This creates/uses a database with the name “MyDatabase”.</span></span> <span data-ttu-id="91274-193">Если `UseInMemoryDatabase` будет вызван повторно с тем же именем, то будет использоваться одну и ту же базу данных в памяти, что позволяет совместно использоваться несколькими экземплярами контекста.</span><span class="sxs-lookup"><span data-stu-id="91274-193">If `UseInMemoryDatabase` is called again with the same name, then the same in-memory database will be used, allowing it to be shared by multiple context instances.</span></span>

### <a name="read-only-api-changes"></a><span data-ttu-id="91274-194">Изменения API-Интерфейс только для чтения</span><span class="sxs-lookup"><span data-stu-id="91274-194">Read-only API changes</span></span>

<span data-ttu-id="91274-195">`IsReadOnlyBeforeSave`, `IsReadOnlyAferSave`, и `IsStoreGeneratedAlways` были устарел и заменен [BeforeSaveBehavior](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IProperty.cs#L39) и [AfterSaveBehavior](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IProperty.cs#L55).</span><span class="sxs-lookup"><span data-stu-id="91274-195">`IsReadOnlyBeforeSave`, `IsReadOnlyAferSave`, and `IsStoreGeneratedAlways` have been obsoleted and replaced with [BeforeSaveBehavior](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IProperty.cs#L39) and [AfterSaveBehavior](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IProperty.cs#L55).</span></span> <span data-ttu-id="91274-196">Эти поведения применяются к любому свойству (не только свойства, формируемым хранилищем) и определите, каким образом следует использовать значение свойства при вставке в строку базы данных (`BeforeSaveBehavior`) или при обновлении существующей базы данных строки (`AfterSaveBehavior`).</span><span class="sxs-lookup"><span data-stu-id="91274-196">These behaviors apply to any property (not only store-generated properties) and determine how the value of the property should be used when inserting into a database row (`BeforeSaveBehavior`) or when updating an existing database row (`AfterSaveBehavior`).</span></span>

<span data-ttu-id="91274-197">Свойства помечены как [ValueGenerated.OnAddOrUpdate](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/ValueGenerated.cs) (например, для вычисляемых столбцов) по умолчанию игнорирует любые текущее значение для свойства.</span><span class="sxs-lookup"><span data-stu-id="91274-197">Properties marked as [ValueGenerated.OnAddOrUpdate](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/ValueGenerated.cs) (e.g. for computed columns) will by default ignore any value currently set on the property.</span></span> <span data-ttu-id="91274-198">Это означает, что сформированное хранилищем значение будет получаться независимо от того задать или изменить на Отслеживаемая сущность любое значение.</span><span class="sxs-lookup"><span data-stu-id="91274-198">This means that a store-generated value will always be obtained regardless of whether any value has been set or modified on the tracked entity.</span></span> <span data-ttu-id="91274-199">Это можно изменить, задав другой `Before\AfterSaveBehavior`.</span><span class="sxs-lookup"><span data-stu-id="91274-199">This can be changed by setting a different `Before\AfterSaveBehavior`.</span></span>

### <a name="new-clientsetnull-delete-behavior"></a><span data-ttu-id="91274-200">Новое поведение удаления ClientSetNull</span><span class="sxs-lookup"><span data-stu-id="91274-200">New ClientSetNull delete behavior</span></span>

<span data-ttu-id="91274-201">В предыдущих выпусках [DeleteBehavior.Restrict](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/DeleteBehavior.cs) бы поведение для сущностей отслеживаются контекстом нескольких закрытых сопоставленная `SetNull` семантику.</span><span class="sxs-lookup"><span data-stu-id="91274-201">In previous releases, [DeleteBehavior.Restrict](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/DeleteBehavior.cs) had a behavior for entities tracked by the context that more closed matched `SetNull` semantics.</span></span> <span data-ttu-id="91274-202">В версии 2.0 основные EF новый `ClientSetNull` представлена поведение по умолчанию для связей, необязательно.</span><span class="sxs-lookup"><span data-stu-id="91274-202">In EF Core 2.0, a new `ClientSetNull` behavior has been introduced as the default for optional relationships.</span></span> <span data-ttu-id="91274-203">Такое поведение влечет `SetNull` семантику для отслеживаемых объектов и `Restrict` поведение для баз данных, созданных с помощью EF Core.</span><span class="sxs-lookup"><span data-stu-id="91274-203">This behavior has `SetNull` semantics for tracked entities and `Restrict` behavior for databases created using EF Core.</span></span> <span data-ttu-id="91274-204">Опыт это ожидалось или чаще поведения для отслеживаемых объектов и базы данных.</span><span class="sxs-lookup"><span data-stu-id="91274-204">In our experience, these are the most expected/useful behaviors for tracked entities and the database.</span></span> <span data-ttu-id="91274-205">`DeleteBehavior.Restrict`Теперь учитывается для отслеживаемых объектов, при установке для связи необязательно.</span><span class="sxs-lookup"><span data-stu-id="91274-205">`DeleteBehavior.Restrict` is now honored for tracked entities when set for optional relationships.</span></span>

### <a name="provider-design-time-packages-removed"></a><span data-ttu-id="91274-206">Удалить пакетов во время разработки поставщика</span><span class="sxs-lookup"><span data-stu-id="91274-206">Provider design-time packages removed</span></span>

<span data-ttu-id="91274-207">`Microsoft.EntityFrameworkCore.Relational.Design` Пакет был удален.</span><span class="sxs-lookup"><span data-stu-id="91274-207">The `Microsoft.EntityFrameworkCore.Relational.Design` package has been removed.</span></span> <span data-ttu-id="91274-208">Ее содержимое был объединен в `Microsoft.EntityFrameworkCore.Relational` и `Microsoft.EntityFrameworkCore.Design`.</span><span class="sxs-lookup"><span data-stu-id="91274-208">It's contents were consolidated into `Microsoft.EntityFrameworkCore.Relational` and `Microsoft.EntityFrameworkCore.Design`.</span></span>

<span data-ttu-id="91274-209">Это распространяется на пакетов во время разработки поставщика.</span><span class="sxs-lookup"><span data-stu-id="91274-209">This propagates into the provider design-time packages.</span></span> <span data-ttu-id="91274-210">Эти пакеты (`Microsoft.EntityFrameworkCore.Sqlite.Design`, `Microsoft.EntityFrameworkCore.SqlServer.Design`, т. д.) были удалены и их содержимое, объединяются в пакеты основного поставщика.</span><span class="sxs-lookup"><span data-stu-id="91274-210">Those packages (`Microsoft.EntityFrameworkCore.Sqlite.Design`, `Microsoft.EntityFrameworkCore.SqlServer.Design`, etc.) were removed and their contents consolidated into the main provider packages.</span></span>

<span data-ttu-id="91274-211">Чтобы включить `Scaffold-DbContext` или `dotnet ef dbcontext scaffold` в EF Core 2.0, достаточно для ссылки на пакет одного поставщика:</span><span class="sxs-lookup"><span data-stu-id="91274-211">To enable `Scaffold-DbContext` or `dotnet ef dbcontext scaffold` in EF Core 2.0, you only need to reference the single provider package:</span></span>

``` xml
<PackageReference Include="Microsoft.EntityFrameworkCore.SqlServer"
    Version="2.0.0" />
<PackageReference Include="Microsoft.EntityFrameworkCore.Tools"
    Version="2.0.0"
    PrivateAssets="All" />
<DotNetCliToolReference Include="Microsoft.EntityFrameworkCore.Tools.DotNet"
    Version="2.0.0" />
```
