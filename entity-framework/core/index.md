---
title: Обзор Entity Framework Core — EF Core
description: Общие вводные сведения об Entity Framework Core
author: ajcvickers
ms.date: 9/20/2020
uid: core/index
ms.openlocfilehash: 011900b55bc941d6ae6a7ac8aca6001713088c69
ms.sourcegitcommit: c0e6a00b64c2dcd8acdc0fe6d1b47703405cdf09
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2020
ms.locfileid: "91210384"
---
# <a name="entity-framework-core"></a><span data-ttu-id="a44bd-103">Entity Framework Core</span><span class="sxs-lookup"><span data-stu-id="a44bd-103">Entity Framework Core</span></span>

<span data-ttu-id="a44bd-104">Entity Framework (EF) Core — это простая, кроссплатформенная и расширяемая версия популярной технологии доступа к данным Entity Framework [с открытым исходным кодом](https://github.com/aspnet/EntityFrameworkCore).</span><span class="sxs-lookup"><span data-stu-id="a44bd-104">Entity Framework (EF) Core is a lightweight, extensible, [open source](https://github.com/aspnet/EntityFrameworkCore) and cross-platform version of the popular Entity Framework data access technology.</span></span>

<span data-ttu-id="a44bd-105">EF Core может использоваться в качестве объектно-реляционного модуля сопоставления (O/RM), который:</span><span class="sxs-lookup"><span data-stu-id="a44bd-105">EF Core can serve as an object-relational mapper (O/RM), which:</span></span>

* <span data-ttu-id="a44bd-106">Позволяет разработчикам .NET работать с базой данных с помощью объектов .NET.</span><span class="sxs-lookup"><span data-stu-id="a44bd-106">Enables .NET developers to work with a database using .NET objects.</span></span>
* <span data-ttu-id="a44bd-107">Устраняет необходимость в большей части кода для доступа к данным, который обычно приходится писать.</span><span class="sxs-lookup"><span data-stu-id="a44bd-107">Eliminates the need for most of the data-access code that typically needs to be written.</span></span>

<span data-ttu-id="a44bd-108">EF Core поддерживает множество систем баз данных. Дополнительные сведения см. в разделе [Поставщики баз данных](xref:core/providers/index).</span><span class="sxs-lookup"><span data-stu-id="a44bd-108">EF Core supports many database engines, see [Database Providers](xref:core/providers/index) for details.</span></span>

## <a name="the-model"></a><span data-ttu-id="a44bd-109">Модель</span><span class="sxs-lookup"><span data-stu-id="a44bd-109">The model</span></span>

<span data-ttu-id="a44bd-110">В EF Core доступ к данным осуществляется с помощью модели.</span><span class="sxs-lookup"><span data-stu-id="a44bd-110">With EF Core, data access is performed using a model.</span></span> <span data-ttu-id="a44bd-111">Модель состоит из классов сущностей и объекта контекста, который представляет сеанс взаимодействия с базой данных.</span><span class="sxs-lookup"><span data-stu-id="a44bd-111">A model is made up of entity classes and a context object that represents a session with the database.</span></span> <span data-ttu-id="a44bd-112">Объект контекста позволяет выполнять запросы и сохранять данные.</span><span class="sxs-lookup"><span data-stu-id="a44bd-112">The context object allows querying and saving data.</span></span> <span data-ttu-id="a44bd-113">Дополнительные сведения см. в разделе [Создание модели](xref:core/modeling/index).</span><span class="sxs-lookup"><span data-stu-id="a44bd-113">For more information, see [Creating a Model](xref:core/modeling/index).</span></span>

<span data-ttu-id="a44bd-114">EF поддерживает следующие подходы к разработке моделей:</span><span class="sxs-lookup"><span data-stu-id="a44bd-114">EF supports the following model development approaches:</span></span>

* <span data-ttu-id="a44bd-115">Создание модели на основе существующей базы данных.</span><span class="sxs-lookup"><span data-stu-id="a44bd-115">Generate a model from an existing database.</span></span>
* <span data-ttu-id="a44bd-116">Написание кода модели вручную в соответствии с базой данных.</span><span class="sxs-lookup"><span data-stu-id="a44bd-116">Hand code a model to match the database.</span></span>
* <span data-ttu-id="a44bd-117">После создания модели используйте [Миграции EF](xref:core/managing-schemas/migrations/index) для создания базы данных на основе модели.</span><span class="sxs-lookup"><span data-stu-id="a44bd-117">Once a model is created, use [EF Migrations](xref:core/managing-schemas/migrations/index) to create a database from the model.</span></span> <span data-ttu-id="a44bd-118">Миграции позволяют развивать базу данных по мере изменения модели.</span><span class="sxs-lookup"><span data-stu-id="a44bd-118">Migrations allow evolving the database as the model changes.</span></span>

[!code-csharp[Main](../../samples/core/Intro/Model.cs)]

## <a name="querying"></a><span data-ttu-id="a44bd-119">Выполнение запроса</span><span class="sxs-lookup"><span data-stu-id="a44bd-119">Querying</span></span>

<span data-ttu-id="a44bd-120">Экземпляры классов сущностей извлекаются из базы данных с помощью [LINQ](/dotnet/csharp/programming-guide/concepts/linq/).</span><span class="sxs-lookup"><span data-stu-id="a44bd-120">Instances of your entity classes are retrieved from the database using Language [Integrated Query (LINQ)](/dotnet/csharp/programming-guide/concepts/linq/).</span></span> <span data-ttu-id="a44bd-121">Дополнительные сведения см. в разделе [Выполнение запросов к данным](xref:core/querying/index).</span><span class="sxs-lookup"><span data-stu-id="a44bd-121">For more information, see [Querying Data](xref:core/querying/index).</span></span>

[!code-csharp[Main](../../samples/core/Intro/Program.cs#Querying)]

## <a name="saving-data"></a><span data-ttu-id="a44bd-122">Сохранение данных</span><span class="sxs-lookup"><span data-stu-id="a44bd-122">Saving data</span></span>

<span data-ttu-id="a44bd-123">Для создания, удаления и изменения данных в базе данных используются экземпляры классов сущностей.</span><span class="sxs-lookup"><span data-stu-id="a44bd-123">Data is created, deleted, and modified in the database using instances of your entity classes.</span></span> <span data-ttu-id="a44bd-124">Дополнительные сведения см. в разделе [Сохранение данных](xref:core/saving/index).</span><span class="sxs-lookup"><span data-stu-id="a44bd-124">See [Saving Data](xref:core/saving/index) to learn more.</span></span>

[!code-csharp[Main](../../samples/core/Intro/Program.cs#SavingData)]

## <a name="ef-orm-considerations"></a><span data-ttu-id="a44bd-125">Рекомендации по технологиям ORM для EF</span><span class="sxs-lookup"><span data-stu-id="a44bd-125">EF ORM considerations</span></span>

<span data-ttu-id="a44bd-126">Хотя EF Core хорошо подходит для абстрагирования многих деталей при программировании, существуют некоторые рекомендации, которые применяются ко всем технологиям ORM и помогают избежать распространенных ошибок в рабочих приложениях.</span><span class="sxs-lookup"><span data-stu-id="a44bd-126">While EF Core is good at abstracting many programming details, there are some best practices applicable to any ORM that help to avoid common pitfalls in production apps:</span></span>

 - <span data-ttu-id="a44bd-127">Знания базового сервера базы данных на промежуточном уровне или выше необходимы для проектирования, отладки, профилирования и переноса данных в рабочих приложениях с высокой производительностью.</span><span class="sxs-lookup"><span data-stu-id="a44bd-127">Intermediate-level knowledge or higher of the underlying database server is essential to architect, debug, profile, and migrate data in high performance production apps.</span></span> <span data-ttu-id="a44bd-128">Например, знание первичных и внешних ключей, ограничений, индексов, нормализации, инструкций DML и DDL, типов данных, профилирования и т. д.</span><span class="sxs-lookup"><span data-stu-id="a44bd-128">For example, knowledge of primary and foreign keys, constraints, indexes, normalization, DML and DDL statements, data types, profiling, etc.</span></span>
- <span data-ttu-id="a44bd-129">Функциональное и интеграционное тестирование:  Важно реплицировать рабочую среду как можно точнее, чтобы:</span><span class="sxs-lookup"><span data-stu-id="a44bd-129">Functional and integration testing:  It's important to replicate the production environment as closely as possible to:</span></span>
  - <span data-ttu-id="a44bd-130">Находить проблемы в приложениях, которые отображаются только при использовании определенной версии или выпуска сервера базы данных.</span><span class="sxs-lookup"><span data-stu-id="a44bd-130">Find issues in the app that only show up when using a specific versions or edition of the database server .</span></span>
  - <span data-ttu-id="a44bd-131">Перехватывать критические изменения при обновлении EF Core и других зависимостей.</span><span class="sxs-lookup"><span data-stu-id="a44bd-131">Catch breaking changes when upgrading EF Core and other dependencies.</span></span> <span data-ttu-id="a44bd-132">Например, при добавлении или обновлении платформ, таких как ASP.NET Core, OData или Automapper.</span><span class="sxs-lookup"><span data-stu-id="a44bd-132">For example, adding or upgrading frameworks like ASP.NET Core, OData, or Automapper.</span></span> <span data-ttu-id="a44bd-133">Эти зависимости могут повлиять на EF Core неожиданным образом.</span><span class="sxs-lookup"><span data-stu-id="a44bd-133">These dependencies can affect EF Core in unexpected ways.</span></span>
- <span data-ttu-id="a44bd-134">Производительность и нагрузочное тестирование с репрезентативными нагрузками.</span><span class="sxs-lookup"><span data-stu-id="a44bd-134">Performance and stress testing with representative loads.</span></span> <span data-ttu-id="a44bd-135">Упрощенное использование некоторых функций затрудняет масштабирование.</span><span class="sxs-lookup"><span data-stu-id="a44bd-135">The naïve usage of some features doesn't scale well.</span></span> <span data-ttu-id="a44bd-136">К таким случаям относятся: использование Includes в нескольких коллекциях, интенсивное применение отложенной загрузки, условные запросы к неиндексированным столбцам, массовые обновления и вставки с использованием созданных хранилищем значений, отсутствие обработки параллелизма, крупные модели и недостаточная политика кэширования.</span><span class="sxs-lookup"><span data-stu-id="a44bd-136">For example, multiple collections Includes, heavy use of lazy loading, conditional queries on non-indexed columns, massive updates and inserts with store-generated values, lack of concurrency handling, large models, inadequate cache policy.</span></span>
- <span data-ttu-id="a44bd-137">Проверки безопасности: Например, обработка строк подключения и других секретов, разрешения базы данных для операций, не связанных с развертыванием, проверка ввода для необработанных запросов SQL, шифрование конфиденциальных данных.</span><span class="sxs-lookup"><span data-stu-id="a44bd-137">Security review: For example, handling of connection strings and other secrets, database permissions for non-deployment operation, input validation for raw SQL, encryption for sensitive data.</span></span>
- <span data-ttu-id="a44bd-138">Убедитесь, что ведение журнала и диагностика настроены в достаточной степени и в удобной форме.</span><span class="sxs-lookup"><span data-stu-id="a44bd-138">Make sure logging and diagnostics are sufficient and usable.</span></span> <span data-ttu-id="a44bd-139">Например, соответствующая конфигурация ведения журнала, теги запросов и Application Insights.</span><span class="sxs-lookup"><span data-stu-id="a44bd-139">For example, appropriate logging configuration, query tags, and Application Insights.</span></span>
- <span data-ttu-id="a44bd-140">Восстановление после ошибок.</span><span class="sxs-lookup"><span data-stu-id="a44bd-140">Error recovery.</span></span> <span data-ttu-id="a44bd-141">Проанализируйте непредвиденные ситуации для распространенных сценариев сбоев, такие как откат версий, резервные серверы, горизонтальное масштабирование и балансировка нагрузки, устранение атак типа "отказ в обслуживании" и резервное копирование данных.</span><span class="sxs-lookup"><span data-stu-id="a44bd-141">Prepare contingencies for common failure scenarios such as version rollback, fallback servers, scale-out and load balancing, DoS mitigation, and data backups.</span></span>
- <span data-ttu-id="a44bd-142">Развертывание и миграция приложений.</span><span class="sxs-lookup"><span data-stu-id="a44bd-142">Application deployment and migration.</span></span> <span data-ttu-id="a44bd-143">Спланируйте, как будет применяться миграция во время развертывания. Если миграция выполняется при запуске приложения, на нее могут негативно повлиять проблемы с параллелизмом, к тому же для нее потребуются более высокие разрешения по сравнению с обычной работой.</span><span class="sxs-lookup"><span data-stu-id="a44bd-143">Plan out how migrations are going to be applied during deployment; doing it at application start can suffer from concurrency issues and requires higher permissions than necessary for normal operation.</span></span> <span data-ttu-id="a44bd-144">Используйте промежуточное хранение, чтобы упростить восстановление после неустранимых ошибок во время миграции.</span><span class="sxs-lookup"><span data-stu-id="a44bd-144">Use staging to facilitate recovery from fatal errors during migration.</span></span> <span data-ttu-id="a44bd-145">Дополнительные сведения см. в разделе [Применение миграций](xref:core/managing-schemas/migrations/applying).</span><span class="sxs-lookup"><span data-stu-id="a44bd-145">For more information, see [Applying Migrations](xref:core/managing-schemas/migrations/applying).</span></span>
- <span data-ttu-id="a44bd-146">Подробное изучение и тестирование созданных миграций.</span><span class="sxs-lookup"><span data-stu-id="a44bd-146">Detailed examination and testing of generated migrations.</span></span> <span data-ttu-id="a44bd-147">Необходимо тщательно протестировать миграции перед применением к рабочим данным.</span><span class="sxs-lookup"><span data-stu-id="a44bd-147">Migrations should be thoroughly tested before being applied to production data.</span></span> <span data-ttu-id="a44bd-148">Форму схемы и типы столбцов невозможно легко изменить, если таблицы содержат рабочие данные.</span><span class="sxs-lookup"><span data-stu-id="a44bd-148">The shape of the schema and the column types cannot be easily changed once the tables contain production data.</span></span> <span data-ttu-id="a44bd-149">Например, в SQL Server `nvarchar(max)` и `decimal(18, 2)` редко являются наиболее подходящими типами для столбцов, сопоставленных со строковыми и десятичными свойствами. Однако в EF они используются по умолчанию, так как EF не знает о вашем конкретном сценарии.</span><span class="sxs-lookup"><span data-stu-id="a44bd-149">For example, on SQL Server, `nvarchar(max)` and `decimal(18, 2)` are rarely the best types for columns mapped to string and decimal properties, but those are the defaults that EF uses because it doesn't have knowledge of your specific scenario.</span></span>

## <a name="next-steps"></a><span data-ttu-id="a44bd-150">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="a44bd-150">Next steps</span></span>

<span data-ttu-id="a44bd-151">Вводные руководства см. в разделе [Начало работы с Entity Framework Core](xref:core/get-started/index).</span><span class="sxs-lookup"><span data-stu-id="a44bd-151">For introductory tutorials, see [Getting Started with Entity Framework Core](xref:core/get-started/index).</span></span>
