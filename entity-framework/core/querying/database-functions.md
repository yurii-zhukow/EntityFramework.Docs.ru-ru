---
title: Функции базы данных в EF Core
description: Сведения о функциях базы данных, поддерживаемых в преобразовании запросов EF Core
author: smitpatel
ms.date: 11/10/2020
uid: core/querying/database-functions
ms.openlocfilehash: 34ced2a602168f6ed84763c046ef581cb87026e8
ms.sourcegitcommit: 42bbf7f68e92c364c5fff63092d3eb02229f568d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/11/2020
ms.locfileid: "94503786"
---
# <a name="database-functions"></a>Функции базы данных

Функции базы данных являются эквивалентом [методов C#](/dotnet/csharp/programming-guide/classes-and-structs/methods) для базы данных. Функцию базы данных можно вызывать без параметров или с несколькими параметрами. Она будет вычислять результат на основе значений параметров. Большинство баз данных, которые для запросов используют SQL, также поддерживают функции базы данных. Итак, SQL, созданный преобразованием запросов EF Core, также позволяет вызывать функции базы данных. Методы C# не должны преобразовывать исключительно в функции базы данных в EF Core.

- Метод C# может не иметь эквивалентную функцию базы данных.
  - Метод<xref:System.String.IsNullOrEmpty%2A?displayProperty=nameWithType> преобразует в проверку значения NULL и сравнение с пустой строкой в базе данных вместо функции.
  - Метод<xref:System.String.Equals(System.String,System.StringComparison)?displayProperty=nameWithType> не имеет эквивалента в базе данных, поскольку сравнение строк не может быть представлено или легко воспроизведено в базе данных.
- Функция базы данных может не иметь эквивалентный метод C#. Оператор `??` в C#, который не имеет какого-либо метода, преобразуется в базе данных в функцию `COALESCE`.

## <a name="types-of-database-functions"></a>Типы функций базы данных

Создание SQL в EF Core поддерживает подмножество функций, которые можно использовать в базах данных. Это ограничение обусловлено возможностью представления запроса в LINQ для заданной функции базы данных. Кроме того, базы данных имеют разные типы поддержки функций базы данных, поэтому EF Core предоставляет универсальное подмножество. Поставщик базы данных может расширить создание SQL в EF Core, что позволит поддерживать большее количество шаблонов. Ниже приведены типы функций базы данных, которые EF Core поддерживает и уникально идентифицирует. Эти термины также помогают понять, какие преобразования встроены в поставщики EF Core.

### <a name="built-in-vs-user-defined-functions"></a>Сравнение встроенных и определяемых пользователем функций

Встроенные функции поставляются с базой данных, в то время как определяемые пользователем функции явно определяются пользователем в базе данных. Когда EF Core преобразует запросы для использования функций базы данных, он использует встроенные функции, чтобы обеспечить постоянную доступность функции в базе данных. Для правильного создания SQL в некоторых базах данных необходимо различать встроенные функции. Например, SqlServer требует, чтобы каждую определяемую пользователем функцию вызывали с помощью имени, заданного схемой. В то же время встроенные функции в SqlServer не имеют схемы. PostgreSQL определяет встроенную функцию в схеме `public`, но ее можно вызывать с помощью имен, заданных схемой.

### <a name="aggregate-vs-scalar-vs-table-valued-functions"></a>Сравнение агрегатных, скалярных функций и функций с табличным значением

- Скалярные функции принимают скалярные значения, например целые числа или строки, в качестве параметров и возвращают скалярное значение в качестве результата. Скалярные функции можно использовать в любом месте в SQL, где можно передавать скалярное значение.
- Агрегатные функции принимают поток скалярных значений в качестве параметров и возвращают скалярное значение в качестве результата. Агрегатные функции применяются ко всему результирующему набору запроса или к группе значений, созданных при применении оператора `GROUP BY`.
- Функции с табличным значением принимают скалярные значения в качестве параметров и возвращают поток строк в качестве результата. Функции с табличным значением используются в качестве источника данных таблицы в предложении `FROM`.

### <a name="niladic-functions"></a>Нуль-арные функции

Нуль-арные функции — это специальные функции базы данных, которые не имеют параметров и которые следует вызывать без круглых скобок. Они подобны доступу к свойствам и полям в экземпляре C#. Нуль-арные функции отличаются от функций без параметров, поскольку в последних требуются пустые скобки. Для функций базы данных, для которых всегда требуются скобки, не существует специального имени. Другое подмножество функций базы данных, основанное на количестве параметров, — это вариадические функции. Вариадические функции могут принимать разное количество параметров при вызове.

## <a name="database-function-mappings-in-ef-core"></a>Сопоставления функций базы данных в EF Core

EF Core поддерживает три разных способа сопоставления функций C# и функций базы данных.

### <a name="built-in-function-mapping"></a>Сопоставление встроенных функций

По умолчанию поставщики EF Core предоставляют сопоставления для различных встроенных функций над примитивными типами. Например, <xref:System.String.ToLower?displayProperty=nameWithType> преобразуется в `LOWER` в SqlServer. Эта функция позволяет пользователям легко создавать запросы в LINQ. Обычно в базе данных предоставляется преобразование, которое дает тот же результат, что и функция C#, что предоставляется на стороне клиента. Иногда, чтобы добиться этого, фактическое преобразование может оказаться более сложным, чем функция базы данных. В некоторых сценариях также предоставляется наиболее подходящее преобразование вместо соответствующей семантики C#. Эта же функция также используется для предоставления общих преобразований для некоторых элементов доступа членов C#. Например, <xref:System.String.Length?displayProperty=nameWithType> преобразуется в `LEN` в SqlServer. Помимо поставщиков, дополнительные преобразования могут также добавлять подключаемые модули записи. Такая расширяемость полезна, когда подключаемые модули добавляют поддержку нескольких типов в качестве примитивных типов и требуют преобразования методов.

### <a name="effunctions-mapping"></a>Сопоставление EF.Functions

Поскольку не все функции базы данных имеют эквивалентные функции C#, поставщики EF Core имеют специальные методы C# для вызова определенных функций базы данных. Эти методы определяются как методы расширения `EF.Functions` для использования в запросах LINQ. Эти методы относятся к конкретному поставщику, так как они тесно связаны с конкретными функциями базы данных. Поэтому метод, который работает для одного поставщика, скорее всего, не будет работать для других поставщиков. Кроме того, поскольку цель этих методов заключается в вызове функции базы данных в преобразованном запросе, попытка их вычисления на стороне клиента будет приводить к возникновению исключения.

### <a name="user-defined-function-mapping"></a>Сопоставление определяемых пользователем функций

Помимо сопоставлений, предоставляемых поставщиками EF Core, пользователи могут также определять пользовательское сопоставление. Определяемое пользователем сопоставление расширяет преобразование запросов в соответствии с потребностями пользователя. Эта функция полезна, если в базе данных есть определяемые пользователем функции, которые пользователь хочет вызвать из своего запроса LINQ.

## <a name="see-also"></a>См. также:

- [Сопоставления встроенных функций SqlServer](xref:core/providers/sql-server/functions)
- [Сопоставления встроенных функций SQLite](xref:core/providers/sqlite/functions)
- [Сопоставления встроенных функций Cosmos](xref:core/providers/cosmos/functions)
