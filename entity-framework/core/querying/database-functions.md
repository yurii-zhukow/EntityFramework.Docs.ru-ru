---
title: Функции базы данных в EF Core
description: Сведения о функциях базы данных, поддерживаемых в преобразовании запросов EF Core
author: smitpatel
ms.date: 11/10/2020
uid: core/querying/database-functions
ms.openlocfilehash: 34ced2a602168f6ed84763c046ef581cb87026e8
ms.sourcegitcommit: 42bbf7f68e92c364c5fff63092d3eb02229f568d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/11/2020
ms.locfileid: "94503786"
---
# <a name="database-functions"></a><span data-ttu-id="f47bf-103">Функции базы данных</span><span class="sxs-lookup"><span data-stu-id="f47bf-103">Database Functions</span></span>

<span data-ttu-id="f47bf-104">Функции базы данных являются эквивалентом [методов C#](/dotnet/csharp/programming-guide/classes-and-structs/methods) для базы данных.</span><span class="sxs-lookup"><span data-stu-id="f47bf-104">Database functions are the database equivalent of [C# methods](/dotnet/csharp/programming-guide/classes-and-structs/methods).</span></span> <span data-ttu-id="f47bf-105">Функцию базы данных можно вызывать без параметров или с несколькими параметрами. Она будет вычислять результат на основе значений параметров.</span><span class="sxs-lookup"><span data-stu-id="f47bf-105">A database function can be invoked with zero or more parameters and it computes the result based on the parameter values.</span></span> <span data-ttu-id="f47bf-106">Большинство баз данных, которые для запросов используют SQL, также поддерживают функции базы данных.</span><span class="sxs-lookup"><span data-stu-id="f47bf-106">Most databases, which use SQL for querying have support for database functions.</span></span> <span data-ttu-id="f47bf-107">Итак, SQL, созданный преобразованием запросов EF Core, также позволяет вызывать функции базы данных.</span><span class="sxs-lookup"><span data-stu-id="f47bf-107">So SQL generated by EF Core query translation also allows invoking database functions.</span></span> <span data-ttu-id="f47bf-108">Методы C# не должны преобразовывать исключительно в функции базы данных в EF Core.</span><span class="sxs-lookup"><span data-stu-id="f47bf-108">C# methods don't have to translate strictly to database functions in EF Core.</span></span>

- <span data-ttu-id="f47bf-109">Метод C# может не иметь эквивалентную функцию базы данных.</span><span class="sxs-lookup"><span data-stu-id="f47bf-109">A C# method may not have an equivalent database function.</span></span>
  - <span data-ttu-id="f47bf-110">Метод<xref:System.String.IsNullOrEmpty%2A?displayProperty=nameWithType> преобразует в проверку значения NULL и сравнение с пустой строкой в базе данных вместо функции.</span><span class="sxs-lookup"><span data-stu-id="f47bf-110"><xref:System.String.IsNullOrEmpty%2A?displayProperty=nameWithType> method translates to a null check and a comparison with an empty string in the database rather than a function.</span></span>
  - <span data-ttu-id="f47bf-111">Метод<xref:System.String.Equals(System.String,System.StringComparison)?displayProperty=nameWithType> не имеет эквивалента в базе данных, поскольку сравнение строк не может быть представлено или легко воспроизведено в базе данных.</span><span class="sxs-lookup"><span data-stu-id="f47bf-111"><xref:System.String.Equals(System.String,System.StringComparison)?displayProperty=nameWithType> method doesn't have database equivalent since string comparison can't be represented or mimicked easily in a database.</span></span>
- <span data-ttu-id="f47bf-112">Функция базы данных может не иметь эквивалентный метод C#.</span><span class="sxs-lookup"><span data-stu-id="f47bf-112">A database function may not have an equivalent C# method.</span></span> <span data-ttu-id="f47bf-113">Оператор `??` в C#, который не имеет какого-либо метода, преобразуется в базе данных в функцию `COALESCE`.</span><span class="sxs-lookup"><span data-stu-id="f47bf-113">The `??` operator in C#, which doesn't have any method, translates to the `COALESCE` function in the database.</span></span>

## <a name="types-of-database-functions"></a><span data-ttu-id="f47bf-114">Типы функций базы данных</span><span class="sxs-lookup"><span data-stu-id="f47bf-114">Types of database functions</span></span>

<span data-ttu-id="f47bf-115">Создание SQL в EF Core поддерживает подмножество функций, которые можно использовать в базах данных.</span><span class="sxs-lookup"><span data-stu-id="f47bf-115">EF Core SQL generation supports a subset of functions that can be used in databases.</span></span> <span data-ttu-id="f47bf-116">Это ограничение обусловлено возможностью представления запроса в LINQ для заданной функции базы данных.</span><span class="sxs-lookup"><span data-stu-id="f47bf-116">This limitation comes from the ability to represent a query in LINQ for the given database function.</span></span> <span data-ttu-id="f47bf-117">Кроме того, базы данных имеют разные типы поддержки функций базы данных, поэтому EF Core предоставляет универсальное подмножество.</span><span class="sxs-lookup"><span data-stu-id="f47bf-117">Further, each database has varying support of database functions, so EF Core provides a common subset.</span></span> <span data-ttu-id="f47bf-118">Поставщик базы данных может расширить создание SQL в EF Core, что позволит поддерживать большее количество шаблонов.</span><span class="sxs-lookup"><span data-stu-id="f47bf-118">A database provider is free to extend EF Core SQL generation to support more patterns.</span></span> <span data-ttu-id="f47bf-119">Ниже приведены типы функций базы данных, которые EF Core поддерживает и уникально идентифицирует.</span><span class="sxs-lookup"><span data-stu-id="f47bf-119">Following are the types of database functions EF Core supports and uniquely identifies.</span></span> <span data-ttu-id="f47bf-120">Эти термины также помогают понять, какие преобразования встроены в поставщики EF Core.</span><span class="sxs-lookup"><span data-stu-id="f47bf-120">These terms also help in understanding what translations come built in with EF Core providers.</span></span>

### <a name="built-in-vs-user-defined-functions"></a><span data-ttu-id="f47bf-121">Сравнение встроенных и определяемых пользователем функций</span><span class="sxs-lookup"><span data-stu-id="f47bf-121">Built-in vs user-defined functions</span></span>

<span data-ttu-id="f47bf-122">Встроенные функции поставляются с базой данных, в то время как определяемые пользователем функции явно определяются пользователем в базе данных.</span><span class="sxs-lookup"><span data-stu-id="f47bf-122">Built-in functions come with database predefined, but user-defined functions are explicitly defined by the user in the database.</span></span> <span data-ttu-id="f47bf-123">Когда EF Core преобразует запросы для использования функций базы данных, он использует встроенные функции, чтобы обеспечить постоянную доступность функции в базе данных.</span><span class="sxs-lookup"><span data-stu-id="f47bf-123">When EF Core translates queries to use database functions, it uses built-in functions to make sure that the function is always available on the database.</span></span> <span data-ttu-id="f47bf-124">Для правильного создания SQL в некоторых базах данных необходимо различать встроенные функции.</span><span class="sxs-lookup"><span data-stu-id="f47bf-124">The distinction of built-in functions is necessary in some databases to generate SQL correctly.</span></span> <span data-ttu-id="f47bf-125">Например, SqlServer требует, чтобы каждую определяемую пользователем функцию вызывали с помощью имени, заданного схемой.</span><span class="sxs-lookup"><span data-stu-id="f47bf-125">For example SqlServer requires that every user-defined function is invoked with a schema-qualified name.</span></span> <span data-ttu-id="f47bf-126">В то же время встроенные функции в SqlServer не имеют схемы.</span><span class="sxs-lookup"><span data-stu-id="f47bf-126">But built-in functions in SqlServer don't have a schema.</span></span> <span data-ttu-id="f47bf-127">PostgreSQL определяет встроенную функцию в схеме `public`, но ее можно вызывать с помощью имен, заданных схемой.</span><span class="sxs-lookup"><span data-stu-id="f47bf-127">PostgreSQL defines built-in function in the `public` schema but they can be invoked with schema-qualified names.</span></span>

### <a name="aggregate-vs-scalar-vs-table-valued-functions"></a><span data-ttu-id="f47bf-128">Сравнение агрегатных, скалярных функций и функций с табличным значением</span><span class="sxs-lookup"><span data-stu-id="f47bf-128">Aggregate vs scalar vs table-valued functions</span></span>

- <span data-ttu-id="f47bf-129">Скалярные функции принимают скалярные значения, например целые числа или строки, в качестве параметров и возвращают скалярное значение в качестве результата.</span><span class="sxs-lookup"><span data-stu-id="f47bf-129">Scalar functions take scalar values - like integers or strings - as parameters and return a scalar value as the result.</span></span> <span data-ttu-id="f47bf-130">Скалярные функции можно использовать в любом месте в SQL, где можно передавать скалярное значение.</span><span class="sxs-lookup"><span data-stu-id="f47bf-130">Scalar functions can be used anywhere in SQL where a scalar value can be passed.</span></span>
- <span data-ttu-id="f47bf-131">Агрегатные функции принимают поток скалярных значений в качестве параметров и возвращают скалярное значение в качестве результата.</span><span class="sxs-lookup"><span data-stu-id="f47bf-131">Aggregate functions take a stream of scalar values as parameters and return a scalar value as the result.</span></span> <span data-ttu-id="f47bf-132">Агрегатные функции применяются ко всему результирующему набору запроса или к группе значений, созданных при применении оператора `GROUP BY`.</span><span class="sxs-lookup"><span data-stu-id="f47bf-132">Aggregate functions are applied on the whole query result set or on a group of values generated by applying `GROUP BY` operator.</span></span>
- <span data-ttu-id="f47bf-133">Функции с табличным значением принимают скалярные значения в качестве параметров и возвращают поток строк в качестве результата.</span><span class="sxs-lookup"><span data-stu-id="f47bf-133">Table-valued functions take scalar values as parameter(s) and return a stream of rows as the result.</span></span> <span data-ttu-id="f47bf-134">Функции с табличным значением используются в качестве источника данных таблицы в предложении `FROM`.</span><span class="sxs-lookup"><span data-stu-id="f47bf-134">Table-valued functions are used as a table source in `FROM` clause.</span></span>

### <a name="niladic-functions"></a><span data-ttu-id="f47bf-135">Нуль-арные функции</span><span class="sxs-lookup"><span data-stu-id="f47bf-135">Niladic functions</span></span>

<span data-ttu-id="f47bf-136">Нуль-арные функции — это специальные функции базы данных, которые не имеют параметров и которые следует вызывать без круглых скобок.</span><span class="sxs-lookup"><span data-stu-id="f47bf-136">Niladic functions are special database functions that don't have any parameters and must be invoked without parenthesis.</span></span> <span data-ttu-id="f47bf-137">Они подобны доступу к свойствам и полям в экземпляре C#.</span><span class="sxs-lookup"><span data-stu-id="f47bf-137">They're similar to property/field access on an instance in C#.</span></span> <span data-ttu-id="f47bf-138">Нуль-арные функции отличаются от функций без параметров, поскольку в последних требуются пустые скобки.</span><span class="sxs-lookup"><span data-stu-id="f47bf-138">Niladic functions differ from parameter-less functions as the latter require empty parenthesis.</span></span> <span data-ttu-id="f47bf-139">Для функций базы данных, для которых всегда требуются скобки, не существует специального имени.</span><span class="sxs-lookup"><span data-stu-id="f47bf-139">There's no special name for database functions that requires parenthesis always.</span></span> <span data-ttu-id="f47bf-140">Другое подмножество функций базы данных, основанное на количестве параметров, — это вариадические функции.</span><span class="sxs-lookup"><span data-stu-id="f47bf-140">Another subset of database functions based on parameter count is variadic functions.</span></span> <span data-ttu-id="f47bf-141">Вариадические функции могут принимать разное количество параметров при вызове.</span><span class="sxs-lookup"><span data-stu-id="f47bf-141">Variadic functions can take varying number of parameters when invoked.</span></span>

## <a name="database-function-mappings-in-ef-core"></a><span data-ttu-id="f47bf-142">Сопоставления функций базы данных в EF Core</span><span class="sxs-lookup"><span data-stu-id="f47bf-142">Database function mappings in EF Core</span></span>

<span data-ttu-id="f47bf-143">EF Core поддерживает три разных способа сопоставления функций C# и функций базы данных.</span><span class="sxs-lookup"><span data-stu-id="f47bf-143">EF Core supports three different ways of mapping between C# functions and database functions.</span></span>

### <a name="built-in-function-mapping"></a><span data-ttu-id="f47bf-144">Сопоставление встроенных функций</span><span class="sxs-lookup"><span data-stu-id="f47bf-144">Built-in function mapping</span></span>

<span data-ttu-id="f47bf-145">По умолчанию поставщики EF Core предоставляют сопоставления для различных встроенных функций над примитивными типами.</span><span class="sxs-lookup"><span data-stu-id="f47bf-145">By default EF Core providers provide mappings for various built-in functions over primitive types.</span></span> <span data-ttu-id="f47bf-146">Например, <xref:System.String.ToLower?displayProperty=nameWithType> преобразуется в `LOWER` в SqlServer.</span><span class="sxs-lookup"><span data-stu-id="f47bf-146">For example, <xref:System.String.ToLower?displayProperty=nameWithType> translates to `LOWER` in SqlServer.</span></span> <span data-ttu-id="f47bf-147">Эта функция позволяет пользователям легко создавать запросы в LINQ.</span><span class="sxs-lookup"><span data-stu-id="f47bf-147">This functionality allows users to write queries in LINQ seamlessly.</span></span> <span data-ttu-id="f47bf-148">Обычно в базе данных предоставляется преобразование, которое дает тот же результат, что и функция C#, что предоставляется на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="f47bf-148">We usually provide a translation in the database that gives the same result as what the C# function provides on the client side.</span></span> <span data-ttu-id="f47bf-149">Иногда, чтобы добиться этого, фактическое преобразование может оказаться более сложным, чем функция базы данных.</span><span class="sxs-lookup"><span data-stu-id="f47bf-149">Sometimes, to achieve that, the actual translation could be something more complicated than a database function.</span></span> <span data-ttu-id="f47bf-150">В некоторых сценариях также предоставляется наиболее подходящее преобразование вместо соответствующей семантики C#.</span><span class="sxs-lookup"><span data-stu-id="f47bf-150">In some scenarios, we also provide the most appropriate translation rather than matching C# semantics.</span></span> <span data-ttu-id="f47bf-151">Эта же функция также используется для предоставления общих преобразований для некоторых элементов доступа членов C#.</span><span class="sxs-lookup"><span data-stu-id="f47bf-151">The same feature is also used to provide common translations for some of the C# member accesses.</span></span> <span data-ttu-id="f47bf-152">Например, <xref:System.String.Length?displayProperty=nameWithType> преобразуется в `LEN` в SqlServer.</span><span class="sxs-lookup"><span data-stu-id="f47bf-152">For example, <xref:System.String.Length?displayProperty=nameWithType> translates to `LEN` in SqlServer.</span></span> <span data-ttu-id="f47bf-153">Помимо поставщиков, дополнительные преобразования могут также добавлять подключаемые модули записи.</span><span class="sxs-lookup"><span data-stu-id="f47bf-153">Apart from providers, plugin writers can also add additional translations.</span></span> <span data-ttu-id="f47bf-154">Такая расширяемость полезна, когда подключаемые модули добавляют поддержку нескольких типов в качестве примитивных типов и требуют преобразования методов.</span><span class="sxs-lookup"><span data-stu-id="f47bf-154">This extensibility is useful when plugins add support for more types as primitive types and want to translate methods over them.</span></span>

### <a name="effunctions-mapping"></a><span data-ttu-id="f47bf-155">Сопоставление EF.Functions</span><span class="sxs-lookup"><span data-stu-id="f47bf-155">EF.Functions mapping</span></span>

<span data-ttu-id="f47bf-156">Поскольку не все функции базы данных имеют эквивалентные функции C#, поставщики EF Core имеют специальные методы C# для вызова определенных функций базы данных.</span><span class="sxs-lookup"><span data-stu-id="f47bf-156">Since not all database functions have equivalent C# functions, EF Core providers have special C# methods to invoke certain database functions.</span></span> <span data-ttu-id="f47bf-157">Эти методы определяются как методы расширения `EF.Functions` для использования в запросах LINQ.</span><span class="sxs-lookup"><span data-stu-id="f47bf-157">These methods are defined as extension methods over `EF.Functions` to be used in LINQ queries.</span></span> <span data-ttu-id="f47bf-158">Эти методы относятся к конкретному поставщику, так как они тесно связаны с конкретными функциями базы данных.</span><span class="sxs-lookup"><span data-stu-id="f47bf-158">These methods are provider-specific as they're closely tied with particular database functions.</span></span> <span data-ttu-id="f47bf-159">Поэтому метод, который работает для одного поставщика, скорее всего, не будет работать для других поставщиков.</span><span class="sxs-lookup"><span data-stu-id="f47bf-159">So a method that works for one provider will likely not work for any other provider.</span></span> <span data-ttu-id="f47bf-160">Кроме того, поскольку цель этих методов заключается в вызове функции базы данных в преобразованном запросе, попытка их вычисления на стороне клиента будет приводить к возникновению исключения.</span><span class="sxs-lookup"><span data-stu-id="f47bf-160">Further, since the intention of these methods is to invoke a database function in the translated query, trying to evaluate them on the client results in an exception.</span></span>

### <a name="user-defined-function-mapping"></a><span data-ttu-id="f47bf-161">Сопоставление определяемых пользователем функций</span><span class="sxs-lookup"><span data-stu-id="f47bf-161">User-defined function mapping</span></span>

<span data-ttu-id="f47bf-162">Помимо сопоставлений, предоставляемых поставщиками EF Core, пользователи могут также определять пользовательское сопоставление.</span><span class="sxs-lookup"><span data-stu-id="f47bf-162">Apart from mappings provided by EF Core providers, users can also define custom mapping.</span></span> <span data-ttu-id="f47bf-163">Определяемое пользователем сопоставление расширяет преобразование запросов в соответствии с потребностями пользователя.</span><span class="sxs-lookup"><span data-stu-id="f47bf-163">A user-defined mapping extends the query translation according to the user needs.</span></span> <span data-ttu-id="f47bf-164">Эта функция полезна, если в базе данных есть определяемые пользователем функции, которые пользователь хочет вызвать из своего запроса LINQ.</span><span class="sxs-lookup"><span data-stu-id="f47bf-164">This functionality is useful when there are user-defined functions in the database, which the user wants to invoke from their LINQ query.</span></span>

## <a name="see-also"></a><span data-ttu-id="f47bf-165">См. также:</span><span class="sxs-lookup"><span data-stu-id="f47bf-165">See also</span></span>

- [<span data-ttu-id="f47bf-166">Сопоставления встроенных функций SqlServer</span><span class="sxs-lookup"><span data-stu-id="f47bf-166">SqlServer built-in function mappings</span></span>](xref:core/providers/sql-server/functions)
- [<span data-ttu-id="f47bf-167">Сопоставления встроенных функций SQLite</span><span class="sxs-lookup"><span data-stu-id="f47bf-167">Sqlite built-in function mappings</span></span>](xref:core/providers/sqlite/functions)
- [<span data-ttu-id="f47bf-168">Сопоставления встроенных функций Cosmos</span><span class="sxs-lookup"><span data-stu-id="f47bf-168">Cosmos built-in function mappings</span></span>](xref:core/providers/cosmos/functions)
