---
title: Наследование — EF Core
description: Настройка наследования типов сущностей с помощью Entity Framework Core
author: AndriySvyryd
ms.author: ansvyryd
ms.date: 10/27/2016
uid: core/modeling/inheritance
ms.openlocfilehash: 0e94013a0b894b162f4bb3ca8e7acb1aca349011
ms.sourcegitcommit: 92d54fe3702e0c92e198334da22bacb42e9842b1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/10/2020
ms.locfileid: "84664056"
---
# <a name="inheritance"></a>Наследование

EF может сопоставлять иерархию типов .NET с базой данных. Это позволяет создавать сущности .NET в коде обычным образом, используя базовые и производные типы и позволяя EF легко создавать соответствующую схему базы данных, выдавать запросы и т. д. Фактические сведения о сопоставлении иерархии типов являются зависимыми от поставщика; на этой странице описывается поддержка наследования в контексте реляционной базы данных.

В данный момент EF Core поддерживает только шаблон «одна таблица на иерархию». Функция «подтаблица» использует одну таблицу для хранения данных всех типов в иерархии, а столбец дискриминатора используется для указания типа, представляемого каждой строкой.

> [!NOTE]
> Тип "Таблица — один-типа" (TPT) и "табличный/конкретный" тип (TPC), которые поддерживаются EF6, пока не поддерживаются EF Core. TPT — это важный компонент, который планируется EF Core 5,0.

## <a name="entity-type-hierarchy-mapping"></a>Сопоставление иерархии типов сущностей

По соглашению EF не будет автоматически сканировать базовые или производные типы; Это означает, что если требуется сопоставить тип CLR в иерархии, необходимо явно указать этот тип в модели. Например, указание только базового типа иерархии не приведет к неявному включению всех его вложенных типов EF Core.

В следующем примере предоставляется DbSet для `Blog` и его подкласс `RssBlog` . Если `Blog` имеет любой другой подкласс, он не будет включаться в модель.

[!code-csharp[Main](../../../samples/core/Modeling/Conventions/InheritanceDbSets.cs?name=InheritanceDbSets&highlight=3-4)]

Эта модель сопоставлена со следующей схемой базы данных (Обратите внимание на неявно созданный столбец *дискриминатора* , который определяет, какой тип *блога* хранится в каждой строке):

![Изображение](_static/inheritance-tph-data.png)

>[!NOTE]
> Столбцы базы данных автоматически допускают значение null при необходимости при использовании сопоставления «одна таблица». Например, столбец *рссурл* допускает значение null, так как обычные экземпляры *блога* не имеют этого свойства.

Если вы не хотите предоставлять DbSet для одной или нескольких сущностей в иерархии, можно также использовать API Fluent, чтобы убедиться, что они включены в модель.

> [!TIP]
> Если вы не полагаетесь на соглашения, можно явно указать базовый тип с помощью `HasBaseType` . Также можно использовать `.HasBaseType((Type)null)` для удаления типа сущности из иерархии.

## <a name="discriminator-configuration"></a>Конфигурация дискриминатора

Можно настроить имя и тип столбца дискриминатора, а также значения, которые используются для обнаружения каждого типа в иерархии.

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/DiscriminatorConfiguration.cs?name=DiscriminatorConfiguration&highlight=4-6)]

В приведенных выше примерах EF добавил дискриминатор неявно в качестве [Свойства теневой](xref:core/modeling/shadow-properties) копии базовой сущности иерархии. Это свойство можно настроить так же, как и любое другое:

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/DiscriminatorPropertyConfiguration.cs?name=DiscriminatorPropertyConfiguration&highlight=4-5)]

Наконец, дискриминатор также можно сопоставить с обычным свойством .NET в сущности:

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/NonShadowDiscriminator.cs?name=NonShadowDiscriminator&highlight=4)]

## <a name="shared-columns"></a>Общие столбцы

По умолчанию, если два одноуровневого типа сущности в иерархии имеют свойство с одинаковым именем, они будут сопоставлены с двумя отдельными столбцами. Однако, если их тип идентичен, они могут быть сопоставлены с одним столбцом базы данных:

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/SharedTPHColumns.cs?name=SharedTPHColumns&highlight=9,13)]
