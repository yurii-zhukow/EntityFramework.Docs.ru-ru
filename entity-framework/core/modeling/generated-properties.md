---
title: Сформированные значения — EF Core
description: Настройка создания значений для свойств при использовании Entity Framework Core
author: AndriySvyryd
ms.date: 11/06/2019
uid: core/modeling/generated-properties
ms.openlocfilehash: d89739cf8bd2612b97bbf338e9685e9888b6216b
ms.sourcegitcommit: 0a25c03fa65ae6e0e0e3f66bac48d59eceb96a5a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/14/2020
ms.locfileid: "92062221"
---
# <a name="generated-values"></a>Созданные значения

## <a name="value-generation-patterns"></a>Шаблоны создания значений

Существует три шаблона создания значений, которые можно использовать для свойств:

* Без создания значения
* Значение, созданное при добавлении
* Значение, созданное при добавлении или обновлении

### <a name="no-value-generation"></a>Без создания значения

Отсутствие создания значения означает, что всегда будет предоставляться допустимое значение, сохраняемое в базе данных. Это допустимое значение должно быть назначено новым сущностям перед их добавлением в контекст.

### <a name="value-generated-on-add"></a>Значение, созданное при добавлении

Значение, созданное при добавлении, означает, что для новых сущностей создается значение.

В зависимости от используемого поставщика базы данных значения могут создаваться клиентом на стороне EF или в базе данных. Если значение создается базой данных, то EF может присвоить временное значение при добавлении сущности в контекст. Это временное значение затем будет заменено формируемым базой данных значением во время `SaveChanges()` .

Если добавить сущность в контекст, имеющий значение, присвоенное свойству, то EF попытается вставить это значение вместо создания нового. Свойство считается назначенным, если ему не присвоено значение CLR по умолчанию (для, для и `null` `string` `0` `int` `Guid.Empty` `Guid` т. д.). Дополнительные сведения см. в разделе [явные значения для созданных свойств](xref:core/saving/explicit-values-generated-properties).

> [!WARNING]
> То, как значение создается для добавленных сущностей, зависит от используемого поставщика базы данных. Поставщики баз данных могут автоматически настроить создание значений для некоторых типов свойств, но для других пользователей может потребоваться ручная настройка способа создания значения.
>
> Например, при использовании SQL Server значения будут автоматически создаваться для `GUID` свойств (с использованием алгоритма последовательного GUID SQL Server). Однако если указать, что при `DateTime` добавлении создается свойство, необходимо настроить способ создания значений. Один из способов сделать это — настроить значение по умолчанию для `GETDATE()` , см. раздел [значения по умолчанию](#default-values).

### <a name="value-generated-on-add-or-update"></a>Значение, созданное при добавлении или обновлении

Значение, формируемое при добавлении или обновлении, означает, что новое значение создается при каждом сохранении записи (INSERT или Update).

Например `value generated on add` , если указать значение для свойства только что добавленного экземпляра сущности, это значение будет вставлено вместо создаваемого значения. При обновлении также можно задать явное значение. Дополнительные сведения см. в разделе [явные значения для созданных свойств](xref:core/saving/explicit-values-generated-properties).

> [!WARNING]
> То, как значение создается для добавленных и обновленных сущностей, зависит от используемого поставщика базы данных. Поставщики баз данных могут автоматически настроить создание значений для некоторых типов свойств, а для других потребуется вручную настроить способ создания значения.
>
> Например, при использовании SQL Server свойства, `byte[]` которые устанавливаются, как созданные при добавлении или обновлении и помеченные как маркеры параллелизма, будут настроены с `rowversion` типом данных, чтобы значения создавались в базе данных. Однако если указать, что `DateTime` свойство создается при добавлении или обновлении, необходимо настроить способ создания значений. Одним из способов сделать это является настройка значения по умолчанию `GETDATE()` (см. [значения по умолчанию](#default-values)) для создания значений для новых строк. Затем можно использовать триггер базы данных для формирования значений во время обновлений (например, в следующем примере триггера).
>
> [!code-sql[Main](../../../samples/core/Modeling/FluentAPI/ValueGeneratedOnAddOrUpdate.sql)]

## <a name="value-generated-on-add"></a>Значение, созданное при добавлении

В соответствии с соглашением Несоставные первичные ключи типа Short, int, long или GUID настраиваются так, чтобы иметь значения, созданные для вставленных сущностей, если значение не предоставлено приложением. Поставщик базы данных обычно выполняет необходимую настройку. Например, числовой первичный ключ в SQL Server автоматически настраивается как столбец ИДЕНТИФИКАТОРов.

Можно настроить любое свойство так, чтобы его значение создавалось для вставленных сущностей следующим образом:

### <a name="data-annotations"></a>[Заметки к данным](#tab/data-annotations)

[!code-csharp[Main](../../../samples/core/Modeling/DataAnnotations/ValueGeneratedOnAdd.cs?name=ValueGeneratedOnAdd&highlight=5)]

### <a name="fluent-api"></a>[Текучий API](#tab/fluent-api)

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/ValueGeneratedOnAdd.cs?name=ValueGeneratedOnAdd&highlight=5)]

***

> [!WARNING]
> Это просто позволяет EF знать, что значения формируются для добавленных сущностей, но не гарантируют, что EF будет настраивать фактический механизм для создания значений. Дополнительные сведения см. [в разделе значение, созданное при добавлении](#value-generated-on-add) раздела.

### <a name="default-values"></a>Значения по умолчанию

В реляционных базах данных столбец можно настроить со значением по умолчанию. Если строка вставляется без значения для этого столбца, будет использоваться значение по умолчанию.

Можно настроить значение по умолчанию для свойства.

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/DefaultValue.cs?name=DefaultValue&highlight=5)]

Можно также указать фрагмент SQL, используемый для вычисления значения по умолчанию:

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/DefaultValueSql.cs?name=DefaultValueSql&highlight=5)]

При указании значения по умолчанию свойство будет неявно настроено как значение, созданное при добавлении.

## <a name="value-generated-on-add-or-update"></a>Значение, созданное при добавлении или обновлении

### <a name="data-annotations"></a>[Заметки к данным](#tab/data-annotations)

[!code-csharp[Main](../../../samples/core/Modeling/DataAnnotations/ValueGeneratedOnAddOrUpdate.cs?name=ValueGeneratedOnAddOrUpdate&highlight=5)]

### <a name="fluent-api"></a>[Текучий API](#tab/fluent-api)

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/ValueGeneratedOnAddOrUpdate.cs?name=ValueGeneratedOnAddOrUpdate&highlight=5)]

***

> [!WARNING]
> Это просто позволяет EF знать, что значения формируются для добавленных или обновленных сущностей, но не гарантирует, что EF будет настраивать фактический механизм для создания значений. Дополнительные сведения см. [в разделе Добавление или обновление](#value-generated-on-add-or-update) раздела.

### <a name="computed-columns"></a>Вычисляемые столбцы

В некоторых реляционных базах данных столбец можно настроить так, чтобы его значение было вычислено в базе данных, как правило, с выражением, ссылающимся на другие столбцы:

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/ComputedColumn.cs?name=ComputedColumn&highlight=5)]

> [!NOTE]
> В некоторых случаях значение столбца вычисляются при каждом выборке (иногда называемых *виртуальными* столбцами), а в других — при каждом обновлении строки и при хранении (иногда называемых *хранимыми* или *материализованными* столбцами). Это зависит от поставщиков баз данных.

## <a name="no-value-generation"></a>Без создания значения

Отключение создания значения для свойства обычно требуется, если соглашение настраивает его для создания значения. Например, если имеется первичный ключ типа int, он будет неявно настроен в качестве значения, созданного при добавлении; Это можно отключить следующими средствами:

### <a name="data-annotations"></a>[Заметки к данным](#tab/data-annotations)

[!code-csharp[Main](../../../samples/core/Modeling/DataAnnotations/ValueGeneratedNever.cs?name=ValueGeneratedNever&highlight=3)]

### <a name="fluent-api"></a>[Текучий API](#tab/fluent-api)

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/ValueGeneratedNever.cs?name=ValueGeneratedNever&highlight=5)]

***
