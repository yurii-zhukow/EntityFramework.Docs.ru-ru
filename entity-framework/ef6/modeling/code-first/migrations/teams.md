---
title: Code First Migrations в средах группы — EF6
author: divega
ms.date: 10/23/2016
ms.assetid: 4c2d9a95-de6f-4e97-9738-c1f8043eff69
ms.openlocfilehash: b3c4c35d636caf4ddd251dd78e026587abc57d42
ms.sourcegitcommit: cc0ff36e46e9ed3527638f7208000e8521faef2e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78415613"
---
# <a name="code-first-migrations-in-team-environments"></a><span data-ttu-id="16cea-102">Code First Migrations в средах групп</span><span class="sxs-lookup"><span data-stu-id="16cea-102">Code First Migrations in Team Environments</span></span>
> [!NOTE]
> <span data-ttu-id="16cea-103">В этой статье предполагается, что вы умеете использовать Code First Migrations в основных сценариях.</span><span class="sxs-lookup"><span data-stu-id="16cea-103">This article assumes you know how to use Code First Migrations in basic scenarios.</span></span> <span data-ttu-id="16cea-104">В противном случае необходимо прочитать [Code First migrations](~/ef6/modeling/code-first/migrations/index.md) , прежде чем продолжить.</span><span class="sxs-lookup"><span data-stu-id="16cea-104">If you don’t, then you’ll need to read [Code First Migrations](~/ef6/modeling/code-first/migrations/index.md) before continuing.</span></span>

## <a name="grab-a-coffee-you-need-to-read-this-whole-article"></a><span data-ttu-id="16cea-105">Возьмите кофе, вы должны прочитать эту статью целиком</span><span class="sxs-lookup"><span data-stu-id="16cea-105">Grab a coffee, you need to read this whole article</span></span>

<span data-ttu-id="16cea-106">Проблемы в средах группы в основном связаны с слиянием миграций, когда два разработчика создавали миграции в своем локальном коде.</span><span class="sxs-lookup"><span data-stu-id="16cea-106">The issues in team environments are mostly around merging migrations when two developers have generated migrations in their local code base.</span></span> <span data-ttu-id="16cea-107">Хотя действия, необходимые для решения этих задач, довольно просты, они должны иметь четкое представление о том, как работает миграция.</span><span class="sxs-lookup"><span data-stu-id="16cea-107">While the steps to solve these are pretty simple, they require you to have a solid understanding of how migrations works.</span></span> <span data-ttu-id="16cea-108">Не стоит просто перейти к концу — Потратьте время на чтение всей статьи, чтобы убедиться в успешном выполнении.</span><span class="sxs-lookup"><span data-stu-id="16cea-108">Please don’t just skip ahead to the end – take the time to read the whole article to ensure you are successful.</span></span>

## <a name="some-general-guidelines"></a><span data-ttu-id="16cea-109">Некоторые общие рекомендации</span><span class="sxs-lookup"><span data-stu-id="16cea-109">Some general guidelines</span></span>

<span data-ttu-id="16cea-110">Прежде чем приступить к изучению способов управления слиянием миграций, созданных несколькими разработчиками, ниже приведены некоторые общие рекомендации по настройке успеха.</span><span class="sxs-lookup"><span data-stu-id="16cea-110">Before we dig into how to manage merging migrations generated by multiple developers, here are some general guidelines to set you up for success.</span></span>

### <a name="each-team-member-should-have-a-local-development-database"></a><span data-ttu-id="16cea-111">У каждого члена команды должна быть локальная база данных разработки</span><span class="sxs-lookup"><span data-stu-id="16cea-111">Each team member should have a local development database</span></span>

<span data-ttu-id="16cea-112">При миграции используется таблица **\_\_мигратионшистори** для хранения данных, к которым применены миграции.</span><span class="sxs-lookup"><span data-stu-id="16cea-112">Migrations uses the **\_\_MigrationsHistory** table to store what migrations have been applied to the database.</span></span> <span data-ttu-id="16cea-113">Если у вас есть несколько разработчиков, создающих различные миграции при попытке ориентироваться на одну и ту же базу данных (и, таким же, общий доступ к **\_\_мигратионшистори** таблице), миграция будет очень запутанной.</span><span class="sxs-lookup"><span data-stu-id="16cea-113">If you have multiple developers generating different migrations while trying to target the same database (and thus share a **\_\_MigrationsHistory** table) migrations is going to get very confused.</span></span>

<span data-ttu-id="16cea-114">Конечно, если у вас есть члены команды, которые не создают миграцию, то нет проблем с предоставлением общего доступа к центральной базе данных разработки.</span><span class="sxs-lookup"><span data-stu-id="16cea-114">Of course, if you have team members that aren’t generating migrations, there is no problem having them share a central development database.</span></span>

### <a name="avoid-automatic-migrations"></a><span data-ttu-id="16cea-115">Предотвращение автоматической миграции</span><span class="sxs-lookup"><span data-stu-id="16cea-115">Avoid automatic migrations</span></span>

<span data-ttu-id="16cea-116">В результате автоматических миграций, которые изначально выглядят хорошо в средах группы, в реальности они просто не работают.</span><span class="sxs-lookup"><span data-stu-id="16cea-116">The bottom line is that automatic migrations initially look good in team environments, but in reality they just don’t work.</span></span> <span data-ttu-id="16cea-117">Если вы хотите получить сведения о том, почему, продолжите чтение — если нет, то можете перейти к следующему разделу.</span><span class="sxs-lookup"><span data-stu-id="16cea-117">If you want to know why, keep reading – if not, then you can skip to the next section.</span></span>

<span data-ttu-id="16cea-118">Автоматическая миграция позволяет обновить схему базы данных в соответствии с текущей моделью без необходимости создавать файлы кода (переносы на основе кода).</span><span class="sxs-lookup"><span data-stu-id="16cea-118">Automatic migrations allows you to have your database schema updated to match the current model without the need to generate code files (code-based migrations).</span></span> <span data-ttu-id="16cea-119">Автоматическая миграция будет хорошо работать в среде группы, если вы только когда-либо использовали их и никогда не создавали переносы на основе кода.</span><span class="sxs-lookup"><span data-stu-id="16cea-119">Automatic migrations would work very well in a team environment if you only ever used them and never generated any code-based migrations.</span></span> <span data-ttu-id="16cea-120">Проблема заключается в том, что автоматическая миграция ограничена и не обрабатывает ряд операций: Переименование свойств и столбцов, перемещение данных в другую таблицу и т. д. Для обработки этих сценариев вы в итоге создаете переносы на основе кода (и редактируете шаблонный код), которые находятся в разных изменениях, которые обрабатываются автоматическими миграциями.</span><span class="sxs-lookup"><span data-stu-id="16cea-120">The problem is that automatic migrations are limited and don’t handle a number of operations – property/column renames, moving data to another table, etc. To handle these scenarios you end up generating code-based migrations (and editing the scaffolded code) that are mixed in between changes that are handled by automatic migrations.</span></span> <span data-ttu-id="16cea-121">Это делает невозможным слияние изменений, когда два разработчика проверяют миграцию.</span><span class="sxs-lookup"><span data-stu-id="16cea-121">This makes it near on impossible to merge changes when two developers check in migrations.</span></span>

## <a name="screencasts"></a><span data-ttu-id="16cea-122">Демонстрационные ролики</span><span class="sxs-lookup"><span data-stu-id="16cea-122">Screencasts</span></span>

<span data-ttu-id="16cea-123">Если бы вы хотели Смотреть ролик, чем читать эту статью, в следующих двух видеороликах будет рассмотрено то же содержимое, что и в этой статье.</span><span class="sxs-lookup"><span data-stu-id="16cea-123">If you'd rather watch a screencast than read this article, the following two videos cover the same content as this article.</span></span>

### <a name="video-one-migrations---under-the-hood"></a><span data-ttu-id="16cea-124">Видеоматериалы: «миграция — внутри себя»</span><span class="sxs-lookup"><span data-stu-id="16cea-124">Video One: "Migrations - Under the Hood"</span></span>

<span data-ttu-id="16cea-125">В [этой презентации](https://channel9.msdn.com/blogs/ef/migrations-under-the-hood) рассматривается, как миграция отслеживает и использует сведения о модели для обнаружения изменений модели.</span><span class="sxs-lookup"><span data-stu-id="16cea-125">[This screencast](https://channel9.msdn.com/blogs/ef/migrations-under-the-hood) covers how migrations tracks and uses information about the model to detect model changes.</span></span>

### <a name="video-two-migrations---team-environments"></a><span data-ttu-id="16cea-126">Видео 2: "миграции — среды группы"</span><span class="sxs-lookup"><span data-stu-id="16cea-126">Video Two: "Migrations - Team Environments"</span></span>

<span data-ttu-id="16cea-127">На основе концепций из предыдущего видео в [этой презентации](https://channel9.msdn.com/blogs/ef/migrations-team-environments) рассматриваются проблемы, возникающие в среде группы, и способы их решения.</span><span class="sxs-lookup"><span data-stu-id="16cea-127">Building on the concepts from the previous video, [this screencast](https://channel9.msdn.com/blogs/ef/migrations-team-environments) covers the issues that arise in a team environment and how to solve them.</span></span>

## <a name="understanding-how-migrations-works"></a><span data-ttu-id="16cea-128">Основные сведения о принципах работы миграции</span><span class="sxs-lookup"><span data-stu-id="16cea-128">Understanding how migrations works</span></span>

<span data-ttu-id="16cea-129">Ключом к успешному использованию миграций в среде рабочей группы является простое понимание того, как миграция отслеживает и использует сведения о модели для обнаружения изменений модели.</span><span class="sxs-lookup"><span data-stu-id="16cea-129">The key to successfully using migrations in a team environment is a basic understanding how migrations tracks and uses information about the model to detect model changes.</span></span>

### <a name="the-first-migration"></a><span data-ttu-id="16cea-130">Первая миграция</span><span class="sxs-lookup"><span data-stu-id="16cea-130">The first migration</span></span>

<span data-ttu-id="16cea-131">При добавлении первой миграции в проект в консоли диспетчера пакетов сначала выполняется нечто вроде **Add-Migration** .</span><span class="sxs-lookup"><span data-stu-id="16cea-131">When you add the first migration to your project, you run something like **Add-Migration First** in Package Manager Console.</span></span> <span data-ttu-id="16cea-132">Ниже показаны действия высокого уровня, выполняемые этой командой.</span><span class="sxs-lookup"><span data-stu-id="16cea-132">The high level steps that this command performs are pictured below.</span></span>

![Первая миграция](~/ef6/media/firstmigration.png)

<span data-ttu-id="16cea-134">Текущая модель вычисляется из кода (1).</span><span class="sxs-lookup"><span data-stu-id="16cea-134">The current model is calculated from your code (1).</span></span> <span data-ttu-id="16cea-135">Объекты базы данных, которые затем рассчитываются моделью, отличаются (2) — поскольку это первая миграция, то модель отличается только пустой моделью для сравнения.</span><span class="sxs-lookup"><span data-stu-id="16cea-135">The required database objects are then calculated by the model differ (2) – since this is the first migration the model differ just uses an empty model for the comparison.</span></span> <span data-ttu-id="16cea-136">Необходимые изменения передаются генератору кода для создания необходимого кода миграции (3), который затем добавляется в решение Visual Studio (4).</span><span class="sxs-lookup"><span data-stu-id="16cea-136">The required changes are passed to the code generator to build the required migration code (3) which is then added to your Visual Studio solution (4).</span></span>

<span data-ttu-id="16cea-137">В дополнение к фактическому коду переноса, который хранится в основном файле кода, при миграции также создаются некоторые дополнительные файлы кода программной части.</span><span class="sxs-lookup"><span data-stu-id="16cea-137">In addition to the actual migration code that is stored in the main code file, migrations also generates some additional code-behind files.</span></span> <span data-ttu-id="16cea-138">Эти файлы являются метаданными, используемыми для миграций и которые не нужно изменять.</span><span class="sxs-lookup"><span data-stu-id="16cea-138">These files are metadata that is used by migrations and are not something you should edit.</span></span> <span data-ttu-id="16cea-139">Один из этих файлов представляет собой файл ресурсов (RESX), который содержит моментальный снимок модели на момент создания миграции.</span><span class="sxs-lookup"><span data-stu-id="16cea-139">One of these files is a resource file (.resx) that contains a snapshot of the model at the time the migration was generated.</span></span> <span data-ttu-id="16cea-140">Вы увидите, как это используется на следующем шаге.</span><span class="sxs-lookup"><span data-stu-id="16cea-140">You’ll see how this is used in the next step.</span></span>

<span data-ttu-id="16cea-141">На этом этапе вы, вероятно, запустили **Обновление** базы данных, чтобы применить изменения к базе данных, а затем — к реализации других областей приложения.</span><span class="sxs-lookup"><span data-stu-id="16cea-141">At this point you would probably run **Update-Database** to apply your changes to the database, and then go about implementing other areas of your application.</span></span>

### <a name="subsequent-migrations"></a><span data-ttu-id="16cea-142">Последующие миграции</span><span class="sxs-lookup"><span data-stu-id="16cea-142">Subsequent migrations</span></span>

<span data-ttu-id="16cea-143">Позже вы вернетесь к модели и внесете в нее некоторые изменения. в нашем примере мы добавим в **блог**свойство **URL-адреса** .</span><span class="sxs-lookup"><span data-stu-id="16cea-143">Later you come back and make some changes to your model – in our example we’ll add a **Url** property to **Blog**.</span></span> <span data-ttu-id="16cea-144">Затем выполните команду **Add-Migration аддурл** , чтобы сформировать шаблон миграции, чтобы применить соответствующие изменения базы данных.</span><span class="sxs-lookup"><span data-stu-id="16cea-144">You would then issue a command such as **Add-Migration AddUrl** to scaffold a migration to apply the corresponding database changes.</span></span> <span data-ttu-id="16cea-145">Ниже показаны действия высокого уровня, выполняемые этой командой.</span><span class="sxs-lookup"><span data-stu-id="16cea-145">The high level steps that this command performs are pictured below.</span></span>

![Вторая миграция](~/ef6/media/secondmigration.png)

<span data-ttu-id="16cea-147">Как и в последнем времени, текущая модель вычисляется по коду (1).</span><span class="sxs-lookup"><span data-stu-id="16cea-147">Just like last time, the current model is calculated from code (1).</span></span> <span data-ttu-id="16cea-148">Однако на этот раз существуют миграция, поэтому Предыдущая модель извлекается из последней миграции (2).</span><span class="sxs-lookup"><span data-stu-id="16cea-148">However, this time there are existing migrations so the previous model is retrieved from the latest migration (2).</span></span> <span data-ttu-id="16cea-149">Эти две модели различны для поиска необходимых изменений базы данных (3), после чего процесс завершается как раньше.</span><span class="sxs-lookup"><span data-stu-id="16cea-149">These two models are diffed to find the required database changes (3) and then the process completes as before.</span></span>

<span data-ttu-id="16cea-150">Этот же процесс используется для последующих миграций, добавляемых в проект.</span><span class="sxs-lookup"><span data-stu-id="16cea-150">This same process is used for any further migrations that you add to the project.</span></span>

### <a name="why-bother-with-the-model-snapshot"></a><span data-ttu-id="16cea-151">Зачем нужна моментальный снимок модели?</span><span class="sxs-lookup"><span data-stu-id="16cea-151">Why bother with the model snapshot?</span></span>

<span data-ttu-id="16cea-152">Возможно, вас интересует, почему EF оба с моментальным снимком модели — не просто взгляните на базу данных.</span><span class="sxs-lookup"><span data-stu-id="16cea-152">You may be wondering why EF bothers with the model snapshot – why not just look at the database.</span></span> <span data-ttu-id="16cea-153">Если это так, читайте на.</span><span class="sxs-lookup"><span data-stu-id="16cea-153">If so, read on.</span></span> <span data-ttu-id="16cea-154">Если вас не интересует, этот раздел можно пропустить.</span><span class="sxs-lookup"><span data-stu-id="16cea-154">If you’re not interested then you can skip this section.</span></span>

<span data-ttu-id="16cea-155">Существует ряд причин, по которым EF сохраняет моментальный снимок модели:</span><span class="sxs-lookup"><span data-stu-id="16cea-155">There are a number of reasons EF keeps the model snapshot around:</span></span>

-   <span data-ttu-id="16cea-156">Это позволяет базе данных отменять модель EF.</span><span class="sxs-lookup"><span data-stu-id="16cea-156">It allows your database to drift from the EF model.</span></span> <span data-ttu-id="16cea-157">Эти изменения можно вносить непосредственно в базу данных, или же можно изменить сформированный код в миграции, чтобы внести изменения.</span><span class="sxs-lookup"><span data-stu-id="16cea-157">These changes can be made directly in the database, or you can change the scaffolded code in your migrations to make the changes.</span></span> <span data-ttu-id="16cea-158">Вот несколько примеров этого на практике.</span><span class="sxs-lookup"><span data-stu-id="16cea-158">Here are a couple of examples of this in practice:</span></span>
    -   <span data-ttu-id="16cea-159">Необходимо добавить столбец inserted и updated в одну или несколько таблиц, но не нужно включать эти столбцы в модель EF.</span><span class="sxs-lookup"><span data-stu-id="16cea-159">You want to add an Inserted and Updated to column to one or more of your tables but you don’t want to include these columns in the EF model.</span></span> <span data-ttu-id="16cea-160">Если миграция выполнялась в базе данных, она будет непрерывно пытаться удалить эти столбцы при каждом формировании процесса миграции.</span><span class="sxs-lookup"><span data-stu-id="16cea-160">If migrations looked at the database it would continually try to drop these columns every time you scaffolded a migration.</span></span> <span data-ttu-id="16cea-161">При использовании моментального снимка модели EF будет только обнаруживать допустимые изменения модели.</span><span class="sxs-lookup"><span data-stu-id="16cea-161">Using the model snapshot, EF will only ever detect legitimate changes to the model.</span></span>
    -   <span data-ttu-id="16cea-162">Необходимо изменить текст хранимой процедуры, используемой для обновления, чтобы включить некоторые журналы.</span><span class="sxs-lookup"><span data-stu-id="16cea-162">You want to change the body of a stored procedure used for updates to include some logging.</span></span> <span data-ttu-id="16cea-163">Если миграции Просмотрели эту хранимую процедуру из базы данных, она будет постоянно пытаться вернуться к определению, которое предполагается EF.</span><span class="sxs-lookup"><span data-stu-id="16cea-163">If migrations looked at this stored procedure from the database it would continually try and reset it back to the definition that EF expects.</span></span> <span data-ttu-id="16cea-164">С помощью моментального снимка модели EF будет только код формирования кода для изменения хранимой процедуры при изменении формы процедуры в модели EF.</span><span class="sxs-lookup"><span data-stu-id="16cea-164">By using the model snapshot, EF will only ever scaffold code to alter the stored procedure when you change the shape of the procedure in the EF model.</span></span>
    -   <span data-ttu-id="16cea-165">Эти же принципы применяются для добавления дополнительных индексов, включая дополнительные таблицы в базе данных, сопоставления EF с представлением базы данных, расположенным над таблицей, и т. д.</span><span class="sxs-lookup"><span data-stu-id="16cea-165">These same principles apply to adding extra indexes, including extra tables in your database, mapping EF to a database view that sits over a table, etc.</span></span>
-   <span data-ttu-id="16cea-166">Модель EF содержит не только форму базы данных.</span><span class="sxs-lookup"><span data-stu-id="16cea-166">The EF model contains more than just the shape of the database.</span></span> <span data-ttu-id="16cea-167">Наличие всей модели позволяет выполнять миграцию для просмотра сведений о свойствах и классах в модели, а также о том, как они сопоставляются со столбцами и таблицами.</span><span class="sxs-lookup"><span data-stu-id="16cea-167">Having the entire model allows migrations to look at information about the properties and classes in your model and how they map to the columns and tables.</span></span> <span data-ttu-id="16cea-168">Эти сведения обеспечивают более интеллектуальную миграцию в коде, который он формирует.</span><span class="sxs-lookup"><span data-stu-id="16cea-168">This information allows migrations to be more intelligent in the code that it scaffolds.</span></span> <span data-ttu-id="16cea-169">Например, если изменить имя столбца, сопоставляемое свойству с миграцией, может обнаружить переименование, просматривая то же самое свойство — что не может быть выполнено, если имеется только схема базы данных.</span><span class="sxs-lookup"><span data-stu-id="16cea-169">For example, if you change the name of the column that a property maps to migrations can detect the rename by seeing that it’s the same property – something that can’t be done if you only have the database schema.</span></span> 

## <a name="what-causes-issues-in-team-environments"></a><span data-ttu-id="16cea-170">Причины проблем в средах группы</span><span class="sxs-lookup"><span data-stu-id="16cea-170">What causes issues in team environments</span></span>

<span data-ttu-id="16cea-171">Рабочий процесс, описанный в предыдущем разделе, отлично работает, если вы работаете над приложением с помощью одного разработчика.</span><span class="sxs-lookup"><span data-stu-id="16cea-171">The workflow covered in the previous section works great when you are a single developer working on an application.</span></span> <span data-ttu-id="16cea-172">Это также хорошо работает в среде группы, если вы единственный пользователь, который вносит изменения в модель.</span><span class="sxs-lookup"><span data-stu-id="16cea-172">It also works well in a team environment if you are the only person making changes to the model.</span></span> <span data-ttu-id="16cea-173">В этом сценарии можно вносить изменения в модель, создавать миграции и отправлять их в систему управления версиями.</span><span class="sxs-lookup"><span data-stu-id="16cea-173">In this scenario you can make model changes, generate migrations and submit them to your source control.</span></span> <span data-ttu-id="16cea-174">Другие разработчики могут синхронизировать изменения и выполнить **Обновление базы данных** , чтобы применить изменения схемы.</span><span class="sxs-lookup"><span data-stu-id="16cea-174">Other developers can sync your changes and run **Update-Database** to have the schema changes applied.</span></span>

<span data-ttu-id="16cea-175">Проблемы начинают возникать, когда несколько разработчиков вносит изменения в модель EF и одновременно отправляются в систему управления версиями.</span><span class="sxs-lookup"><span data-stu-id="16cea-175">Issues start to arise when you have multiple developers making changes to the EF model and submitting to source control at the same time.</span></span> <span data-ttu-id="16cea-176">Нехватка EF — первый классовый способ слияния локальных миграций с миграцией, которые другой разработчик отправил в систему управления версиями с момента последней синхронизации.</span><span class="sxs-lookup"><span data-stu-id="16cea-176">What EF lacks is a first class way to merge your local migrations with migrations that another developer has submitted to source control since you last synced.</span></span>

## <a name="an-example-of-a-merge-conflict"></a><span data-ttu-id="16cea-177">Пример конфликта слияния</span><span class="sxs-lookup"><span data-stu-id="16cea-177">An example of a merge conflict</span></span>

<span data-ttu-id="16cea-178">Сначала давайте рассмотрим конкретный пример такого конфликта слияния.</span><span class="sxs-lookup"><span data-stu-id="16cea-178">First let’s look at a concrete example of such a merge conflict.</span></span> <span data-ttu-id="16cea-179">Мы будем продолжать работу с примером, который мы рассматривали ранее.</span><span class="sxs-lookup"><span data-stu-id="16cea-179">We’ll continue on with the example we looked at earlier.</span></span> <span data-ttu-id="16cea-180">В качестве отправной точки Предположим, что изменения из предыдущего раздела были возвращены исходным разработчиком.</span><span class="sxs-lookup"><span data-stu-id="16cea-180">As a starting point let’s assume the changes from the previous section were checked in by the original developer.</span></span> <span data-ttu-id="16cea-181">Мы будем отслеживанием двух разработчиков при внесении изменений в базу кода.</span><span class="sxs-lookup"><span data-stu-id="16cea-181">We’ll track two developers as they make changes to code base.</span></span>

<span data-ttu-id="16cea-182">Мы будем относиться к модели EF и миграции с учетом ряда изменений.</span><span class="sxs-lookup"><span data-stu-id="16cea-182">We’ll track the EF model and the migrations thru a number of changes.</span></span> <span data-ttu-id="16cea-183">В качестве отправной точки оба разработчика были синхронизированы с репозиторием системы управления версиями, как показано на следующем рисунке.</span><span class="sxs-lookup"><span data-stu-id="16cea-183">For a starting point, both developers have synced to the source control repository, as depicted in the following graphic.</span></span>

![Начальная точка](~/ef6/media/startingpoint.png)

<span data-ttu-id="16cea-185">Разработчик \#1 и разработчик \#2 теперь вносит некоторые изменения в модель EF в своей локальной базе кода.</span><span class="sxs-lookup"><span data-stu-id="16cea-185">Developer \#1 and developer \#2 now makes some changes to the EF model in their local code base.</span></span> <span data-ttu-id="16cea-186">Разработчик \#1 добавляет свойство **рейтинга** в **блог** — и создает **аддратинг** миграцию для применения изменений к базе данных.</span><span class="sxs-lookup"><span data-stu-id="16cea-186">Developer \#1 adds a **Rating** property to **Blog** – and generates an **AddRating** migration to apply the changes to the database.</span></span> <span data-ttu-id="16cea-187">Разработчик \#2 добавляет в **блог** свойство " **читатели** " и создает соответствующую миграцию **аддреадерс** .</span><span class="sxs-lookup"><span data-stu-id="16cea-187">Developer \#2 adds a **Readers** property to **Blog** – and generates the corresponding **AddReaders** migration.</span></span> <span data-ttu-id="16cea-188">Оба разработчика выполняют **Обновление базы данных**, применяют изменения к их локальным базам данных, а затем продолжают разработку приложения.</span><span class="sxs-lookup"><span data-stu-id="16cea-188">Both developers run **Update-Database**, to apply the changes to their local databases, and then continue developing the application.</span></span>

> [!NOTE]
> <span data-ttu-id="16cea-189">Для миграции используется префикс отметок времени, поэтому наш график представляет, что Аддреадерс миграция от разработчика \#2 находится после Аддратинг миграции от Developer \#1.</span><span class="sxs-lookup"><span data-stu-id="16cea-189">Migrations are prefixed with a timestamp, so our graphic represents that the AddReaders migration from Developer \#2 comes after the AddRating migration from Developer \#1.</span></span> <span data-ttu-id="16cea-190">Независимо от того, были ли разработчики \#1 или \#2, в первую очередь не отличаются от проблем, связанных с работой в команде, или процесса слияния, который мы рассмотрим в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="16cea-190">Whether developer \#1 or \#2 generated the migration first makes no difference to the issues of working in a team, or the process for merging them that we’ll look at in the next section.</span></span>

![Локальные изменения](~/ef6/media/localchanges.png)

<span data-ttu-id="16cea-192">Это самый счастливой день для разработчика \#1, так как это происходит в первую очередь для отправки своих изменений.</span><span class="sxs-lookup"><span data-stu-id="16cea-192">It’s a lucky day for Developer \#1 as they happen to submit their changes first.</span></span> <span data-ttu-id="16cea-193">Так как никто из других пользователей не вернул, так как он синхронизирует свой репозиторий, он может просто отправить свои изменения без выполнения слияния.</span><span class="sxs-lookup"><span data-stu-id="16cea-193">Because no one else has checked in since they synced their repository, they can just submit their changes without performing any merging.</span></span>

![Submit](~/ef6/media/submit.png)

<span data-ttu-id="16cea-195">Пришло время для отправки разработчику \#2.</span><span class="sxs-lookup"><span data-stu-id="16cea-195">Now it’s time for Developer \#2 to submit.</span></span> <span data-ttu-id="16cea-196">Они не так счастливы.</span><span class="sxs-lookup"><span data-stu-id="16cea-196">They aren’t so lucky.</span></span> <span data-ttu-id="16cea-197">Так как кто-то другой отправил изменения с момента их синхронизации, им потребуется извлечь изменения и выполнить слияние.</span><span class="sxs-lookup"><span data-stu-id="16cea-197">Because someone else has submitted changes since they synced, they will need to pull down the changes and merge.</span></span> <span data-ttu-id="16cea-198">Система управления версиями, скорее всего, сможет автоматически объединить изменения на уровне кода, так как они очень просты.</span><span class="sxs-lookup"><span data-stu-id="16cea-198">The source control system will likely be able to automatically merge the changes at the code level since they are very simple.</span></span> <span data-ttu-id="16cea-199">Состояние локального репозитория разработчика \#2 после синхронизации показано на следующем рисунке.</span><span class="sxs-lookup"><span data-stu-id="16cea-199">The state of Developer \#2’s local repository after syncing is depicted in the following graphic.</span></span> 

![По запросу](~/ef6/media/pull.png)

<span data-ttu-id="16cea-201">На этом этапе разработчик \#2 может запустить **Update-Database** , который обнаружит новую миграцию **аддратинг** (которая не была применена к базе данных разработчика \#2) и применит ее.</span><span class="sxs-lookup"><span data-stu-id="16cea-201">At this stage Developer \#2 can run **Update-Database** which will detect the new **AddRating** migration (which hasn’t been applied to Developer \#2’s database) and apply it.</span></span> <span data-ttu-id="16cea-202">Теперь столбец **рейтинга** добавляется в таблицу **блоги** , и база данных синхронизируется с моделью.</span><span class="sxs-lookup"><span data-stu-id="16cea-202">Now the **Rating** column is added to the **Blogs** table and the database is in sync with the model.</span></span>

<span data-ttu-id="16cea-203">Существует несколько проблем:</span><span class="sxs-lookup"><span data-stu-id="16cea-203">There are a couple of problems though:</span></span>

1.  <span data-ttu-id="16cea-204">Несмотря на то, что **Update-Database** будет применять **аддратинг** миграцию, также будет выдано предупреждение: *невозможно обновить базу данных в соответствии с текущей моделью, так как имеются ожидающие изменения и отключена автоматическая миграция...*</span><span class="sxs-lookup"><span data-stu-id="16cea-204">Although **Update-Database** will apply the **AddRating** migration it will also raise a warning: *Unable to update database to match the current model because there are pending changes and automatic migration is disabled…*</span></span>
    <span data-ttu-id="16cea-205">Проблема заключается в том, что для моментального снимка модели, хранящегося в последней миграции (**аддреадер**), отсутствует свойство **рейтинга** в **блоге** (поскольку оно не было частью модели при создании миграции).</span><span class="sxs-lookup"><span data-stu-id="16cea-205">The problem is that the model snapshot stored in the last migration (**AddReader**) is missing the **Rating** property on **Blog** (since it wasn’t part of the model when the migration was generated).</span></span> <span data-ttu-id="16cea-206">Code First обнаруживает, что модель в последней миграции не соответствует текущей модели и вызывает предупреждение.</span><span class="sxs-lookup"><span data-stu-id="16cea-206">Code First detects that the model in the last migration doesn’t match the current model and raises the warning.</span></span>
2.  <span data-ttu-id="16cea-207">Запуск приложения приведет к тому, что "*модель резервного копирования контекста" BloggingContext "изменилась с момента создания базы данных. Попробуйте использовать Code First Migrations для обновления базы данных... "*</span><span class="sxs-lookup"><span data-stu-id="16cea-207">Running the application would result in an InvalidOperationException stating that “*The model backing the 'BloggingContext' context has changed since the database was created. Consider using Code First Migrations to update the database…”*</span></span>
    <span data-ttu-id="16cea-208">Опять же, проблема заключается в том, что моментальный снимок модели, хранящийся в последней миграции, не соответствует текущей модели.</span><span class="sxs-lookup"><span data-stu-id="16cea-208">Again, the problem is the model snapshot stored in the last migration doesn’t match the current model.</span></span>
3.  <span data-ttu-id="16cea-209">Наконец, мы предполагаем, что при выполнении **Add-Migration** будет создан пустой перенос (поскольку нет изменений, применимых к базе данных).</span><span class="sxs-lookup"><span data-stu-id="16cea-209">Finally, we would expect running **Add-Migration** now would generate an empty migration (since there are no changes to apply to the database).</span></span> <span data-ttu-id="16cea-210">Но поскольку миграция сравнивает текущую модель с последней миграцией (в которой отсутствует свойство **рейтинга** ), она фактически формирует формирование шаблона другого вызова **addColumn** для добавления в столбец **рейтинга** .</span><span class="sxs-lookup"><span data-stu-id="16cea-210">But because migrations compares the current model to the one from the last migration (which is missing the **Rating** property) it will actually scaffold another **AddColumn** call to add in the **Rating** column.</span></span> <span data-ttu-id="16cea-211">Разумеется, эта миграция может завершиться ошибкой во время **обновления базы данных** , поскольку столбец **рейтинга** уже существует.</span><span class="sxs-lookup"><span data-stu-id="16cea-211">Of course, this migration would fail during **Update-Database** because the **Rating** column already exists.</span></span>

## <a name="resolving-the-merge-conflict"></a><span data-ttu-id="16cea-212">Разрешение конфликта слияния</span><span class="sxs-lookup"><span data-stu-id="16cea-212">Resolving the merge conflict</span></span>

<span data-ttu-id="16cea-213">Хорошая новость заключается в том, что не слишком сложно работать с слиянием вручную — при условии, что вы понимаете, как работает миграция.</span><span class="sxs-lookup"><span data-stu-id="16cea-213">The good news is that it’s not too hard to deal with the merge manually – provided you have an understanding of how migrations works.</span></span> <span data-ttu-id="16cea-214">Итак, если вы пропустили этот раздел...</span><span class="sxs-lookup"><span data-stu-id="16cea-214">So if you’ve skipped ahead to this section…</span></span> <span data-ttu-id="16cea-215">к сожалению, сначала необходимо ознакомиться с оставшейся частью статьи!</span><span class="sxs-lookup"><span data-stu-id="16cea-215">sorry, you need to go back and read the rest of the article first!</span></span>

<span data-ttu-id="16cea-216">Существует два варианта: проще всего создать пустую миграцию с правильной текущей моделью в виде моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="16cea-216">There are two options, the easiest is to generate a blank migration that has the correct current model as a snapshot.</span></span> <span data-ttu-id="16cea-217">Второй вариант — обновить моментальный снимок в последней миграции, чтобы он имел правильный моментальный снимок модели.</span><span class="sxs-lookup"><span data-stu-id="16cea-217">The second option is to update the snapshot in the last migration to have the correct model snapshot.</span></span> <span data-ttu-id="16cea-218">Второй вариант — немного сложнее, и его нельзя использовать в каждом сценарии, но это также может быть вызвано тем, что не требует добавления дополнительной миграции.</span><span class="sxs-lookup"><span data-stu-id="16cea-218">The second option is a little harder and can’t be used in every scenario, but it’s also cleaner because it doesn’t involve adding an extra migration.</span></span>

### <a name="option-1-add-a-blank-merge-migration"></a><span data-ttu-id="16cea-219">Вариант 1. Добавление пустого переноса слиянием</span><span class="sxs-lookup"><span data-stu-id="16cea-219">Option 1: Add a blank ‘merge’ migration</span></span>

<span data-ttu-id="16cea-220">В этом варианте создается пустая миграция только для того, чтобы гарантировать, что последняя миграция будет иметь нужный моментальный снимок модели.</span><span class="sxs-lookup"><span data-stu-id="16cea-220">In this option we generate a blank migration solely for the purpose of making sure the latest migration has the correct model snapshot stored in it.</span></span>

<span data-ttu-id="16cea-221">Этот параметр можно использовать независимо от того, кто создал последнюю миграцию.</span><span class="sxs-lookup"><span data-stu-id="16cea-221">This option can be used regardless of who generated the last migration.</span></span> <span data-ttu-id="16cea-222">В примере мы уже работали с разработчиком \#2, который выполняет слияние, и что произошло для создания последней миграции.</span><span class="sxs-lookup"><span data-stu-id="16cea-222">In the example we’ve been following Developer \#2 is taking care of the merge and they happened to generate the last migration.</span></span> <span data-ttu-id="16cea-223">Но эти же действия можно использовать, если разработчик \#1 создал последнюю миграцию.</span><span class="sxs-lookup"><span data-stu-id="16cea-223">But these same steps can be used if Developer \#1 generated the last migration.</span></span> <span data-ttu-id="16cea-224">Эти шаги также применяются, если участвуют несколько миграций — мы только что видели два, чтобы они были простыми.</span><span class="sxs-lookup"><span data-stu-id="16cea-224">The steps also apply if there are multiple migrations involved – we’ve just been looking at two in order to keep it simple.</span></span>

<span data-ttu-id="16cea-225">Для этого подхода можно использовать следующий процесс, начиная с того времени, когда вы понимаете, какие изменения необходимо синхронизировать с системой управления версиями.</span><span class="sxs-lookup"><span data-stu-id="16cea-225">The following process can be used for this approach, starting from the time you realize you have changes that need to be synced from source control.</span></span>

1.  <span data-ttu-id="16cea-226">Убедитесь, что все ожидающие изменения модели в локальной базе кода были записаны в миграцию.</span><span class="sxs-lookup"><span data-stu-id="16cea-226">Ensure any pending model changes in your local code base have been written to a migration.</span></span> <span data-ttu-id="16cea-227">Этот шаг гарантирует, что вы не пропустили какие – либо допустимые изменения, когда поступает время создания пустой миграции.</span><span class="sxs-lookup"><span data-stu-id="16cea-227">This step ensures you don’t miss any legitimate changes when it comes time to generate the blank migration.</span></span>
2.  <span data-ttu-id="16cea-228">Синхронизация с системой управления версиями.</span><span class="sxs-lookup"><span data-stu-id="16cea-228">Sync with source control.</span></span>
3.  <span data-ttu-id="16cea-229">Выполните **Обновление базы данных** , чтобы применить новые миграции, которые были возвращены другими разработчиками.</span><span class="sxs-lookup"><span data-stu-id="16cea-229">Run **Update-Database** to apply any new migrations that other developers have checked in.</span></span>
    <span data-ttu-id="16cea-230">**_Примечание._** *Если вы не получаете предупреждения от команды Update-Database, то не существовали новые миграции от других разработчиков и нет необходимости выполнять дальнейшее слияние.*</span><span class="sxs-lookup"><span data-stu-id="16cea-230">**_Note:_** *if you don’t get any warnings from the Update-Database command then there were no new migrations from other developers and there is no need to perform any further merging.*</span></span>
4.  <span data-ttu-id="16cea-231">Выполните команду **Add-migration &lt;выберите\_\_имя&gt; – игноречанжес** (например, " **Добавить слияние миграции — игноречанжес**").</span><span class="sxs-lookup"><span data-stu-id="16cea-231">Run **Add-Migration &lt;pick\_a\_name&gt; –IgnoreChanges** (for example, **Add-Migration Merge –IgnoreChanges**).</span></span> <span data-ttu-id="16cea-232">При этом создается миграция со всеми метаданными (включая моментальный снимок текущей модели), но игнорируются все изменения, обнаруженные при сравнении текущей модели с моментальным снимком при последнем переносе (это означает, что вы получаете пустой метод " **вверх** и **вниз** ").</span><span class="sxs-lookup"><span data-stu-id="16cea-232">This generates a migration with all the metadata (including a snapshot of the current model) but will ignore any changes it detects when comparing the current model to the snapshot in the last migrations (meaning you get a blank **Up** and **Down** method).</span></span>
5.  <span data-ttu-id="16cea-233">Продолжить разработку или отправить в систему управления версиями (после выполнения модульных тестов курса).</span><span class="sxs-lookup"><span data-stu-id="16cea-233">Continue developing, or submit to source control (after running your unit tests of course).</span></span>

<span data-ttu-id="16cea-234">Ниже приведено состояние разработчика \#2, основанного на локальном коде, после использования этого подхода.</span><span class="sxs-lookup"><span data-stu-id="16cea-234">Here is the state of Developer \#2’s local code base after using this approach.</span></span>

![Миграция слиянием](~/ef6/media/mergemigration.png)

### <a name="option-2-update-the-model-snapshot-in-the-last-migration"></a><span data-ttu-id="16cea-236">Вариант 2. обновление моментального снимка модели при последней миграции</span><span class="sxs-lookup"><span data-stu-id="16cea-236">Option 2: Update the model snapshot in the last migration</span></span>

<span data-ttu-id="16cea-237">Этот параметр очень похож на вариант 1, но удаляет лишнюю пустую миграцию, так как давайте ему требуется дополнительный файл кода в своем решении.</span><span class="sxs-lookup"><span data-stu-id="16cea-237">This option is very similar to option 1 but removes the extra blank migration – because let’s face it, who wants extra code files in their solution.</span></span>

<span data-ttu-id="16cea-238">**Этот подход допустим, только если последняя миграция существует только в локальной базе кода и еще не была отправлена в систему управления версиями (например, если последняя миграция была создана пользователем, выполняющим слияние)** .</span><span class="sxs-lookup"><span data-stu-id="16cea-238">**This approach is only feasible if the latest migration exists only in your local code base and has not yet been submitted to source control (for example, if the last migration was generated by the user doing the merge)**.</span></span> <span data-ttu-id="16cea-239">Изменение метаданных миграций, которые другие разработчики могли уже применить к своей базе данных для разработки, или, что еще хуже, примененные к рабочей базе данных, может привести к непредвиденным побочным эффектам.</span><span class="sxs-lookup"><span data-stu-id="16cea-239">Editing the metadata of migrations that other developers may have already applied to their development database – or even worse applied to a production database – can result in unexpected side effects.</span></span> <span data-ttu-id="16cea-240">Во время процесса мы будем выполнять откат последней миграции в локальной базе данных и повторно применять ее с обновленными метаданными.</span><span class="sxs-lookup"><span data-stu-id="16cea-240">During the process we’re going to roll back the last migration in our local database and re-apply it with updated metadata.</span></span>

<span data-ttu-id="16cea-241">Хотя последняя миграция должна быть только в локальной базе кода, нет ограничений на число или порядок миграции, которые его проводят.</span><span class="sxs-lookup"><span data-stu-id="16cea-241">While the last migration needs to just be in the local code base there are no restrictions to the number or order of migrations that proceed it.</span></span> <span data-ttu-id="16cea-242">Существует несколько переходов от разных разработчиков и одних и тех же действий — мы только что видели два, чтобы обеспечить простоту.</span><span class="sxs-lookup"><span data-stu-id="16cea-242">There can be multiple migrations from multiple different developers and the same steps apply– we’ve just been looking at two in order to keep it simple.</span></span>

<span data-ttu-id="16cea-243">Для этого подхода можно использовать следующий процесс, начиная с того времени, когда вы понимаете, какие изменения необходимо синхронизировать с системой управления версиями.</span><span class="sxs-lookup"><span data-stu-id="16cea-243">The following process can be used for this approach, starting from the time you realize you have changes that need to be synced from source control.</span></span>

1.  <span data-ttu-id="16cea-244">Убедитесь, что все ожидающие изменения модели в локальной базе кода были записаны в миграцию.</span><span class="sxs-lookup"><span data-stu-id="16cea-244">Ensure any pending model changes in your local code base have been written to a migration.</span></span> <span data-ttu-id="16cea-245">Этот шаг гарантирует, что вы не пропустили какие – либо допустимые изменения, когда поступает время создания пустой миграции.</span><span class="sxs-lookup"><span data-stu-id="16cea-245">This step ensures you don’t miss any legitimate changes when it comes time to generate the blank migration.</span></span>
2.  <span data-ttu-id="16cea-246">Синхронизация с системой управления версиями.</span><span class="sxs-lookup"><span data-stu-id="16cea-246">Sync with the source control.</span></span>
3.  <span data-ttu-id="16cea-247">Выполните **Обновление базы данных** , чтобы применить новые миграции, которые были возвращены другими разработчиками.</span><span class="sxs-lookup"><span data-stu-id="16cea-247">Run **Update-Database** to apply any new migrations that other developers have checked in.</span></span>
    <span data-ttu-id="16cea-248">**_Примечание._** *Если вы не получаете предупреждения от команды Update-Database, то не существовали новые миграции от других разработчиков и нет необходимости выполнять дальнейшее слияние.*</span><span class="sxs-lookup"><span data-stu-id="16cea-248">**_Note:_** *if you don’t get any warnings from the Update-Database command then there were no new migrations from other developers and there is no need to perform any further merging.*</span></span>
4.  <span data-ttu-id="16cea-249">Выполните **Обновление-Database — таржетмигратион &lt;второй\_последней\_&gt;миграции** (в примере мы следовали бы **Обновить-Database – таржетмигратион аддратинг**).</span><span class="sxs-lookup"><span data-stu-id="16cea-249">Run **Update-Database –TargetMigration &lt;second\_last\_migration&gt;** (in the example we’ve been following this would be **Update-Database –TargetMigration AddRating**).</span></span> <span data-ttu-id="16cea-250">Эта роль применяет базу данных к состоянию второй последней миграции — фактически "Отмена применения" последней миграции из базы данных.</span><span class="sxs-lookup"><span data-stu-id="16cea-250">This roles the database back to the state of the second last migration – effectively ‘un-applying’ the last migration from the database.</span></span>
    <span data-ttu-id="16cea-251">**_Примечание._** *этот шаг необходим для безопасного изменения метаданных миграции, так как метаданные также хранятся в \_\_мигратионшисторитабле базы данных. Именно поэтому этот параметр следует использовать только в том случае, если последняя миграция выполняется только в локальной базе кода. Если в других базах данных была применена последняя миграция, также потребуется выполнить откат и повторно применить последнюю миграцию для обновления метаданных.*</span><span class="sxs-lookup"><span data-stu-id="16cea-251">**_Note:_** *This step is required to make it safe to edit the metadata of the migration since the metadata is also stored in the \_\_MigrationsHistoryTable of the database. This is why you should only use this option if the last migration is only in your local code base. If other databases had the last migration applied you would also have to roll them back and re-apply the last migration to update the metadata.*</span></span> 
5.  <span data-ttu-id="16cea-252">Выполните команду **Add-migration &lt;полное имя\_\_включая\_метку времени\_\_последней\_миграции**&gt; (в нашем примере это будет нечто вроде **Add-Migration 201311062215252\_аддреадерс**).</span><span class="sxs-lookup"><span data-stu-id="16cea-252">Run **Add-Migration &lt;full\_name\_including\_timestamp\_of\_last\_migration**&gt; (in the example we’ve been following this would be something like **Add-Migration 201311062215252\_AddReaders**).</span></span>
    <span data-ttu-id="16cea-253">**_Примечание._** необходимо *включить метку времени, чтобы при миграции было известно, что необходимо изменить существующую миграцию, а не создать формирование шаблонов.*</span><span class="sxs-lookup"><span data-stu-id="16cea-253">**_Note:_** *You need to include the timestamp so that migrations knows you want to edit the existing migration rather than scaffolding a new one.*</span></span>
    <span data-ttu-id="16cea-254">При этом метаданные для последней миграции будут обновлены в соответствии с текущей моделью.</span><span class="sxs-lookup"><span data-stu-id="16cea-254">This will update the metadata for the last migration to match the current model.</span></span> <span data-ttu-id="16cea-255">При завершении команды вы получите следующее предупреждение, но это именно то, что вам нужно.</span><span class="sxs-lookup"><span data-stu-id="16cea-255">You’ll get the following warning when the command completes, but that’s exactly what you want.</span></span> <span data-ttu-id="16cea-256">*Был изменен шаблон "только код конструктора для миграции" 201311062215252\_аддреадерс ". Чтобы изменить формирование шаблонов для всей миграции, используйте параметр-Force.*</span><span class="sxs-lookup"><span data-stu-id="16cea-256">“*Only the Designer Code for migration '201311062215252\_AddReaders' was re-scaffolded. To re-scaffold the entire migration, use the -Force parameter.”*</span></span>
6.  <span data-ttu-id="16cea-257">Выполните **Обновление базы данных** , чтобы повторно применить последнюю миграцию с обновленными метаданными.</span><span class="sxs-lookup"><span data-stu-id="16cea-257">Run **Update-Database** to re-apply the latest migration with the updated metadata.</span></span>
7.  <span data-ttu-id="16cea-258">Продолжить разработку или отправить в систему управления версиями (после выполнения модульных тестов курса).</span><span class="sxs-lookup"><span data-stu-id="16cea-258">Continue developing, or submit to source control (after running your unit tests of course).</span></span>

<span data-ttu-id="16cea-259">Ниже приведено состояние разработчика \#2, основанного на локальном коде, после использования этого подхода.</span><span class="sxs-lookup"><span data-stu-id="16cea-259">Here is the state of Developer \#2’s local code base after using this approach.</span></span>

![Обновленные метаданные](~/ef6/media/updatedmetadata.png)

## <a name="summary"></a><span data-ttu-id="16cea-261">Сводка</span><span class="sxs-lookup"><span data-stu-id="16cea-261">Summary</span></span>

<span data-ttu-id="16cea-262">При использовании Code First Migrations в среде группы возникают некоторые сложности.</span><span class="sxs-lookup"><span data-stu-id="16cea-262">There are some challenges when using Code First Migrations in a team environment.</span></span> <span data-ttu-id="16cea-263">Тем не менее, основное представление о том, как работает миграция, и некоторые простые подходы к устранению конфликтов слияния позволяют легко преодолеть эти трудности.</span><span class="sxs-lookup"><span data-stu-id="16cea-263">However, a basic understanding of how migrations works and some simple approaches for resolving merge conflicts make it easy to overcome these challenges.</span></span>

<span data-ttu-id="16cea-264">Фундаментальная ошибка — неправильные метаданные, хранящиеся в последней миграции.</span><span class="sxs-lookup"><span data-stu-id="16cea-264">The fundamental issue is incorrect metadata stored in the latest migration.</span></span> <span data-ttu-id="16cea-265">Это приводит к тому, что Code First неправильно обнаруживает, что текущая модель и схема базы данных не совпадают и для формирования неверного кода при следующей миграции.</span><span class="sxs-lookup"><span data-stu-id="16cea-265">This causes Code First to incorrectly detect that the current model and database schema don’t match and to scaffold incorrect code in the next migration.</span></span> <span data-ttu-id="16cea-266">Эту ситуацию можно преодолеть, создав пустую миграцию с правильной моделью или обновив метаданные в последней миграции.</span><span class="sxs-lookup"><span data-stu-id="16cea-266">This situation can be overcome by generating a blank migration with the correct model, or updating the metadata in the latest migration.</span></span>
