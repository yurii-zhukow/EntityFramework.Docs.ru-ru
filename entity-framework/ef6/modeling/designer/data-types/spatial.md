---
title: Конструктор пространственного-EF-EF6
description: Конструктор пространственного-EF в Entity Framework 6
author: ajcvickers
ms.date: 10/23/2016
uid: ef6/modeling/designer/data-types/spatial
ms.openlocfilehash: 298666e558ad5bb531948e6a0bbcf3d71141df0b
ms.sourcegitcommit: 0a25c03fa65ae6e0e0e3f66bac48d59eceb96a5a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/14/2020
ms.locfileid: "92064917"
---
# <a name="spatial---ef-designer"></a>Конструктор пространственного-EF
> [!NOTE]
> **Только EF5** — функции, API и т. д., обсуждаемые на этой странице, появились в Entity Framework 5. При использовании более ранней версии могут быть неприменимы некоторые или все сведения.

В видеоролике и пошаговом руководстве показано, как сопоставлять пространственные типы с Entity Framework Designer. В нем также показано, как использовать запрос LINQ для поиска расстояния между двумя расположениями.

В этом пошаговом руководстве будет использоваться Model First для создания новой базы данных, но конструктор EF также можно использовать с рабочим процессом [Database First](xref:ef6/modeling/designer/workflows/database-first) для соотнесения с существующей базой данных.

Поддержка пространственного типа появилась в Entity Framework 5. Обратите внимание, что для использования новых функций, таких как пространственный тип, перечисления и функции с табличным значением, необходимо выбрать .NET Framework 4,5. Visual Studio 2012 нацелена на .NET 4,5 по умолчанию.

Чтобы использовать пространственные типы данных, необходимо также использовать поставщик Entity Framework с поддержкой пространственного доступа. Дополнительные сведения см. в разделе [Поддержка пространственных типов в поставщике](xref:ef6/fundamentals/providers/spatial-support) .

Существует два основных типа пространственных данных: geography и geometry. Тип данных geography хранит данные эллиптических (например, координаты широты и долготы GPS). Тип данных geometry представляет евклидово (плоскую) систему координат.

## <a name="watch-the-video"></a>Просмотреть видео
В этом видео показано, как сопоставлять пространственные типы с Entity Framework Designer. В нем также показано, как использовать запрос LINQ для поиска расстояния между двумя расположениями.

**Представлено**: Julia Корнич

**Видео**: [WMV](https://download.microsoft.com/download/E/C/9/EC9E6547-8983-4C1F-A919-D33210E4B213/HDI-ITPro-MSDN-winvideo-spatialwithdesigner.wmv)  |  [MP4](https://download.microsoft.com/download/E/C/9/EC9E6547-8983-4C1F-A919-D33210E4B213/HDI-ITPro-MSDN-mp4video-spatialwithdesigner.m4v)  |  [WMV (ZIP)](https://download.microsoft.com/download/E/C/9/EC9E6547-8983-4C1F-A919-D33210E4B213/HDI-ITPro-MSDN-winvideo-spatialwithdesigner.zip)

## <a name="pre-requisites"></a>Предварительные требования

Для выполнения инструкций этого пошагового руководства необходимо установить Visual Studio 2012, Ultimate, Premium, Professional или Web Express Edition.

## <a name="set-up-the-project"></a>Настройка проекта

1.  Откройте Visual Studio 2012
2.  В меню **файл** наведите указатель мыши на пункт **создать**и выберите **проект** .
3.  В левой области щелкните **Visual C \# **, а затем выберите шаблон **консоли** .
4.  Введите **спатиалефдесигнер** в качестве имени проекта и нажмите кнопку **ОК** .

## <a name="create-a-new-model-using-the-ef-designer"></a>Создание новой модели с помощью конструктора EF

1.  Щелкните правой кнопкой мыши имя проекта в обозреватель решений, наведите указатель на пункт **Добавить**и выберите пункт **новый элемент** .
2.  Выберите **данные** в меню слева, а затем выберите **ADO.NET EDM** в области Шаблоны.
3.  Введите **университимодел. EDMX** в поле имя файла и нажмите кнопку **Добавить** .
4.  На странице "Мастер EDM" в диалоговом окне Выбор содержимого модели выберите **Пустая модель** .
5.  Нажмите кнопку **Готово**.

Отобразится Entity Designer, предоставляющий область конструктора для редактирования модели.

Мастер выполняет следующие действия.

-   Создает файл Енумтестмодел. EDMX, который определяет концептуальную модель, модель хранения и сопоставление между ними. Задает свойство обработки артефакта метаданных файла EDMX, которое будет внедрено в выходную сборку, чтобы созданные файлы метаданных были внедрены в сборку.
-   Добавляет ссылку на следующие сборки: EntityFramework, System. ComponentModel. Аннотация и System. Data. Entity.
-   Создает файлы UniversityModel.tt и UniversityModel.Context.tt и добавляет их в EDMX файл. Эти файлы шаблонов T4 создают код, определяющий производный тип DbContext и типы POCO, которые сопоставляются с сущностями в модели EDMX.

## <a name="add-a-new-entity-type"></a>Добавить новый тип сущности

1.  Щелкните правой кнопкой мыши пустую область в области конструктора, выберите пункт **Добавить- &gt; сущность**, откроется диалоговое окно Новая сущность.
2.  Укажите название типа **университет** и укажите **университид** в качестве имени свойства ключа, оставьте тип **Int32** .
3.  Нажмите кнопку **ОК**.
4.  Щелкните сущность правой кнопкой мыши и выберите пункт **Добавить новое — &gt; скалярное свойство** .
5.  Переименовать новое свойство в **имя**
6.  Добавьте еще одно скалярное свойство и переименуйте его в **Расположение** . Откройте окно свойств и измените тип нового свойства на **Geography** .
7.  Сохранение модели и сборка проекта
    > [!NOTE]
    > При сборке в Список ошибок могут отображаться предупреждения о несопоставленных сущностях и ассоциациях. Эти предупреждения можно игнорировать, так как после выбора создания базы данных из модели ошибки будут исчезнуть.

## <a name="generate-database-from-model"></a>Создать базу данных из модели

Теперь можно создать базу данных, основанную на модели.

1.  Щелкните правой кнопкой мыши пустое пространство на поверхности Entity Designer и выберите пункт **создать базу данных из модели** .
2.  Откроется диалоговое окно Выбор подключения к данным мастера создания базы данных. Нажмите кнопку **создать подключение** , укажите **(LocalDB) \\ mssqllocaldb** в поле имя сервера и **университет** для базы данных и нажмите кнопку **ОК** .
3.  Появится диалоговое окно с вопросом о том, нужно ли создать новую базу данных, и нажать кнопку **Да**.
4.  Нажмите кнопку **Далее** , и мастер создания базы данных создаст язык описания данных (DDL) для создания базы данных. в диалоговом окне "Сводка и параметры" отображается созданная DDL-инструкция. Обратите внимание, что в DDL не содержится определение таблицы, сопоставленной с типом перечисления.
5.  Нажмите кнопку **Готово** , чтобы не выполнять скрипт DDL.
6.  Мастер создания базы данных выполняет следующие действия: открывает файл **университимодел. edmx. SQL** в редакторе T-SQL. создает схему хранилища и разделы СОПОСТАВЛЕНИЯ файла EDMX, добавляя сведения строки подключения к файлу App.config
7.  Щелкните правой кнопкой мыши в редакторе T-SQL и выберите пункт **выполнить** диалоговое окно соединение с сервером, введите сведения о подключении на шаге 2 и нажмите кнопку **подключить** .
8.  Чтобы просмотреть созданную схему, щелкните правой кнопкой мыши имя базы данных в обозреватель объектов SQL Server и выберите **Обновить** .

## <a name="persist-and-retrieve-data"></a>Сохранение и получение данных

Откройте файл Program.cs, в котором определен метод Main. Добавьте следующий код в функцию main.

Код добавляет в контекст два новых объекта университета. Пространственные свойства инициализируются с помощью метода заданное DbGeography. FromText. Географическая точка, представленная как Веллкновнтекст, передается в метод. Затем код сохраняет данные. Затем выполняется построение и выполнение запроса LINQ, который возвращает объект университета, где его расположение ближе всего к указанному расположению.

``` csharp
using (var context = new UniversityModelContainer())
{
    context.Universities.Add(new University()
    {
        Name = "Graphic Design Institute",
        Location = DbGeography.FromText("POINT(-122.336106 47.605049)"),
    });

    context.Universities.Add(new University()
    {
        Name = "School of Fine Art",
        Location = DbGeography.FromText("POINT(-122.335197 47.646711)"),
    });

    context.SaveChanges();

    var myLocation = DbGeography.FromText("POINT(-122.296623 47.640405)");

    var university = (from u in context.Universities
                                orderby u.Location.Distance(myLocation)
                                select u).FirstOrDefault();

    Console.WriteLine(
        "The closest University to you is: {0}.",
        university.Name);
}
```

Скомпилируйте и запустите приложение. Программа выдает следующие результаты.

```console
The closest University to you is: School of Fine Art.
```

Чтобы просмотреть данные в базе данных, щелкните правой кнопкой мыши имя базы данных в обозреватель объектов SQL Server и выберите **Обновить**. Затем щелкните правой кнопкой мыши таблицу и выберите **Просмотр данных**.

## <a name="summary"></a>Итоги

В этом пошаговом руководстве мы рассмотрели, как сопоставлять пространственные типы с помощью Entity Framework Designer и как использовать пространственные типы в коде. 
