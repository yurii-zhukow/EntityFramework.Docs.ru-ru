---
title: Разделение сущностей конструктора — EF6
description: Разделение сущностей конструктора в Entity Framework 6
author: divega
ms.date: 10/23/2016
ms.assetid: aa2dd48a-1f0e-49dd-863d-d6b4f5834832
uid: ef6/modeling/designer/entity-splitting
ms.openlocfilehash: d3be4e54d4bcd3ca253d8970c612acddf48dbaf4
ms.sourcegitcommit: 7c3939504bb9da3f46bea3443638b808c04227c2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/09/2020
ms.locfileid: "89620521"
---
# <a name="designer-entity-splitting"></a>Разделение сущностей конструктора
В этом пошаговом руководстве показано, как сопоставлять тип сущности с двумя таблицами путем изменения модели с помощью Entity Framework Designer (конструктор EF). Сущность можно сопоставить с несколькими таблицами, если в таблицах имеется общий ключ. Основные понятия, которые применяются для сопоставления типа сущности с двумя таблицами, легко распространить на сопоставление типа сущности более чем с двумя таблицами.

На следующем рисунке показаны основные окна, используемые при работе с конструктором EF.

![Конструктор EF](~/ef6/media/efdesigner.png)

## <a name="prerequisites"></a>Предварительные требования

Visual Studio 2012 или Visual Studio 2010, Ultimate, Premium, Professional или Web Express Edition.

## <a name="create-the-database"></a>Создание базы данных

Сервер базы данных, устанавливаемый с Visual Studio, отличается в зависимости от установленной версии Visual Studio.

-   Если вы используете Visual Studio 2012, то будете создавать базу данных LocalDB.
-   При использовании Visual Studio 2010 будет создаваться база данных SQL Express.

Сначала мы создадим базу данных с двумя таблицами, которые мы будем объединять в одну сущность.

-   Открытие Visual Studio
-   **Просмотр — &gt; Обозреватель сервера**
-   Щелкните правой кнопкой мыши **подключения к данным — &gt; Добавить подключение...**
-   Если вы не подключились к базе данных из обозреватель сервера, прежде чем нужно будет выбрать **Microsoft SQL Server** в качестве источника данных
-   Подключение к LocalDB или SQL Express в зависимости от того, какой из установленных служб
-   Введите **ентитисплиттинг** в качестве имени базы данных
-   Нажмите кнопку **ОК** , и появится запрос на создание новой базы данных, выберите **Да** .
-   Теперь новая база данных появится в обозреватель сервера
-   Если вы используете Visual Studio 2012
    -   Щелкните правой кнопкой мыши базу данных в обозревателе сервера и выберите действие **Создать запрос**.
    -   Скопируйте следующий SQL в новый запрос, щелкните запрос правой кнопкой мыши и выберите команду **выполнить** .
-   Если вы используете Visual Studio 2010
    -   Выбор **данных — &gt; Редактор SQL — &gt; создать соединение с запросом...**
    -   Введите **. \\ **В качестве имени сервера в SQLExpress нажмите кнопку **ОК** .
    -   Выберите базу данных **ентитисплиттинг** в раскрывающемся списке в верхней части редактора запросов.
    -   Скопируйте следующий SQL в новый запрос, щелкните запрос правой кнопкой мыши и выберите команду **выполнить SQL** .

``` SQL
CREATE TABLE [dbo].[Person] (
[PersonId] INT IDENTITY (1, 1) NOT NULL,
[FirstName] NVARCHAR (200) NULL,
[LastName] NVARCHAR (200) NULL,
CONSTRAINT [PK_Person] PRIMARY KEY CLUSTERED ([PersonId] ASC)
);

CREATE TABLE [dbo].[PersonInfo] (
[PersonId] INT NOT NULL,
[Email] NVARCHAR (200) NULL,
[Phone] NVARCHAR (50) NULL,
CONSTRAINT [PK_PersonInfo] PRIMARY KEY CLUSTERED ([PersonId] ASC),
CONSTRAINT [FK_Person_PersonInfo] FOREIGN KEY ([PersonId]) REFERENCES [dbo].[Person] ([PersonId]) ON DELETE CASCADE
);
```

## <a name="create-the-project"></a>Создание проекта

-   В меню **Файл** укажите **Создать**, затем нажмите **Проект**.
-   В левой области щелкните **Visual C \# **, а затем выберите шаблон **консольное приложение** .
-   Введите **мапентититотаблессампле** в качестве имени проекта и нажмите кнопку **ОК**.
-   Если будет предложено сохранить SQL запрос, созданный в первом разделе, нажмите кнопку **нет** .

## <a name="create-a-model-based-on-the-database"></a>Создание модели на основе базы данных

-   Щелкните правой кнопкой мыши имя проекта в обозреватель решений, наведите указатель на пункт **Добавить**и выберите пункт **новый элемент**.
-   Выберите **данные** в меню слева, а затем выберите **ADO.NET EDM** в области Шаблоны.
-   Введите **мапентититотаблесмодел. EDMX** в поле имя файла и нажмите кнопку **Добавить**.
-   В диалоговом окне Выбор содержимого модели выберите пункт **создать из базы данных**, а затем нажмите кнопку **Далее.**
-   Выберите подключение **ентитисплиттинг** в раскрывающемся списке и нажмите кнопку **Далее**.
-   В диалоговом окне Выбор объектов базы данных установите флажок рядом с узлом **таблицы**   .
    Это приведет к добавлению всех таблиц из базы данных **ентитисплиттинг** в модель.
-   Нажмите кнопку **Готово**.

Отобразится Entity Designer, предоставляющий область конструктора для редактирования модели.

## <a name="map-an-entity-to-two-tables"></a>Сопоставьте сущность с двумя таблицами

На этом шаге мы будем обновлять тип сущности **Person** , чтобы объединить данные из таблиц **Person** и **персонинфо** .

-   Выберите свойства **Электронная почта**   и **Телефон** сущности **Персонинфо **и нажмите клавиши **CTRL + X** .
-   Выберите сущность **Person **и нажмите клавиши **CTRL + V** .
-   В области конструктора выберите **PersonInfo**   сущность персонинфо и нажмите кнопку **Delete (удалить** ) на клавиатуре.
-   Нажмите кнопку **нет** при появлении запроса на удаление таблицы **персонинфо** из модели, мы будем сопоставлять ее с сущностью **Person** .

    ![Удаление таблиц](~/ef6/media/deletetables.png)

Для дальнейших действий требуется окно **сведения о сопоставлении**   . Если это окно не отображается, щелкните правой кнопкой мыши область конструктора и выберите пункт **сведения о сопоставлении**.

-   Выберите **Person**   тип сущности Person и нажмите кнопку ** &lt; Добавить таблицу или представление &gt; **   в окне **сведения о сопоставлении**   .
-   Выберите **персонинфо **   из раскрывающегося списка.
    В окне **сведения о сопоставлении**   обновляются сопоставления столбцов по умолчанию, они прекрасно работают в нашем сценарии.

 **Person**   Тип сущности Person теперь сопоставлен с **Person**   таблицами Person и **персонинфо**   .

![Сопоставление 2](~/ef6/media/mapping2.png)

## <a name="use-the-model"></a>Использование модели

-   Вставьте следующий код в метод Main.

``` csharp
    using (var context = new EntitySplittingEntities())
    {
        var person = new Person
        {
            FirstName = "John",
            LastName = "Doe",
            Email = "john@example.com",
            Phone = "555-555-5555"
        };

        context.People.Add(person);
        context.SaveChanges();

        foreach (var item in context.People)
        {
            Console.WriteLine(item.FirstName);
        }
    }
```

-   Скомпилируйте и запустите приложение.

Следующие инструкции T-SQL были выполнены в базе данных в результате выполнения этого приложения. 

-   Следующие две инструкции **INSERT** были выполнены в результате выполнения context. SaveChanges (). Они принимают данные из сущности **Person** и разбивают их между таблицами **Person** и **персонинфо** .

    ![Вставить 1](~/ef6/media/insert1.png)

    ![Вставить 2](~/ef6/media/insert2.png)
-   Следующая операция **SELECT** была выполнена в результате перечисления пользователей в базе данных. Он сочетает данные из таблицы **Person** и **персонинфо** .

    ![Выбор объединения данных Person и Персонинфо](~/ef6/media/select.png)
