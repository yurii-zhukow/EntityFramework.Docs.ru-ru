---
title: Функции с табличным значением (возвращающие табличное) — EF6
author: divega
ms.date: 10/23/2016
ms.assetid: f019c97b-87b0-4e93-98f4-2c539f77b2dc
ms.openlocfilehash: 35684196dcd7b708a8feeb1eca3096e8d4e555ec
ms.sourcegitcommit: 708b18520321c587b2046ad2ea9fa7c48aeebfe5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2019
ms.locfileid: "72182536"
---
# <a name="table-valued-functions-tvfs"></a>Функции с табличным значением (возвращающие табличное)
> [!NOTE]
> **Только EF5** — функции, API и т. д., обсуждаемые на этой странице, появились в Entity Framework 5. При использовании более ранней версии могут быть неприменимы некоторые или все сведения.

В видео и пошаговом руководстве показано, как сопоставлять функции с табличным значением (возвращающие табличное) с помощью Entity Framework Designer. Здесь также показано, как вызвать ТАБЛИЧную функцию из запроса LINQ.

Возвращающие табличное в настоящее время поддерживаются только в рабочем процессе Database First.

В Entity Framework версии 5 появилась поддержка возвращающей табличное значение. Обратите внимание, что для использования новых функций, таких как функции, возвращающие табличное значение, перечисления и пространственные типы, необходимо выбрать .NET Framework 4,5. Visual Studio 2012 нацелена на .NET 4,5 по умолчанию.

Возвращающие табличное очень похожи на хранимые процедуры с одним ключевым отличием: результат функции имеет композицию. Это означает, что результаты из возвращающей табличное значение функции можно использовать в запросе LINQ, в то время как результаты хранимой процедуры не могут.

## <a name="watch-the-video"></a>Просмотрите видео

**Представлено**: Julia Корнич

[WMV](https://download.microsoft.com/download/6/0/A/60A6E474-5EF3-4E1E-B9EA-F51D2DDB446A/HDI-ITPro-MSDN-winvideo-tvf.wmv) | [MP4](https://download.microsoft.com/download/6/0/A/60A6E474-5EF3-4E1E-B9EA-F51D2DDB446A/HDI-ITPro-MSDN-mp4video-tvf.m4v) | [WMV (ZIP)](https://download.microsoft.com/download/6/0/A/60A6E474-5EF3-4E1E-B9EA-F51D2DDB446A/HDI-ITPro-MSDN-winvideo-tvf.zip)

## <a name="pre-requisites"></a>Предварительные требования

Для выполнения этого пошагового руководства необходимо следующее:

- Установите [базу данных School](~/ef6/resources/school-database.md).

- Наличие последней версии Visual Studio

## <a name="set-up-the-project"></a>Настройка проекта

1.  Откройте Visual Studio
2.  В меню **файл** наведите указатель мыши на пункт **создать**и выберите **проект** .
3.  В левой области щелкните **Visual C @ no__t-1**, а затем выберите шаблон **консоли** .
4.  Введите **табличное** имя в качестве имени проекта и нажмите кнопку **ОК** .

## <a name="add-a-tvf-to-the-database"></a>Добавление ТАБЛИЧной функции в базу данных

-   Выберите **вид-&gt; обозреватель объектов SQL Server**
-   Если LocalDB отсутствует в списке серверов: Щелкните правой кнопкой мыши **SQL Server** и выберите **Добавить SQL Server** использовать **проверку подлинности Windows** по умолчанию для подключения к серверу LocalDB.
-   Разверните узел LocalDB.
-   В узле базы данных щелкните правой кнопкой мыши узел База данных School и выберите **создать запрос...**
-   В редакторе T-SQL вставьте следующее определение возвращающего табличное значение

``` SQL
CREATE FUNCTION [dbo].[GetStudentGradesForCourse]

(@CourseID INT)

RETURNS TABLE

RETURN
    SELECT [EnrollmentID],
           [CourseID],
           [StudentID],
           [Grade]
    FROM   [dbo].[StudentGrade]
    WHERE  CourseID = @CourseID
```

-   Щелкните правой кнопкой мыши в редакторе T-SQL и выберите команду **выполнить** .
-   Функция Жетстудентградесфоркаурсе добавляется в базу данных School.

 

## <a name="create-a-model"></a>Создание модели

1.  Щелкните правой кнопкой мыши имя проекта в обозреватель решений, наведите указатель на пункт **Добавить**и выберите пункт **новый элемент** .
2.  Выберите **данные** в меню слева, а затем выберите **ADO.NET EDM** в области **шаблоны** .
3.  Введите **твфмодел. EDMX** в поле имя файла и нажмите кнопку **Добавить** .
4.  В диалоговом окне Выбор содержимого модели выберите пункт **создать из базы данных**, а затем нажмите кнопку **Далее** .
5.  Щелкните **новое подключение** ввод **(LocalDB) \\mssqllocaldb** в текстовом поле имя сервера введите **School** For имя базы данных нажмите кнопку **ОК** .
6.  В диалоговом окне Выбор объектов базы данных в разделе **таблицы** Node выберите **Person**, **студентграде**и **Course** tables.
7.  Выберите функцию **жетстудентградесфоркаурсе** , расположенную в разделе **хранимые процедуры и функции** node Примечание, начиная с Visual Studio 2012, Entity Designer позволяет выполнять пакетный импорт хранимых процедур и функций.
8.  Нажмите кнопку **Готово** .
9.  Отобразится Entity Designer, предоставляющий область конструктора для редактирования модели. Все объекты, выбранные в поле **выберите объекты базы данных** dialog, добавляются в модель.
10. По умолчанию Результирующая форма каждой импортируемой хранимой процедуры или функции будет автоматически становиться новым сложным типом в модели сущностей. Но нам нужно соотнести результаты функции Жетстудентградесфоркаурсе с сущностью Студентграде: Щелкните правой кнопкой мыши область конструктора и выберите в обозревателе моделей обозреватель **моделей** , выберите **Импорт функций**, а затем дважды щелкните функцию **Жетстудентградесфоркаурсе** в диалоговом окне Изменение импорта функции, выберите **сущности** . @no__t 4and выберите **студентграде**

## <a name="persist-and-retrieve-data"></a>Сохранение и получение данных

Откройте файл, в котором определен метод Main. Добавьте следующий код в функцию main.

В следующем коде показано, как создать запрос, использующий функцию с табличным значением. Запрос проецирует результаты в анонимный тип, который содержит название соответствующего курса и связанные студенты с уровнем большей или равной 3,5.

``` csharp
using (var context = new SchoolEntities())
{
    var CourseID = 4022;
    var Grade = 3.5M;

    // Return all the best students in the Microeconomics class.
    var students = from s in context.GetStudentGradesForCourse(CourseID)
                            where s.Grade >= Grade
                            select new
                            {
                                s.Person,
                                s.Course.Title
                            };

    foreach (var result in students)
    {
        Console.WriteLine(
            "Couse: {0}, Student: {1} {2}",
            result.Title,  
            result.Person.FirstName,  
            result.Person.LastName);
    }
}
```

Скомпилируйте и запустите приложение. Программа выдает следующие результаты.

```console
Couse: Microeconomics, Student: Arturo Anand
Couse: Microeconomics, Student: Carson Bryant
```

## <a name="summary"></a>Сводка

В этом пошаговом руководстве мы рассмотрели, как сопоставлять функции с табличным значением (возвращающие табличное) с помощью Entity Framework Designer. Также показано, как вызвать ТАБЛИЧную функцию из запроса LINQ.
