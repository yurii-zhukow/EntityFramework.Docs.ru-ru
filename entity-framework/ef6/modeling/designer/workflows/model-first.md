---
title: Model First EF6
description: Model First в Entity Framework 6
author: divega
ms.date: 10/23/2016
uid: ef6/modeling/designer/workflows/model-first
ms.openlocfilehash: 13c5e173182ad0781a674ce3d10f7374c4443bf9
ms.sourcegitcommit: abda0872f86eefeca191a9a11bfca976bc14468b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/14/2020
ms.locfileid: "90073166"
---
# <a name="model-first"></a>Model First
В этом видео и пошаговом руководстве представлены общие сведения о Model First разработке с помощью Entity Framework. Model First позволяет создать новую модель с помощью Entity Framework Designer, а затем создать схему базы данных на основе модели. Модель хранится в EDMX-файле (расширение EDMX) и может быть просмотрена и изменена в Entity Framework Designer. Классы, с которыми вы взаимодействуете в приложении, автоматически создаются из файла EDMX.

## <a name="watch-the-video"></a>Просмотреть видео
В этом видео и пошаговом руководстве представлены общие сведения о Model First разработке с помощью Entity Framework. Model First позволяет создать новую модель с помощью Entity Framework Designer, а затем создать схему базы данных на основе модели. Модель хранится в EDMX-файле (расширение EDMX) и может быть просмотрена и изменена в Entity Framework Designer. Классы, с которыми вы взаимодействуете в приложении, автоматически создаются из файла EDMX.

**Представляет**: [Роуэн Миллер (Rowan Miller)](https://romiller.com/)

**Видео**: [WMV](https://download.microsoft.com/download/5/B/1/5B1C338C-AFA7-4F68-B304-48BB008146EF/HDI-ITPro-MSDN-winvideo-modelfirst.wmv)  |  [MP4](https://download.microsoft.com/download/5/B/1/5B1C338C-AFA7-4F68-B304-48BB008146EF/HDI-ITPro-MSDN-mp4video-modelfirst.m4v)  |  [WMV (ZIP)](https://download.microsoft.com/download/5/B/1/5B1C338C-AFA7-4F68-B304-48BB008146EF/HDI-ITPro-MSDN-winvideo-modelfirst.zip)

## <a name="pre-requisites"></a>Предварительные требования

Для выполнения инструкций этого пошагового руководства необходимо установить Visual Studio 2010 или Visual Studio 2012.

Если вы используете Visual Studio 2010, вам также потребуется установить [NuGet](https://visualstudiogallery.msdn.microsoft.com/27077b70-9dad-4c64-adcf-c7cf6bc9970c) .

## <a name="1-create-the-application"></a>1. Создание приложения

Чтобы не усложнять, мы создадим простое консольное приложение, которое использует Model First для доступа к данным:

-   Открытие Visual Studio
-   **Файл- &gt; создать &gt; проект...**
-   Выбор **окон** в меню слева и **консольное приложение**
-   Введите **моделфирстсампле** в качестве имени
-   Нажмите кнопку **ОК**.

## <a name="2-create-model"></a>2. Создание модели

Мы будем использовать Entity Framework Designer, который входит в состав Visual Studio, для создания нашей модели.

-   **Проект- &gt; Добавить новый элемент...**
-   Выберите **данные** в меню слева, а затем **ADO.NET EDM**
-   Введите **блоггингмодел** в качестве имени и нажмите кнопку " **ОК**", чтобы запустить мастер EDM
-   Выберите **пустую модель** и нажмите кнопку **Готово** .

    ![Создать пустую модель](~/ef6/media/createemptymodel.png)

Entity Framework Designer открывается с пустой моделью. Теперь можно приступить к добавлению сущностей, свойств и ассоциаций в модель.

-   Щелкните правой кнопкой мыши область конструктора и выберите пункт **Свойства** .
-   В окно свойств изменить **имя контейнера сущностей** на **BloggingContext** 
     *это имя производного контекста, который будет создан автоматически, контекст представляет сеанс с базой данных, что позволяет запрашивать и сохранять данные*
-   Щелкните правой кнопкой мыши область конструктора и выберите команду **Добавить новую &gt; сущность...**
-   Введите в качестве имени сущности **блог** и **блогид** в качестве имени ключа и нажмите кнопку **ОК** .

    ![Добавить сущность блога](~/ef6/media/addblogentity.png)

-   Щелкните правой кнопкой мыши новую сущность в области конструктора и выберите **Добавить новое &gt; скалярное свойство**, введите **Name** в качестве имени свойства.
-   Повторите эту процедуру, чтобы добавить свойство **URL-адреса** .
-   Щелкните правой кнопкой мыши свойство **URL-адрес** в области конструктора и выберите **пункт свойства**, в окно свойств изменить значение параметра **Nullable** на **true**, что 
     *позволит нам сохранить блог в базе данных, не назначив ему URL-адрес* .
-   Используя только что знакомые методы, добавьте сущность **POST** со свойством ключа **постид** .
-   Добавление скалярных свойств **Title** и **Content** в сущность **POST**

Теперь, когда у нас есть пара сущностей, пришло время добавить ассоциацию (или связь) между ними.

-   Щелкните правой кнопкой мыши область конструктора и выберите команду **Добавить новую &gt; связь...**
-   Сделать один конец точки связи в **блоге** , используя кратность **одной** и другой конечной точки для **публикации** с кратностью. **Many** 
     *это означает, что в блоге имеется много записей, а запись принадлежит одному блогу* .
-   Убедитесь, что флажок **Добавить свойства внешнего ключа в сущность ' POST '** установлен, и нажмите кнопку **ОК** .

    ![Добавление ассоциации MF](~/ef6/media/addassociationmf.png)

Теперь у нас есть простая модель, из которой можно создать базу данных и использовать ее для чтения и записи данных.

![Начальная модель](~/ef6/media/modelinitial.png)

### <a name="additional-steps-in-visual-studio-2010"></a>Дополнительные действия в Visual Studio 2010

При работе в Visual Studio 2010 необходимо выполнить некоторые дополнительные действия по обновлению до последней версии Entity Framework. Обновление важно, так как оно предоставляет доступ к улучшенной поверхности API, которая гораздо проще в использовании, а также последние исправления ошибок.

Сначала необходимо получить последнюю версию Entity Framework из NuGet.

-   **Проект — &gt; Управление пакетами NuGet...** 
     *Если у вас нет параметра **Управление пакетами NuGet** , следует установить [последнюю версию NuGet](https://visualstudiogallery.msdn.microsoft.com/27077b70-9dad-4c64-adcf-c7cf6bc9970c) .*
-   Выбор вкладки "в **сети** "
-   Выберите пакет **EntityFramework**
-   Щелкните **Установить**.

Далее необходимо поменять модель, чтобы создать код, который использует API DbContext, который появился в более поздних версиях Entity Framework.

-   Щелкните правой кнопкой мыши пустое место в модели в конструкторе EF и выберите пункт **Добавить элемент создания кода...**
-   В меню слева выберите **шаблоны в Интернете** и выполните поиск по запросу **DbContext**
-   Выберите генератор EF **5. x DbContext для C \# **, введите **блоггингмодел** в качестве имени и нажмите кнопку **Добавить** .

    ![Шаблон DbContext](~/ef6/media/dbcontexttemplate.png)

## <a name="3-generating-the-database"></a>3. Создание базы данных

С учетом нашей модели Entity Framework может вычислить схему базы данных, которая позволит хранить и получать данные с помощью модели.

Сервер базы данных, устанавливаемый с Visual Studio, отличается в зависимости от установленной версии Visual Studio.

-   При использовании Visual Studio 2010 будет создаваться база данных SQL Express.
-   Если вы используете Visual Studio 2012, то будете создавать базу данных [LocalDB](https://msdn.microsoft.com/library/hh510202(v=sql.110).aspx) .

Давайте создадим базу данных.

-   Щелкните правой кнопкой мыши область конструктора и выберите команду **создать базу данных из модели...**
-   Нажмите кнопку **создать соединение...** и укажите либо LocalDB, либо SQL Express, в зависимости от используемой версии Visual Studio введите **моделфирст. блоги** в качестве имени базы данных.

    ![Подключение к LocalDB MF](~/ef6/media/localdbconnectionmf.png)

    ![Подключение к SQL Express (MF)](~/ef6/media/sqlexpressconnectionmf.png)

-   Нажмите кнопку **ОК** , и появится запрос на создание новой базы данных, выберите **Да** .
-   Нажмите кнопку **Далее** , и Entity Framework Designer вычислит сценарий для создания схемы базы данных.
-   После отображения скрипта нажмите кнопку **Готово** , и скрипт будет добавлен в проект и открыт.
-   Щелкните скрипт правой кнопкой мыши и выберите команду **выполнить**. вам будет предложено указать базу данных для подключения, указать LocalDB или SQL Server Express в зависимости от используемой версии Visual Studio.

## <a name="4-reading--writing-data"></a>4. чтение & запись данных

Теперь, когда у нас есть модель, пришло время использовать ее для доступа к некоторым данным. Классы, которые мы будем использовать для доступа к данным, создаются автоматически на основе файла EDMX.

*Этот снимок экрана находится в Visual Studio 2012, если вы используете Visual Studio 2010 файлы BloggingModel.tt и BloggingModel.Context.tt будут находиться непосредственно в проекте, а не вложены в EDMX-файл.*

![Созданные классы](~/ef6/media/generatedclasses.png)

Реализуйте метод Main в Program.cs, как показано ниже. Этот код создает новый экземпляр нашего контекста, а затем использует его для вставки нового блога. Затем он использует запрос LINQ для получения всех блогов из базы данных, упорядоченного в алфавитном порядке по названию.

``` csharp
class Program
{
    static void Main(string[] args)
    {
        using (var db = new BloggingContext())
        {
            // Create and save a new Blog
            Console.Write("Enter a name for a new Blog: ");
            var name = Console.ReadLine();

            var blog = new Blog { Name = name };
            db.Blogs.Add(blog);
            db.SaveChanges();

            // Display all Blogs from the database
            var query = from b in db.Blogs
                        orderby b.Name
                        select b;

            Console.WriteLine("All blogs in the database:");
            foreach (var item in query)
            {
                Console.WriteLine(item.Name);
            }

            Console.WriteLine("Press any key to exit...");
            Console.ReadKey();
        }
    }
}
```

Теперь можно запустить приложение и протестировать его.

```console
Enter a name for a new Blog: ADO.NET Blog
All blogs in the database:
ADO.NET Blog
Press any key to exit...
```

## <a name="5-dealing-with-model-changes"></a>5. Работа с изменениями модели

Пришло время внести некоторые изменения в нашу модель, при внесении этих изменений нам также потребуется обновить схему базы данных.

Начнем с добавления новой сущности пользователя в нашу модель.

-   Добавьте новое имя сущности **пользователя** с именем **пользователя** в качестве имени ключа и **строки** в качестве типа свойства для ключа.

    ![Добавить сущность пользователя](~/ef6/media/adduserentity.png)

-   Щелкните правой кнопкой мыши свойство **username** в области конструктора и выберите пункт **свойства**, в окно свойств изменить значение параметра **MaxLength** на 50. **50** 
     *это ограничит данные, которые могут храниться в имени пользователя, до 50 символов* .
-   Добавление скалярного свойства **DisplayName** в сущность **User**

Теперь у нас есть обновленная модель, и мы готовы к обновлению базы данных для размещения нового типа сущности пользователя.

-   Щелкните правой кнопкой мыши область конструктора и выберите команду **создать базу данных из модели...** Entity Framework вычислит скрипт для повторного создания схемы на основе обновленной модели.
-   Нажмите кнопку **Готово**.
-   Вы можете получить предупреждения о перезаписи существующего скрипта DDL, а также части сопоставления и хранилища модели. для этих предупреждений нажмите кнопку **Да** .
-   Обновленный скрипт SQL для создания базы данных будет открыт для вас.  
    *Созданный скрипт удалит все существующие таблицы, а затем воссоздаст схему с нуля. Это может работать для локальной разработки, но не для принудительной отправки изменений в базу данных, которая уже была развернута. Если необходимо опубликовать изменения в базе данных, которая уже была развернута, необходимо изменить скрипт или использовать средство сравнения схем для вычисления скрипта миграции.*
-   Щелкните скрипт правой кнопкой мыши и выберите команду **выполнить**. вам будет предложено указать базу данных для подключения, указать LocalDB или SQL Server Express в зависимости от используемой версии Visual Studio.

## <a name="summary"></a>Сводка

В этом пошаговом руководстве мы рассматривали Model Firstную разработку, которая позволила нам создать модель в конструкторе EF, а затем создать базу данных из этой модели. Затем мы использовали эту модель для чтения и записи данных из базы данных. Наконец, мы обновили модель, а затем воссоздали схему базы данных в соответствии с моделью.
