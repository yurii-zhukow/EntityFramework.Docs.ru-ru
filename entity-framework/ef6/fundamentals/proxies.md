---
title: Работа с прокси-серверами — EF6
description: Работа с учетными записями-посредниками в Entity Framework 6
author: ajcvickers
ms.date: 10/23/2016
uid: ef6/fundamentals/proxies
ms.openlocfilehash: de44e891c074a8811e466d040f6451bea0f950f4
ms.sourcegitcommit: 4860d036ea0fb392c28799907bcc924c987d2d7b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/17/2020
ms.locfileid: "97635852"
---
# <a name="working-with-proxies"></a>Работа с учетными записями-посредниками
При создании экземпляров типов сущностей POCO Entity Framework часто создает экземпляры динамически создаваемого производного типа, который выступает в качестве прокси-сервера для сущности. Этот прокси-сервер переопределяет некоторые виртуальные свойства сущности, чтобы вставлять обработчики для выполнения действий автоматически при обращении к свойству. Например, этот механизм используется для поддержки отложенной загрузки связей. Методы, представленные в этом разделе, также применимы к моделям, созданным с помощью Code First и конструктора EF.  

## <a name="disabling-proxy-creation"></a>Отключение создания прокси-сервера  

Иногда бывает полезно предотвратить создание экземпляров прокси-сервера Entity Framework. Например, сериализация экземпляров, не являющихся прокси, значительно упрощается, чем сериализация экземпляров прокси-сервера. Создание прокси-сервера может быть отключено путем снятия `ProxyCreationEnabled` флажка. В одном месте это можно сделать в конструкторе контекста. Пример:  

``` csharp
public class BloggingContext : DbContext
{
    public BloggingContext()
    {
        this.Configuration.ProxyCreationEnabled = false;
    }  

    public DbSet<Blog> Blogs { get; set; }
    public DbSet<Post> Posts { get; set; }
}
```  

Обратите внимание, что EF не будет создавать прокси для типов, где нет никаких действий для прокси-сервера. Это означает, что вы также можете избежать прокси-серверов, применяя типы, которые являются запечатанными и/или не имеют виртуальных свойств.  

## <a name="explicitly-creating-an-instance-of-a-proxy"></a>Явное создание экземпляра прокси-сервера  

Экземпляр прокси-сервера не будет создан при создании экземпляра сущности с помощью оператора New. Это может не быть проблемой, но если необходимо создать экземпляр прокси-сервера (например, для работы с отложенной загрузкой или отслеживанием изменений прокси-сервера), то это можно сделать с помощью `Create` метода `DbSet` . Пример:  

``` csharp
using (var context = new BloggingContext())
{
    var blog = context.Blogs.Create();
}
```  

Универсальная версия `Create` может использоваться, если требуется создать экземпляр производного типа сущности. Пример:  

``` csharp
using (var context = new BloggingContext())
{
    var admin = context.Users.Create<Administrator>();
}
```  

Обратите внимание, что `Create` метод не добавляет или не прикрепляет созданную сущность к контексту.  

Обратите внимание, что `Create` метод просто создает экземпляр самого типа сущности, если создание прокси-типа для сущности не будет иметь значения, так как это не будет делать ничего. Например, если тип сущности — sealed и (или) не имеет виртуальных свойств, то `Create` просто создаст экземпляр типа сущности.  

## <a name="getting-the-actual-entity-type-from-a-proxy-type"></a>Получение фактического типа сущности из прокси-типа  

Имена типов прокси-сервера выглядят примерно так:  

```
System.Data.Entity.DynamicProxies.Blog_5E43C6C196972BF0754973E48C9C941092D86818CD94005E9A759B70BF6E48E6
```

Тип сущности для этого типа прокси можно найти с помощью `GetObjectType` метода из `ObjectContext` . Пример:  

``` csharp
using (var context = new BloggingContext())
{
    var blog = context.Blogs.Find(1);
    var entityType = ObjectContext.GetObjectType(blog.GetType());
}
```  

Обратите внимание, что если тип, переданный в `GetObjectType` , является экземпляром типа сущности, который не является прокси-типом, то возвращается тип сущности. Это означает, что этот метод всегда можно использовать для получения фактического типа сущности без какой-либо другой проверки на наличие типа прокси.  
